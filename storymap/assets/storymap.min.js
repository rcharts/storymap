/* storymapjs - v0.0.5 - 2013-10-16
 * Copyright (c) 2013 Northwestern University Knight Lab 
 */
/* **********************************************
     Begin VCO.js
********************************************** *//*!
	VCO
*/(function(e){e.VCO={VERSION:"0.1",_originalL:e.VCO}})(this);VCO.debug=!0;VCO.Bind=function(e,t){return function(){return e.apply(t,arguments)}};trace=function(e){VCO.debug&&(window.console?console.log(e):typeof jsTrace!="undefined"&&jsTrace.send(e))};VCO.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);for(var n=0,r=t.length,i;n<r;n++){i=t[n]||{};for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}return e},setOptions:function(e,t){e.options=VCO.Util.extend({},e.options,t);e.options.uniqueid===""&&(e.options.uniqueid=VCO.Util.unique_ID(6))},setData:function(e,t){e.data=VCO.Util.extend({},e.data,t);e.data.uniqueid===""&&(e.data.uniqueid=VCO.Util.unique_ID(6))},mergeData:function(e,t){var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},stamp:function(){var e=0,t="_vco_id";return function(n){n[t]=n[t]||++e;return n[t]}}(),isArray:function(){if(Array.isArray)return Array.isArray;var e=Object.prototype.toString,t=e.call([]);return function(n){return e.call(n)===t}}(),unique_ID:function(e,t){var n=function(e){return Math.floor(Math.random()*e)},r=function(){var e="abcdefghijklmnopqurstuvwxyz";return e.substr(n(32),1)},i=function(e){var t="";for(var n=0;n<e;n++)t+=r();return t};return t?t+"-"+i(e):"vco-"+i(e)},htmlify:function(e){return e.match(/<\s*p[^>]*>([^<]*)<\s*\/\s*p\s*>/)?e:"<p>"+e+"</p>"},getParamString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return"?"+t.join("&")},formatNum:function(e,t){var n=Math.pow(10,t||5);return Math.round(e*n)/n},falseFn:function(){return!1},requestAnimFrame:function(){function e(e){window.setTimeout(e,1e3/60)}var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||e;return function(n,r,i,s){n=r?VCO.Util.bind(n,r):n;i&&t===e?n():t(n,s)}}(),bind:function(e,t){return function(){return e.apply(t,arguments)}},template:function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){var r=t[n];if(!t.hasOwnProperty(n))throw new Error("No value provided for variable "+e);return r})},ratio:{square:function(e){var t={w:0,h:0};if(e.w>e.h&&e.h>0){t.h=e.h;t.w=e.h}else{t.w=e.w;t.h=e.w}return t},r16_9:function(e){return e.w!==null&&e.w!==""?Math.round(e.w/16*9):e.h!==null&&e.h!==""?Math.round(e.h/9*16):0},r4_3:function(e){if(e.w!==null&&e.w!=="")return Math.round(e.w/4*3);if(e.h!==null&&e.h!=="")return Math.round(e.h/3*4)}},getObjectAttributeByIndex:function(e,t){if(typeof e!="undefined"){var n=0;for(var r in e){if(t===n)return e[r];n++}return""}return""},getUrlVars:function(e){var t,n=[],r,i;t=e.toString();t.match("&#038;")?t=t.replace("&#038;","&"):t.match("&#38;")?t=t.replace("&#38;","&"):t.match("&amp;")&&(t=t.replace("&amp;","&"));i=t.slice(t.indexOf("?")+1).split("&");for(var s=0;s<i.length;s++){r=i[s].split("=");n.push(r[0]);n[r[0]]=r[1]}return n}};(function(VCO){var Zepto=function(){function O(e){return e==null?String(e):T[N.call(e)]||"object"}function M(e){return O(e)=="function"}function _(e){return e!=null&&e==e.window}function D(e){return e!=null&&e.nodeType==e.DOCUMENT_NODE}function P(e){return O(e)=="object"}function H(e){return P(e)&&!_(e)&&e.__proto__==Object.prototype}function B(e){return e instanceof Array}function j(e){return typeof e.length=="number"}function F(e){return o.call(e,function(e){return e!=null})}function I(e){return e.length>0?n.fn.concat.apply([],e):e}function q(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function R(e){return e in f?f[e]:f[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function U(e,t){return typeof t=="number"&&!c[q(e)]?t+"px":t}function z(e){var t,n;if(!a[e]){t=u.createElement(e);u.body.appendChild(t);n=l(t,"").getPropertyValue("display");t.parentNode.removeChild(t);n=="none"&&(n="block");a[e]=n}return a[e]}function W(e){return"children"in e?s.call(e.children):n.map(e.childNodes,function(e){if(e.nodeType==1)return e})}function X(n,r,i){for(t in r)if(i&&(H(r[t])||B(r[t]))){H(r[t])&&!H(n[t])&&(n[t]={});B(r[t])&&!B(n[t])&&(n[t]=[]);X(n[t],r[t],i)}else r[t]!==e&&(n[t]=r[t])}function V(e,t){return t==null?n(e):n(e).filter(t)}function $(e,t,n,r){return M(t)?t.call(e,n,r):t}function J(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function K(t,n){var r=t.className,i=r&&r.baseVal!==e;if(n===e)return i?r.baseVal:r;i?r.baseVal=n:t.className=n}function Q(e){var t;try{return e?e=="true"||(e=="false"?!1:e=="null"?null:isNaN(t=Number(e))?/^[\[\{]/.test(e)?n.parseJSON(e):e:t):e}catch(r){return e}}function G(e,t){t(e);for(var n in e.childNodes)G(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=i.filter,u=window.document,a={},f={},l=u.defaultView.getComputedStyle,c={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},h=/^\s*<(\w+|!)[^>]*>/,p=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/^(?:body|html)$/i,v=["val","css","html","text","data","width","height","offset"],m=["after","prepend","before","append"],g=u.createElement("table"),y=u.createElement("tr"),b={tr:u.createElement("tbody"),tbody:g,thead:g,tfoot:g,td:y,th:y,"*":u.createElement("div")},w=/complete|loaded|interactive/,E=/^\.([\w-]+)$/,S=/^#([\w-]*)$/,x=/^[\w-]+$/,T={},N=T.toString,C={},k,L,A=u.createElement("div");C.matches=function(e,t){if(!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;s&&(i=A).appendChild(e);r=~C.qsa(i,t).indexOf(e);s&&A.removeChild(e);return r};k=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})};L=function(e){return o.call(e,function(t,n){return e.indexOf(t)==n})};C.fragment=function(t,r,i){t.replace&&(t=t.replace(p,"<$1></$2>"));r===e&&(r=h.test(t)&&RegExp.$1);r in b||(r="*");var o,u,a=b[r];a.innerHTML=""+t;u=n.each(s.call(a.childNodes),function(){a.removeChild(this)});if(H(i)){o=n(u);n.each(i,function(e,t){v.indexOf(e)>-1?o[e](t):o.attr(e,t)})}return u};C.Z=function(e,t){e=e||[];e.__proto__=n.fn;e.selector=t||"";return e};C.isZ=function(e){return e instanceof C.Z};C.init=function(t,r){if(!t)return C.Z();if(M(t))return n(u).ready(t);if(C.isZ(t))return t;var i;if(B(t))i=F(t);else if(P(t))i=[H(t)?n.extend({},t):t],t=null;else if(h.test(t))i=C.fragment(t.trim(),RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=C.qsa(u,t)}return C.Z(i,t)};n=function(e,t){return C.init(e,t)};n.extend=function(e){var t,n=s.call(arguments,1);if(typeof e=="boolean"){t=e;e=n.shift()}n.forEach(function(n){X(e,n,t)});return e};C.qsa=function(e,t){var n;return D(e)&&S.test(t)?(n=e.getElementById(RegExp.$1))?[n]:[]:e.nodeType!==1&&e.nodeType!==9?[]:s.call(E.test(t)?e.getElementsByClassName(RegExp.$1):x.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))};n.contains=function(e,t){return e!==t&&e.contains(t)};n.type=O;n.isFunction=M;n.isWindow=_;n.isArray=B;n.isPlainObject=H;n.isEmptyObject=function(e){var t;for(t in e)return!1;return!0};n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)};n.camelCase=k;n.trim=function(e){return e==null?"":String.prototype.trim.call(e)};n.uuid=0;n.support={};n.expr={};n.map=function(e,t){var n,r=[],i,s;if(j(e))for(i=0;i<e.length;i++){n=t(e[i],i);n!=null&&r.push(n)}else for(s in e){n=t(e[s],s);n!=null&&r.push(n)}return I(r)};n.each=function(e,t){var n,r;if(j(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e};n.grep=function(e,t){return o.call(e,t)};window.JSON&&(n.parseJSON=JSON.parse);n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){T["[object "+t+"]"]=t.toLowerCase()});n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,sort:i.sort,indexOf:i.indexOf,concat:i.concat,map:function(e){return n(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(e){w.test(u.readyState)?e(n):u.addEventListener("DOMContentLoaded",function(){e(n)},!1);return this},get:function(t){return t===e?s.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){i.every.call(this,function(t,n){return e.call(t,n,t)!==!1});return this},filter:function(e){return M(e)?this.not(this.not(e)):n(o.call(this,function(t){return C.matches(t,e)}))},add:function(e,t){return n(L(this.concat(n(e,t))))},is:function(e){return this.length>0&&C.matches(this[0],e)},not:function(t){var r=[];if(M(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):j(t)&&M(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},has:function(e){return this.filter(function(){return P(e)?n.contains(this,e):n(this).find(e).size()})},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!P(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!P(e)?e:n(e)},find:function(e){var t,r=this;typeof e=="object"?t=n(e).filter(function(){var e=this;return i.some.call(r,function(t){return n.contains(t,e)})}):this.length==1?t=n(C.qsa(this[0],e)):t=this.map(function(){return C.qsa(this,e)});return t},closest:function(e,t){var r=this[0],i=!1;typeof e=="object"&&(i=n(e));while(r&&!(i?i.indexOf(r)>=0:C.matches(r,e)))r=r!==t&&!D(r)&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&!D(e)&&t.indexOf(e)<0){t.push(e);return e}});return V(t,e)},parent:function(e){return V(L(this.pluck("parentNode")),e)},children:function(e){return V(this.map(function(){return W(this)}),e)},contents:function(){return this.map(function(){return s.call(this.childNodes)})},siblings:function(e){return V(this.map(function(e,t){return o.call(W(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return n.map(this,function(t){return t[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null);l(this,"").getPropertyValue("display")=="none"&&(this.style.display=z(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=M(e);if(this[0]&&!t)var r=n(e).get(0),i=r.parentNode||this.length>1;return this.each(function(s){n(this).wrapAll(t?e.call(this,s):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){n(this[0]).before(e=n(e));var t;while((t=e.children()).length)e=t.first();n(e).append(this)}return this},wrapInner:function(e){var t=M(e);return this.each(function(r){var i=n(this),s=i.contents(),o=t?e.call(this,r):e;s.length?s.wrapAll(o):i.append(o)})},unwrap:function(){this.parent().each(function(){n(this).replaceWith(n(this).children())});return this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var r=n(this);(t===e?r.css("display")=="none":t)?r.show():r.hide()})},prev:function(e){return n(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return n(this.pluck("nextElementSibling")).filter(e||"*")},html:function(t){return t===e?this.length>0?this[0].innerHTML:null:this.each(function(e){var r=this.innerHTML;n(this).empty().append($(this,t,e,r))})},text:function(t){return t===e?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(P(n))for(t in n)J(this,t,n[t]);else J(this,n,$(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&J(this,e)})},prop:function(t,n){return n===e?this[0]&&this[0][t]:this.each(function(e){this[t]=$(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+q(t),n);return r!==null?Q(r):e},val:function(t){return t===e?this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(e){return this.selected}).pluck("value"):this[0].value):this.each(function(e){this.value=$(this,t,e,this.value)})},offset:function(e){if(e)return this.each(function(t){var r=n(this),i=$(this,e,t,r.offset()),s=r.offsetParent().offset(),o={top:i.top-s.top,left:i.left-s.left};r.css("position")=="static"&&(o.position="relative");r.css(o)});if(this.length==0)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,n){if(arguments.length<2&&typeof e=="string")return this[0]&&(this[0].style[k(e)]||l(this[0],"").getPropertyValue(e));var r="";if(O(e)=="string")!n&&n!==0?this.each(function(){this.style.removeProperty(q(e))}):r=q(e)+":"+U(e,n);else for(t in e)!e[t]&&e[t]!==0?this.each(function(){this.style.removeProperty(q(t))}):r+=q(t)+":"+U(t,e[t])+";";return this.each(function(){this.style.cssText+=";"+r})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return i.some.call(this,function(e){return this.test(K(e))},R(e))},addClass:function(e){return this.each(function(t){r=[];var i=K(this),s=$(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this);r.length&&K(this,i+(i?" ":"")+r.join(" "))})},removeClass:function(t){return this.each(function(n){if(t===e)return K(this,"");r=K(this);$(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(R(e)," ")});K(this,r.trim())})},toggleClass:function(t,r){return this.each(function(i){var s=n(this),o=$(this,t,i,K(this));o.split(/\s+/g).forEach(function(t){(r===e?!s.hasClass(t):r)?s.addClass(t):s.removeClass(t)})})},scrollTop:function(){if(!this.length)return;return"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY},position:function(){if(!this.length)return;var e=this[0],t=this.offsetParent(),r=this.offset(),i=d.test(t[0].nodeName)?{top:0,left:0}:t.offset();r.top-=parseFloat(n(e).css("margin-top"))||0;r.left-=parseFloat(n(e).css("margin-left"))||0;i.top+=parseFloat(n(t[0]).css("border-top-width"))||0;i.left+=parseFloat(n(t[0]).css("border-left-width"))||0;return{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u.body;while(e&&!d.test(e.nodeName)&&n(e).css("position")=="static")e=e.offsetParent;return e})}};n.fn.detach=n.fn.remove;["width","height"].forEach(function(t){n.fn[t]=function(r){var i,s=this[0],o=t.replace(/./,function(e){return e[0].toUpperCase()});return r===e?_(s)?s["inner"+o]:D(s)?s.documentElement["offset"+o]:(i=this.offset())&&i[t]:this.each(function(e){s=n(this);s.css(t,$(this,r,e,s[t]()))})}});m.forEach(function(e,t){var r=t%2;n.fn[e]=function(){var e,i=n.map(arguments,function(t){e=O(t);return e=="object"||e=="array"||t==null?t:C.fragment(t)}),s,o=this.length>1;return i.length<1?this:this.each(function(e,u){s=r?u:u.parentNode;u=t==0?u.nextSibling:t==1?u.firstChild:t==2?u:null;i.forEach(function(e){if(o)e=e.cloneNode(!0);else if(!s)return n(e).remove();G(s.insertBefore(e,u),function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&!e.src&&window.eval.call(window,e.innerHTML)})})})};n.fn[r?e+"To":"insert"+(t?"Before":"After")]=function(t){n(t)[e](this);return this}});C.Z.prototype=n.fn;C.uniq=L;C.deserializeValue=Q;n.zepto=C;return n}();(function(e){function o(e){return e._zid||(e._zid=r++)}function u(e,t,r,i){t=a(t);if(t.ns)var s=f(t.ns);return(n[o(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||s.test(e.ns))&&(!r||o(e.fn)===o(r))&&(!i||e.sel==i)})}function a(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function f(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function l(t,n,r){e.type(t)!="string"?e.each(t,r):t.split(/\s/).forEach(function(e){r(e,n)})}function c(e,t){return e.del&&(e.e=="focus"||e.e=="blur")||!!t}function h(e){return s[e]||e}function p(t,r,i,u,f,p){var d=o(t),v=n[d]||(n[d]=[]);l(r,i,function(n,r){var i=a(n);i.fn=r;i.sel=u;i.e in s&&(r=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return i.fn.apply(this,arguments)});i.del=f&&f(r,n);var o=i.del||r;i.proxy=function(e){var n=o.apply(t,[e].concat(e.data));n===!1&&(e.preventDefault(),e.stopPropagation());return n};i.i=v.length;v.push(i);t.addEventListener(h(i.e),i.proxy,c(i,p))})}function d(e,t,r,i,s){var a=o(e);l(t||"",r,function(t,r){u(e,t,r,i).forEach(function(t){delete n[a][t.i];e.removeEventListener(h(t.e),t.proxy,c(t,s))})})}function b(t){var n,r={originalEvent:t};for(n in t)!g.test(n)&&t[n]!==undefined&&(r[n]=t[n]);e.each(y,function(e,n){r[e]=function(){this[n]=v;return t[e].apply(t,arguments)};r[n]=m});return r}function w(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0;t.call(this)}}}var t=e.zepto.qsa,n={},r=1,i={},s={mouseenter:"mouseover",mouseleave:"mouseout"};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents";e.event={add:p,remove:d};e.proxy=function(t,n){if(e.isFunction(t)){var r=function(){return t.apply(n,arguments)};r._zid=o(t);return r}if(typeof n=="string")return e.proxy(t[n],t);throw new TypeError("expected function")};e.fn.bind=function(e,t){return this.each(function(){p(this,e,t)})};e.fn.unbind=function(e,t){return this.each(function(){d(this,e,t)})};e.fn.one=function(e,t){return this.each(function(n,r){p(this,e,t,null,function(e,t){return function(){var n=e.apply(r,arguments);d(r,t,e);return n}})})};var v=function(){return!0},m=function(){return!1},g=/^([A-Z]|layer[XY]$)/,y={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,r){return this.each(function(i,s){p(s,n,r,t,function(n){return function(r){var i,o=e(r.target).closest(t,s).get(0);if(o){i=e.extend(b(r),{currentTarget:o,liveFired:s});return n.apply(o,[i].concat([].slice.call(arguments,1)))}}})})};e.fn.undelegate=function(e,t,n){return this.each(function(){d(this,t,n,e)})};e.fn.live=function(t,n){e(document.body).delegate(this.selector,t,n);return this};e.fn.die=function(t,n){e(document.body).undelegate(this.selector,t,n);return this};e.fn.on=function(t,n,r){return!n||e.isFunction(n)?this.bind(t,n||r):this.delegate(n,t,r)};e.fn.off=function(t,n,r){return!n||e.isFunction(n)?this.unbind(t,n||r):this.undelegate(n,t,r)};e.fn.trigger=function(t,n){if(typeof t=="string"||e.isPlainObject(t))t=e.Event(t);w(t);t.data=n;return this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})};e.fn.triggerHandler=function(t,n){var r,i;this.each(function(s,o){r=b(typeof t=="string"?e.Event(t):t);r.data=n;r.target=o;e.each(u(o,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})});return i};"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}});["focus","blur"].forEach(function(t){e.fn[t]=function(e){e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}});return this}});e.Event=function(e,t){typeof e!="string"&&(t=e,e=t.type);var n=document.createEvent(i[e]||"Events"),r=!0;if(t)for(var s in t)s=="bubbles"?r=!!t[s]:n[s]=t[s];n.initEvent(e,r,!0,null,null,null,null,null,null,null,null,null,null,null,null);n.isDefaultPrevented=function(){return this.defaultPrevented};return n}})(Zepto);(function($){function triggerAndReturn(e,t,n){var r=$.Event(t);$(e).trigger(r,n);return!r.defaultPrevented}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n){var r=n.context,i="success";n.success.call(r,e,i,t);triggerGlobal(n,r,"ajaxSuccess",[t,n,e]);ajaxComplete(i,t,n)}function ajaxError(e,t,n,r){var i=r.context;r.error.call(i,n,t,e);triggerGlobal(r,i,"ajaxError",[n,r,e]);ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e);triggerGlobal(n,r,"ajaxComplete",[t,n]);ajaxStop(n)}function empty(){}function mimeToDataType(e){e&&(e=e.split(";",2)[0]);return e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.processData&&e.data&&$.type(e.data)!="string"&&(e.data=$.param(e.data,e.traditional));e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data))}function parseArguments(e,t,n,r){var i=!$.isFunction(t);return{url:e,data:i?t:undefined,success:i?$.isFunction(n)?n:undefined:t,dataType:i?r||n:n}}function serialize(e,t,n,r){var i,s=$.isArray(t);$.each(t,function(t,o){i=$.type(o);r&&(t=n?r:r+"["+(s?"":t)+"]");!r&&s?e.add(o.name,o.value):i=="array"||!n&&i=="object"?serialize(e,o,n,t):e.add(t,o)})}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0;$.ajaxJSONP=function(e){if("type"in e){var t="jsonp"+ ++jsonpID,n=document.createElement("script"),r=function(){clearTimeout(o);$(n).remove();delete window[t]},i=function(n){r();if(!n||n=="timeout")window[t]=empty;ajaxError(null,n||"abort",s,e)},s={abort:i},o;if(ajaxBeforeSend(s,e)===!1){i("abort");return!1}window[t]=function(t){r();ajaxSuccess(t,s,e)};n.onerror=function(){i("error")};n.src=e.url.replace(/=\?/,"="+t);$("head").append(n);e.timeout>0&&(o=setTimeout(function(){i("timeout")},e.timeout));return s}return $.ajax(e)};$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0};$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings);settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);settings.url||(settings.url=window.location.toString());serializeData(settings);settings.cache===!1&&(settings.url=appendQuery(settings.url,"_="+Date.now()));var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder){hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?"));return $.ajaxJSONP(settings)}var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest");if(mime){baseHeaders.Accept=mime;mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]);xhr.overrideMimeType&&xhr.overrideMimeType(mime)}if(settings.contentType||settings.contentType!==!1&&settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{});xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type"));result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:$.parseJSON(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,xhr.status?"error":"abort",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);if(ajaxBeforeSend(xhr,settings)===!1){xhr.abort();return!1}settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty;xhr.abort();ajaxError(null,"timeout",xhr,settings)},settings.timeout));xhr.send(settings.data?settings.data:null);return xhr};$.get=function(e,t,n,r){return $.ajax(parseArguments.apply(null,arguments))};$.post=function(e,t,n,r){var i=parseArguments.apply(null,arguments);i.type="POST";return $.ajax(i)};$.getJSON=function(e,t,n){var r=parseArguments.apply(null,arguments);r.dataType="json";return $.ajax(r)};$.fn.load=function(e,t,n){if(!this.length)return this;var r=this,i=e.split(/\s/),s,o=parseArguments(e,t,n),u=o.success;i.length>1&&(o.url=i[0],s=i[1]);o.success=function(e){r.html(s?$("<div>").html(e.replace(rscript,"")).find(s):e);u&&u.apply(r,arguments)};$.ajax(o);return this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];n.add=function(e,t){this.push(escape(e)+"="+escape(t))};serialize(n,e,t);return n.join("&").replace(/%20/g,"+")}})(Zepto);VCO.getJSON=Zepto.getJSON;VCO.ajax=Zepto.ajax})(VCO);VCO.Class=function(){};VCO.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments)},n=function(){};n.prototype=this.prototype;var r=new n;r.constructor=t;t.prototype=r;t.superclass=this.prototype;for(var i in this)this.hasOwnProperty(i)&&i!=="prototype"&&i!=="superclass"&&(t[i]=this[i]);if(e.statics){VCO.Util.extend(t,e.statics);delete e.statics}if(e.includes){VCO.Util.extend.apply(null,[r].concat(e.includes));delete e.includes}e.options&&r.options&&(e.options=VCO.Util.extend({},r.options,e.options));VCO.Util.extend(r,e);t.extend=VCO.Class.extend;t.include=function(e){VCO.Util.extend(this.prototype,e)};return t};VCO.Events={addEventListener:function(e,t,n){var r=this._vco_events=this._vco_events||{};r[e]=r[e]||[];r[e].push({action:t,context:n||this});return this},hasEventListeners:function(e){var t="_vco_events";return t in this&&e in this[t]&&this[t][e].length>0},removeEventListener:function(e,t,n){if(!this.hasEventListeners(e))return this;for(var r=0,i=this._vco_events,s=i[e].length;r<s;r++)if(i[e][r].action===t&&(!n||i[e][r].context===n)){i[e].splice(r,1);return this}return this},fireEvent:function(e,t){if(!this.hasEventListeners(e))return this;var n=VCO.Util.extend({type:e,target:this},t),r=this._vco_events[e].slice();for(var i=0,s=r.length;i<s;i++)r[i].action.call(r[i].context||this,n);return this}};VCO.Events.on=VCO.Events.addEventListener;VCO.Events.off=VCO.Events.removeEventListener;VCO.Events.fire=VCO.Events.fireEvent;(function(){var e=navigator.userAgent.toLowerCase(),t=!!window.ActiveXObject,n=e.indexOf("webkit")!==-1,r=typeof orientation!="undefined"?!0:!1,i=e.indexOf("android")!==-1,s=window.opera;VCO.Browser={ie:t,ie6:t&&!window.XMLHttpRequest,webkit:n,webkit3d:n&&"WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix,gecko:e.indexOf("gecko")!==-1,opera:s,android:i,mobileWebkit:r&&n,mobileOpera:r&&s,mobile:r,touch:function(){var e=!1,t="ontouchstart";if(t in document.documentElement)return!0;var n=document.createElement("div");if(!n.setAttribute||!n.removeAttribute)return!1;n.setAttribute(t,"return;");typeof n[t]=="function"&&(e=!0);n.removeAttribute(t);n=null;return e}()}})();VCO.Load=function(e){function n(e){var n=0,r=!1;for(n=0;n<t.length;n++)t[n]==e&&(r=!0);if(r)return!0;t.push(e);return!1}var t=[];return{css:function(e,t,r,i){n(e)?t():VCO.LoadIt.css(e,t,r,i)},js:function(e,t,r,i){n(e)?t():VCO.LoadIt.js(e,t,r,i)}}}(this.document);VCO.LoadIt=function(e){function u(t,n){var r=e.createElement(t),i;for(i in n)n.hasOwnProperty(i)&&r.setAttribute(i,n[i]);return r}function a(e){var t=r[e],n,o;if(t){n=t.callback;o=t.urls;o.shift();i=0;if(!o.length){n&&n.call(t.context,t.obj);r[e]=null;s[e].length&&l(e)}}}function f(){var n=navigator.userAgent;t={async:e.createElement("script").async===!0};(t.webkit=/AppleWebKit\//.test(n))||(t.ie=/MSIE/.test(n))||(t.opera=/Opera/.test(n))||(t.gecko=/Gecko\//.test(n))||(t.unknown=!0)}function l(i,o,l,p,d){var v=function(){a(i)},m=i==="css",g=[],y,b,w,E,S,x;t||f();if(o){o=typeof o=="string"?[o]:o.concat();if(m||t.async||t.gecko||t.opera)s[i].push({urls:o,callback:l,obj:p,context:d});else for(y=0,b=o.length;y<b;++y)s[i].push({urls:[o[y]],callback:y===b-1?l:null,obj:p,context:d})}if(r[i]||!(E=r[i]=s[i].shift()))return;n||(n=e.head||e.getElementsByTagName("head")[0]);S=E.urls;for(y=0,b=S.length;y<b;++y){x=S[y];if(m)w=t.gecko?u("style"):u("link",{href:x,rel:"stylesheet"});else{w=u("script",{src:x});w.async=!1}w.className="lazyload";w.setAttribute("charset","utf-8");if(t.ie&&!m)w.onreadystatechange=function(){if(/loaded|complete/.test(w.readyState)){w.onreadystatechange=null;v()}};else if(m&&(t.gecko||t.webkit))if(t.webkit){E.urls[y]=w.href;h()}else{w.innerHTML='@import "'+x+'";';c(w)}else w.onload=w.onerror=v;g.push(w)}for(y=0,b=g.length;y<b;++y)n.appendChild(g[y])}function c(e){var t;try{t=!!e.sheet.cssRules}catch(n){i+=1;i<200?setTimeout(function(){c(e)},50):t&&a("css");return}a("css")}function h(){var e=r.css,t;if(e){t=o.length;while(--t>=0)if(o[t].href===e.urls[0]){a("css");break}i+=1;e&&(i<200?setTimeout(h,50):a("css"))}}var t,n,r={},i=0,s={css:[],js:[]},o=e.styleSheets;return{css:function(e,t,n,r){l("css",e,t,n,r)},js:function(e,t,n,r){l("js",e,t,n,r)}}}(this.document);VCO.Language={name:"English",lang:"en",api:{wikipedia:"en"},date:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."]},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"mmm d',' yyyy 'at' h:MM TT",full_long_small_date:"h:MM TT'<br/><small>mmm d',' yyyy'</small>'"},messages:{loading_timeline:"Loading Timeline... ",return_to_title:"Return to Title",expand_timeline:"Expand Timeline",contract_timeline:"Contract Timeline",wikipedia:"From Wikipedia, the free encyclopedia",loading_content:"Loading Content",loading:"Loading"}};VCO.Easings={ease:[.25,.1,.25,1],linear:[0,0,1,1],easein:[.42,0,1,1],easeout:[0,0,.58,1],easeinout:[.42,0,.58,1]};VCO.Ease={KeySpline:function(e){function t(e,t){return 1-3*t+3*e}function n(e,t){return 3*t-6*e}function r(e){return 3*e}function i(e,i,s){return((t(i,s)*e+n(i,s))*e+r(i))*e}function s(e,i,s){return 3*t(i,s)*e*e+2*n(i,s)*e+r(i)}function o(t){var n=t;for(var r=0;r<4;++r){var o=s(n,e[0],e[2]);if(o==0)return n;var u=i(n,e[0],e[2])-t;n-=u/o}return n}this.get=function(t){return e[0]==e[1]&&e[2]==e[3]?t:i(o(t),e[1],e[3])}},easeInSpline:function(e){var t=new VCO.Ease.KeySpline(VCO.Easings.easein);return t.get(e)},easeInOutExpo:function(e){var t=new VCO.Ease.KeySpline(VCO.Easings.easein);return t.get(e)},easeOut:function(e){return Math.sin(e*Math.PI/2)},easeOutStrong:function(e){return e==1?1:1-Math.pow(2,-10*e)},easeIn:function(e){return e*e},easeInStrong:function(e){return e==0?0:Math.pow(2,10*(e-1))},easeOutBounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},bounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75
)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},swingFrom:function(e){var t=1.70158;return e*e*((t+1)*e-t)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin((e*6-1)*2*Math.PI/2)+1},spring:function(e){return 1-Math.cos(e*4.5*Math.PI)*Math.exp(-e*6)},blink:function(e,t){return Math.round(e*(t||5))%2},pulse:function(e,t){return-Math.cos(e*((t||5)-.5)*2*Math.PI)/2+.5},wobble:function(e){return-Math.cos(e*Math.PI*9*e)/2+.5},sinusoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},flicker:function(e){var e=e+(Math.random()-.5)/5;return easings.sinusoidal(e<0?0:e>1?1:e)},mirror:function(e){return e<.5?easings.sinusoidal(e*2):easings.sinusoidal(1-(e-.5)*2)},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+(4-2*e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+ --e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};VCO.Animate=function(e,t){var n=new vcoanimate(e,t),r;return n};!function(e,t){typeof define=="function"?define(t):typeof module!="undefined"?module.exports=t():this[e]=t()}("vcoanimate",function(){function w(e,t,n){if(Array.prototype.indexOf)return e.indexOf(t);for(n=0;n<e.length;++n)if(e[n]===t)return n}function E(e){var t,n=b.length;r&&e>1e12&&(e=i());for(t=n;t--;)b[t](e);b.length&&y(E)}function S(e){b.push(e)===1&&y(E)}function x(e){var t,n=w(b,e);if(n>=0){t=b.slice(n+1);b.length=n;b=b.concat(t)}}function T(e,t){var n={},r;if(r=e.match(l))n.rotate=H(r[1],t?t.rotate:null);if(r=e.match(c))n.scale=H(r[1],t?t.scale:null);if(r=e.match(h)){n.skewx=H(r[1],t?t.skewx:null);n.skewy=H(r[3],t?t.skewy:null)}if(r=e.match(p)){n.translatex=H(r[1],t?t.translatex:null);n.translatey=H(r[3],t?t.translatey:null)}return n}function N(e){var t="";"rotate"in e&&(t+="rotate("+e.rotate+"deg) ");"scale"in e&&(t+="scale("+e.scale+") ");"translatex"in e&&(t+="translate("+e.translatex+"px,"+e.translatey+"px) ");"skewx"in e&&(t+="skew("+e.skewx+"deg,"+e.skewy+"deg)");return t}function C(e,t,n){return"#"+(1<<24|e<<16|t<<8|n).toString(16).slice(1)}function k(e){var t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return(t?C(t[1],t[2],t[3]):e).replace(/#(\w)(\w)(\w)$/,"#$1$1$2$2$3$3")}function L(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function A(e){return typeof e=="function"}function O(e){return Math.sin(e*Math.PI/2)}function M(e,t,n,r,s,u){function d(e){var i=e-c;if(i>a||h){u=isFinite(u)?u:1;h?p&&t(u):t(u);x(d);return n&&n.apply(f)}isFinite(u)?t(l*r(i/a)+s):t(r(i/a))}r=A(r)?r:B.easings[r]||O;var a=e||o,f=this,l=u-s,c=i(),h=0,p=0;S(d);return{stop:function(e){h=1;p=e;e||(n=null)}}}function _(e,t){var n=e.length,r=[],i,s;for(i=0;i<n;++i)r[i]=[e[i][0],e[i][1]];for(s=1;s<n;++s)for(i=0;i<n-s;++i){r[i][0]=(1-t)*r[i][0]+t*r[parseInt(i+1,10)][0];r[i][1]=(1-t)*r[i][1]+t*r[parseInt(i+1,10)][1]}return[r[0][0],r[0][1]]}function D(e,t,n){var r=[],i,s,o,u;for(i=0;i<6;i++){o=Math.min(15,parseInt(t.charAt(i),16));u=Math.min(15,parseInt(n.charAt(i),16));s=Math.floor((u-o)*e+o);s=s>15?15:s<0?0:s;r[i]=s.toString(16)}return"#"+r.join("")}function P(e,t,n,r,i,s,u){if(i=="transform"){u={};for(var a in n[s][i])u[a]=a in r[s][i]?Math.round(((r[s][i][a]-n[s][i][a])*e+n[s][i][a])*o)/o:n[s][i][a];return u}if(typeof n[s][i]=="string")return D(e,n[s][i],r[s][i]);u=Math.round(((r[s][i]-n[s][i])*e+n[s][i])*o)/o;i in d||(u+=t[s][i]||"px");return u}function H(e,t,n,r,i){return(n=a.exec(e))?(i=parseFloat(n[2]))&&t+(n[1]=="+"?1:-1)*i:parseFloat(e)}function B(e,t){var n=e?n=isFinite(e.length)?e:[e]:[],r,i=t.complete,s=t.duration,o=t.easing,a=t.bezier,l=[],c=[],h=[],p=[],d,y;if(a){d=t.left;y=t.top;delete t.right;delete t.bottom;delete t.left;delete t.top}for(r=n.length;r--;){l[r]={};c[r]={};h[r]={};if(a){var b=g(n[r],"left"),w=g(n[r],"top"),E=[H(A(d)?d(n[r]):d||0,parseFloat(b)),H(A(y)?y(n[r]):y||0,parseFloat(w))];p[r]=A(a)?a(n[r],E):a;p[r].push(E);p[r].unshift([parseInt(b,10),parseInt(w,10)])}for(var S in t){switch(S){case"complete":case"duration":case"easing":case"bezier":continue}var x=g(n[r],S),C,O=A(t[S])?t[S](n[r]):t[S];if(typeof O=="string"&&u.test(O)&&!u.test(x)){delete t[S];continue}l[r][S]=S=="transform"?T(x):typeof O=="string"&&u.test(O)?k(x).slice(1):parseFloat(x);c[r][S]=S=="transform"?T(O,l[r][S]):typeof O=="string"&&O.charAt(0)=="#"?k(O).slice(1):H(O,parseFloat(x));typeof O=="string"&&(C=O.match(f))&&(h[r][S]=C[1])}}return M.apply(n,[s,function(e,i,s){for(r=n.length;r--;){if(a){s=_(p[r],e);n[r].style.left=s[0]+"px";n[r].style.top=s[1]+"px"}for(var o in t){i=P(e,h,l,c,o,r);o=="transform"?n[r].style[v]=N(i):o=="opacity"&&!m?n[r].style.filter="alpha(opacity="+i*100+")":n[r].style[L(o)]=i}}},i,o])}var e=document,t=window,n=t.performance,r=n&&(n.now||n.webkitNow||n.msNow||n.mozNow),i=r?function(){return r.call(n)}:function(){return+(new Date)},s=e.documentElement,o=1e3,u=/^rgb\(|#/,a=/^([+\-])=([\d\.]+)/,f=/^(?:[\+\-]=?)?\d+(?:\.\d+)?(%|in|cm|mm|em|ex|pt|pc|px)$/,l=/rotate\(((?:[+\-]=)?([\-\d\.]+))deg\)/,c=/scale\(((?:[+\-]=)?([\d\.]+))\)/,h=/skew\(((?:[+\-]=)?([\-\d\.]+))deg, ?((?:[+\-]=)?([\-\d\.]+))deg\)/,p=/translate\(((?:[+\-]=)?([\-\d\.]+))px, ?((?:[+\-]=)?([\-\d\.]+))px\)/,d={lineHeight:1,zoom:1,zIndex:1,opacity:1,transform:1},v=function(){var t=e.createElement("a").style,n=["webkitTransform","MozTransform","OTransform","msTransform","Transform"],r;for(r=0;r<n.length;r++)if(n[r]in t)return n[r]}(),m=function(){return typeof e.createElement("a").style.opacity!="undefined"}(),g=e.defaultView&&e.defaultView.getComputedStyle?function(t,n){n=n=="transform"?v:n;n=L(n);var r=null,i=e.defaultView.getComputedStyle(t,"");i&&(r=i[n]);return t.style[n]||r}:s.currentStyle?function(e,t){t=L(t);if(t=="opacity"){var n=100;try{n=e.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(r){try{n=e.filters("alpha").opacity}catch(i){}}return n/100}var s=e.currentStyle?e.currentStyle[t]:null;return e.style[t]||s}:function(e,t){return e.style[L(t)]},y=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(e){t.setTimeout(function(){e(+(new Date))},17)}}(),b=[];B.tween=M;B.getStyle=g;B.bezier=_;B.transform=v;B.parseTransform=T;B.formatTransform=N;B.easings={};return B});VCO.Point=function(e,t,n){this.x=n?Math.round(e):e;this.y=n?Math.round(t):t};VCO.Point.prototype={add:function(e){return this.clone()._add(e)},_add:function(e){this.x+=e.x;this.y+=e.y;return this},subtract:function(e){return this.clone()._subtract(e)},_subtract:function(e){this.x-=e.x;this.y-=e.y;return this},divideBy:function(e,t){return new VCO.Point(this.x/e,this.y/e,t)},multiplyBy:function(e){return new VCO.Point(this.x*e,this.y*e)},distanceTo:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},clone:function(){return new VCO.Point(this.x,this.y)},toString:function(){return"Point("+VCO.Util.formatNum(this.x)+", "+VCO.Util.formatNum(this.y)+")"}};VCO.DomMixins={show:function(e){e||(this._el.container.style.display="block")},hide:function(e){this._el.container.style.display="none"},addTo:function(e){e.appendChild(this._el.container);this.onAdd()},removeFrom:function(e){e.removeChild(this._el.container);this.onRemove()},animatePosition:function(e,t){var n={duration:this.options.duration,easing:this.options.ease};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]+"px");this.animator&&this.animator.stop();this.animator=VCO.Animate(t,n)},onLoaded:function(){this.fire("loaded",this.data)},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},setPosition:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t?t.style[n]=e[n]+"px":this._el.container.style[n]=e[n]+"px")},getPosition:function(){return VCO.Dom.getPosition(this._el.container)}};VCO.Dom={get:function(e){return typeof e=="string"?document.getElementById(e):e},create:function(e,t,n){var r=document.createElement(e);r.className=t;n&&n.appendChild(r);return r},createText:function(e,t){var n=document.createTextNode(e);t&&t.appendChild(n);return n},getTranslateString:function(e){return VCO.Dom.TRANSLATE_OPEN+e.x+"px,"+e.y+"px"+VCO.Dom.TRANSLATE_CLOSE},setPosition:function(e,t){e._vco_pos=t;if(VCO.Browser.webkit3d){e.style[VCO.Dom.TRANSFORM]=VCO.Dom.getTranslateString(t);if(VCO.Browser.android){e.style["-webkit-perspective"]="1000";e.style["-webkit-backface-visibility"]="hidden"}}else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){var t={x:0,y:0};while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t.x+=e.offsetLeft;t.y+=e.offsetTop;e=e.offsetParent}return t},testProp:function(e){var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}};VCO.Util.extend(VCO.Dom,{TRANSITION:VCO.Dom.testProp(["transition","webkitTransition","OTransition","MozTransition","msTransition"]),TRANSFORM:VCO.Dom.testProp(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),TRANSLATE_OPEN:"translate"+(VCO.Browser.webkit3d?"3d(":"("),TRANSLATE_CLOSE:VCO.Browser.webkit3d?",0)":")"});VCO.DomUtil={get:function(e){return typeof e=="string"?document.getElementById(e):e},getStyle:function(e,t){var n=e.style[t];!n&&e.currentStyle&&(n=e.currentStyle[t]);if(!n||n==="auto"){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return n==="auto"?null:n},getViewportOffset:function(e){var t=0,n=0,r=e,i=document.body;do{t+=r.offsetTop||0;n+=r.offsetLeft||0;if(r.offsetParent===i&&VCO.DomUtil.getStyle(r,"position")==="absolute")break;r=r.offsetParent}while(r);r=e;do{if(r===i)break;t-=r.scrollTop||0;n-=r.scrollLeft||0;r=r.parentNode}while(r);return new VCO.Point(n,t)},create:function(e,t,n){var r=document.createElement(e);r.className=t;n&&n.appendChild(r);return r},disableTextSelection:function(){document.selection&&document.selection.empty&&document.selection.empty();if(!this._onselectstart){this._onselectstart=document.onselectstart;document.onselectstart=VCO.Util.falseFn}},enableTextSelection:function(){document.onselectstart=this._onselectstart;this._onselectstart=null},hasClass:function(e,t){return e.className.length>0&&(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(e.className)},addClass:function(e,t){VCO.DomUtil.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},removeClass:function(e,t){e.className=e.className.replace(/(\S+)\s*/g,function(e,n){return n===t?"":e}).replace(/^\s+/,"")},setOpacity:function(e,t){VCO.Browser.ie?e.style.filter="alpha(opacity="+Math.round(t*100)+")":e.style.opacity=t},testProp:function(e){var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1},getTranslateString:function(e){return VCO.DomUtil.TRANSLATE_OPEN+e.x+"px,"+e.y+"px"+VCO.DomUtil.TRANSLATE_CLOSE},getScaleString:function(e,t){var n=VCO.DomUtil.getTranslateString(t),r=" scale("+e+") ",i=VCO.DomUtil.getTranslateString(t.multiplyBy(-1));return n+r+i},setPosition:function(e,t){e._vco_pos=t;if(VCO.Browser.webkit3d){e.style[VCO.DomUtil.TRANSFORM]=VCO.DomUtil.getTranslateString(t);if(VCO.Browser.android){e.style["-webkit-perspective"]="1000";e.style["-webkit-backface-visibility"]="hidden"}}else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){return e._vco_pos}};VCO.DomEvent={addListener:function(e,t,n,r){var i=VCO.Util.stamp(n),s="_vco_"+t+i;if(e[s])return;var o=function(t){return n.call(r||e,t||VCO.DomEvent._getEvent())};if(VCO.Browser.touch&&t==="dblclick"&&this.addDoubleTapListener)this.addDoubleTapListener(e,o,i);else if("addEventListener"in e)if(t==="mousewheel"){e.addEventListener("DOMMouseScroll",o,!1);e.addEventListener(t,o,!1)}else if(t==="mouseenter"||t==="mouseleave"){var u=o,a=t==="mouseenter"?"mouseover":"mouseout";o=function(t){if(!VCO.DomEvent._checkMouse(e,t))return;return u(t)};e.addEventListener(a,o,!1)}else e.addEventListener(t,o,!1);else"attachEvent"in e&&e.attachEvent("on"+t,o);e[s]=o},removeListener:function(e,t,n){var r=VCO.Util.stamp(n),i="_vco_"+t+r,s=e[i];if(!s)return;if(VCO.Browser.touch&&t==="dblclick"&&this.removeDoubleTapListener)this.removeDoubleTapListener(e,r);else if("removeEventListener"in e)if(t==="mousewheel"){e.removeEventListener("DOMMouseScroll",s,!1);e.removeEventListener(t,s,!1)}else t==="mouseenter"||t==="mouseleave"?e.removeEventListener(t==="mouseenter"?"mouseover":"mouseout",s,!1):e.removeEventListener(t,s,!1);else"detachEvent"in e&&e.detachEvent("on"+t,s);e[i]=null},_checkMouse:function(e,t){var n=t.relatedTarget;if(!n)return!0;try{while(n&&n!==e)n=n.parentNode}catch(r){return!1}return n!==e},_getEvent:function(){var e=window.event;if(!e){var t=arguments.callee.caller;while(t){e=t.arguments[0];if(e&&window.Event===e.constructor)break;t=t.caller}}return e},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},disableClickPropagation:function(e){VCO.DomEvent.addListener(e,VCO.Draggable.START,VCO.DomEvent.stopPropagation);VCO.DomEvent.addListener(e,"click",VCO.DomEvent.stopPropagation);VCO.DomEvent.addListener(e,"dblclick",VCO.DomEvent.stopPropagation)},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stop:function(e){VCO.DomEvent.preventDefault(e);VCO.DomEvent.stopPropagation(e)},getWheelDelta:function(e){var t=0;e.wheelDelta&&(t=e.wheelDelta/120);e.detail&&(t=-e.detail/3);return t}};VCO.Draggable=VCO.Class.extend({includes:VCO.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize:function(e,t,n){this._el={drag:e,move:e};n&&(this._el.move=n);this.options={enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:!1,right:!1},momentum_multiplier:2e3,duration:1e3,ease:VCO.Ease.easeInOutQuint};this.animator=null;this.dragevent=this.mousedrag;VCO.Browser.touch&&(this.dragevent=this.touchdrag);this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1};VCO.Util.mergeData(this.options,t)},enable:function(e){VCO.DomEvent.addListener(this._el.drag,this.dragevent.down,this._onDragStart,this);VCO.DomEvent.addListener(this._el.drag,this.dragevent.up,this._onDragEnd,this);this.data.pos.start=VCO.Dom.getPosition(this._el.move);this._el.move.style.left=this.data.pos.start.x+"px";this._el.move.style.top=this.data.pos.start.y+"px";this._el.move.style.position="absolute"},disable:function(){VCO.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this);VCO.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum:function(){this.animator&&this.animator.stop()},updateConstraint:function(e){this.options.constraint=e},_onDragStart:function(e){if(VCO.Browser.touch)if(e.originalEvent){this.data.pagex.start=e.originalEvent.touches[0].screenX;this.data.pagey.start=e.originalEvent.touches[0].screenY}else{this.data.pagex.start=e.targetTouches[0].screenX;this.data.pagey.start=e.targetTouches[0].screenY}else{this.data.pagex.start=e.pageX;this.data.pagey.start=e.pageY}this.options.enable.x&&(this._el.move.style.left=this.data.pagex.start-this._el.move.offsetWidth/2+"px");this.options.enable.y&&(this._el.move.style.top=this.data.pagey.start-this._el.move.offsetHeight/2+"px");this.data.pos.start=VCO.Dom.getPosition(this._el.drag);this.data.time.start=(new Date).getTime();this.fire("dragstart",this.data);VCO.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this);VCO.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd:function(e){this.data.sliding=!1;VCO.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this);VCO.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this);this.fire("dragend",this.data);this._momentum()},_onDragMove:function(e){e.preventDefault();this.data.sliding=!0;if(VCO.Browser.touch)if(e.originalEvent){this.data.pagex.end=e.originalEvent.touches[0].screenX;this.data.pagey.end=e.originalEvent.touches[0].screenY}else{this.data.pagex.end=e.targetTouches[0].screenX;this.data.pagey.end=e.targetTouches[0].screenY}else{this.data.pagex.end=e.pageX;this.data.pagey.end=e.pageY}this.data.pos.end=VCO.Dom.getPosition(this._el.drag);this.data.new_pos.x=-(this.data.pagex.start-this.data.pagex.end-this.data.pos.start.x);this.data.new_pos.y=-(this.data.pagey.start-this.data.pagey.end-this.data.pos.start.y);this.options.enable.x&&(this._el.move.style.left=this.data.new_pos.x+"px");this.options.enable.y&&(this._el.move.style.top=this.data.new_pos.y+"px");this.fire("dragmove",this.data)},_momentum:function(){var e={x:0,y:0,time:0},t={x:0,y:0,time:0},n=!1,r="";VCO.Browser.touch;e.time=((new Date).getTime()-this.data.time.start)*10;t.time=((new Date).getTime()-this.data.time.start)*10;t.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start));t.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start));e.x=Math.round(t.x/t.time);e.y=Math.round(t.y/t.time);this.data.new_pos.x=Math.min(this.data.pos.end.x+e.x);this.data.new_pos.y=Math.min(this.data.pos.end.y+e.y);this.options.enable.x?this.data.new_pos.x<0&&(this.data.new_pos.x=0):this.data.new_pos.x=this.data.pos.start.x;this.options.enable.y?this.data.new_pos.y<0&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y;t.time<3e3&&(n=!0);if(Math.abs(t.x)>1e4){this.data.direction="left";t.x>0&&(this.data.direction="right")}if(Math.abs(t.y)>1e4){this.data.direction="up";t.y>0&&(this.data.direction="down")}this._animateMomentum();n&&this.fire("swipe_"+this.data.direction,this.data)},_animateMomentum:function(){var e={x:this.data.new_pos.x,y:this.data.new_pos.y};if(this.options.constraint.top||this.options.constraint.bottom)e.y>this.options.constraint.bottom?e.y=this.options.constraint.bottom:e.y<this.options.constraint.top&&(e.y=this.options.constraint.top);if(this.options.constraint.left||this.options.constraint.right)e.x>this.options.constraint.left?e.x=this.options.constraint.left:e.x<this.options.constraint.right&&(e.x=this.options.constraint.right);this.animator=VCO.Animate(this._el.move,{left:Math.floor(e.x)+"px",top:Math.floor(e.y)+"px",duration:this.options.duration,easing:VCO.Ease.easeOutStrong});this.fire("momentum",this.data)}});VCO.SizeBar=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={parent:{},container:{},arrow:{},line:{},coverbar:{},grip:{}};typeof e=="object"?this._el.container=e:this._el.container=VCO.Dom.get(e);t&&(this._el.parent=t);this.options={width:600,height:600,duration:1e3,ease:VCO.Ease.easeInOutQuint,sizebar_default_y:600};this._draggable={};this.animator={};VCO.Util.mergeData(this.options,n);this._initLayout();this._initEvents()},show:function(e){var t=this.options.duration;e&&(t=e);this.animator=VCO.Animate(this._el.container,{top:VCO.Dom.getPosition(this._el.parent).y+this.options.sizebar_default_y+"px",duration:t,easing:VCO.Ease.easeOutStrong})},hide:function(e){this.animator=VCO.Animate(this._el.container,{top:e,duration:this.options.duration,easing:VCO.Ease.easeOutStrong})},setSticky:function(e){this.options.sizebar_default_y=e},updateDisplay:function(e,t,n,r){this._updateDisplay(e,t,n,r)},_onMouseClick:function(){this.fire("clicked",this.options)},_onDragStart:function(e){},_onDragMove:function(e){var t=e.new_pos.y-VCO.Dom.getPosition(this._el.parent).y;this.fire("move",{y:t})},_onMomentum:function(e){var t=e.new_pos.y-VCO.Dom.getPosition(this._el.parent).y;if(t<this.options.sizebar_default_y){this._draggable.stopMomentum();if(e.direction=="down"){this.show();this.fire("momentum",{y:this.options.sizebar_default_y})}else{this.hide(VCO.Dom.getPosition(this._el.parent).y);this.fire("momentum",{y:1})}}else this.fire("momentum",{y:t})},_onDragEnd:function(e){},_onSwipeUp:function(e){var t=e.new_pos.y-VCO.Dom.getPosition(this._el.parent).y;this._draggable.stopMomentum();if(t>this.options.sizebar_default_y){this.show();this.fire("momentum",{y:this.options.sizebar_default_y})}else{this.hide(VCO.Dom.getPosition(this._el.parent).y);this.fire("swipe",{y:1})}},_onSwipeDown:function(e){if(VCO.Dom.getPosition(this._el.container).y<this.options.sizebar_default_y){this._draggable.stopMomentum();this.show();this.fire("swipe",{y:this.options.sizebar_default_y})}},_initLayout:function(){this._el.arrow=VCO.Dom.create("div","vco-arrow-up",this._el.container);this._el.container.style.top=this.options.sizebar_default_y+"px";this._draggable=new VCO.Draggable(this._el.container,{enable:{x:!1,y:!0},constraint:{bottom:this.options.height}});this._draggable.on("dragstart",this._onDragStart,this);this._draggable.on("dragmove",this._onDragMove,this);this._draggable.on("dragend",this._onDragEnd,this);this._draggable.on("swipe_up",this._onSwipeUp,this);this._draggable.on("swipe_down",this._onSwipeDown,this);this._draggable.on("momentum",this._onMomentum,this);this._draggable.enable()},_initEvents:function(){},_updateDisplay:function(e,t,n,r){e&&(this.options.width=e);t&&(this.options.height=t);this._draggable.updateConstraint({bottom:this.options.height-this._el.container.offsetHeight});this._el.container.style.width=this.options.width+"px";this._el.arrow.style.left=this.options.width/2-17+"px";trace(r)}});VCO.Message=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={parent:{},container:{},message_container:{},loading_icon:{},message:{}};this.options={width:600,height:600};this._el.container=VCO.Dom.create("div","vco-message");if(n){n.appendChild(this._el.container);this._el.parent=n}this.animator={};VCO.Util.mergeData(this.data,e);VCO.Util.mergeData(this.options,t);this._initLayout();this._initEvents()},updateMessage:function(e){this._updateMessage(e)},updateDisplay:function(e,t){this._updateDisplay(e,t)},_updateMessage:function(e){e?this._el.message.innerHTML=e:VCO.Language?this._el.message.innerHTML=VCO.Language.messages.loading:this._el.message.innerHTML="Loading"},_onMouseClick:function(){this.fire("clicked",this.options)},_initLayout:function(){this._el.message_container=VCO.Dom.create("div","vco-message-container",this._el.container);this._el.loading_icon=VCO.Dom.create("div","vco-loading-icon",this._el.message_container);this._el.message=VCO.Dom.create("div","vco-message-content",this._el.message_container);this._updateMessage()},_initEvents:function(){},_updateDisplay:function(e,t,n){}});VCO.MediaType=function(e){var t={},n=[{type:"youtube",match_str:"(www.)?youtube|youtu.be",cls:VCO.Media.YouTube},{type:"vimeo",match_str:"(player.)?vimeo.com",cls:VCO.Media.Vimeo},{type:"dailymotion",match_str:"(www.)?dailymotion.com",cls:VCO.Media.DailyMotion},{type:"vine",match_str:"(www.)?vine.co",cls:VCO.Media.Vine},{type:"soundcloud",match_str:"(player.)?soundcloud.com",cls:VCO.Media.SoundCloud},{type:"twitter",match_str:"(www.)?twitter.com",cls:VCO.Media.Twitter},{type:"googlemaps",match_str:"maps.google",cls:VCO.Media.Map},{type:"googleplus",match_str:"plus.google",cls:VCO.Media.GooglePlus},{type:"flickr",match_str:"flickr.com/photos",cls:VCO.Media.Flickr},{type:"instagram",match_str:"instagr.am/p/",cls:VCO.Media},{type:"image",match_str:/jpg|jpeg|png|gif/i,cls:VCO.Media.Image},{type:"googledocs",match_str:/\b.(doc|docx|xls|xlsx|ppt|pptx|pdf|pages|ai|psd|tiff|dxf|svg|eps|ps|ttf|xps|zip|tif)\b/,cls:VCO.Media.GoogleDoc},{type:"wikipedia",match_str:"(www.)?wikipedia.org",cls:VCO.Media.Wikipedia},{type:"iframe",match_str:"iframe",cls:VCO.Media.IFrame},{type:"storify",match_str:"storify",cls:VCO.Media.Storify},{type:"blockquote",match_str:"blockquote",cls:VCO.Media.Blockquote},{type:"website",match_str:"http://",cls:VCO.Media.Website},{type:"",match_str:"",cls:VCO.Media}];for(var r=0;r<n.length;r++){if(e instanceof Array){trace("SLIDER");return t={type:"slider",cls:VCO.Media.Slider}}if(e.url.match(n[r].match_str)){t=n[r];t.url=e.url;return t}}return!1};VCO.Media=VCO.Class.extend({includes:[VCO.Events],_el:{},initialize:function(e,t,n){this._el={container:{},content_container:{},content:{},content_item:{},caption:null,credit:null,parent:{},link:null};this.player=null;this.timer=null;this.message=null;this.media_id=null;this.data={uniqueid:null,url:null,credit:null,caption:null,link:null,link_target:null};this.options={api_key_flickr:"f2cc870b4d233dd0a5bfe73fd0d64ef0",credit_height:0,caption_height:0};this.animator={};VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._el.container=VCO.Dom.create("div","vco-media");this._el.container.id=this.data.uniqueid;this._initLayout();if(n){n.appendChild(this._el.container);this._el.parent=n}},loadMedia:function(){try{this._loadMedia()}catch(e){trace("Error loading media for ",this._media);trace(e)}},_loadMedia:function(){},_updateMediaDisplay:function(){this._el.content_item.style.maxHeight=this.options.height-this.options.credit_height-this.options.caption_height-16+"px"},show:function(){},hide:function(){},addTo:function(e){e.appendChild(this._el.container);this.onAdd()},removeFrom:function(e){e.removeChild(this._el.container);this.onRemove()},updateDisplay:function(e,t,n){this._updateDisplay(e,t,n)},onLoaded:function(){this.fire("loaded",this.data);this.message&&this.message.hide()},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},_initLayout:function(){this.message=new VCO.Message({},this.options);this.message.addTo(this._el.container);this._el.content_container=VCO.Dom.create("div","vco-media-content-container",this._el.container);if(this.data.link&&this.data.link!=""){this._el.link=VCO.Dom.create("a","vco-media-link",this._el.content_container);this._el.link.href=this.data.link;this.data.link_target&&this.data.link_target!=""?this._el.link.target=this.data.link_target:this._el.link.target="_blank";this._el.content=VCO.Dom.create("div","vco-media-content",this._el.link)}else this._el.content=VCO.Dom.create("div","vco-media-content",this._el.content_container);if(this.data.credit&&this.data.credit!=""){this._el.credit=VCO.Dom.create("div","vco-credit",this._el.content_container);this._el.credit.innerHTML=this.data.credit;this.options.credit_height=this._el.credit.offsetHeight}if(this.data.caption&&this.data.caption!=""){this._el.caption=VCO.Dom.create("div","vco-caption",this._el.content_container);this._el.caption.innerHTML=this.data.caption;this.options.caption_height=this._el.caption.offsetHeight}},_updateDisplay:function(e,t,n){trace("UPDATE MEDIA DISPLAY");e&&(this.options.width=e);t&&(this.options.height=t);this._el.credit&&(this.options.credit_height=this._el.credit.offsetHeight);this._el.caption&&(this.options.caption_height=this._el.caption.offsetHeight);this._updateMediaDisplay()}});VCO.Media.Blockquote=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){this.message.updateMessage(VCO.Language.messages.loading+" SoundCloud");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-blockquote",this._el.content);this.media_id=this.data.url;this._el.content_item.innerHTML=this.media_id;this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.Flickr=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" Flickr");this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image vco-media-flickr vco-media-shadow",this._el.content);this.media_id=this.data.url.split("photos/")[1].split("/")[1];e="http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+this.options.api_key_flickr+"&photo_id="+this.media_id+"&format=json&jsoncallback=?";VCO.getJSON(e,function(e){t.createMedia(e)})},createMedia:function(e){var t=this.sizes(this.options.height),n=e.sizes.size[e.sizes.size.length-2].source;for(var r=0;r<e.sizes.size.length;r++)e.sizes.size[r].label==t&&(n=e.sizes.size[r].source);this._el.content_item.src=n;this.onLoaded()},sizes:function(e){var t="";e<=75?e<=0?t="Large":t="Thumbnail":e<=180?t="Small":e<=240?t="Small 320":e<=375?t="Medium":e<=480?t="Medium 640":e<=600?t="Large":t="Large";return t}});VCO.Media.GoogleDoc=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" Google Doc");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe",this._el.content);this.media_id=this.data.url;e=this.media_id;this.media_id.match(/docs.google.com/i)?this._el.content_item.innerHTML="<iframe class='doc' frameborder='0' width='100%' height='100%' src='"+this.media_id+"&amp;embedded=true'></iframe>":this._el.content_item.innerHTML="<iframe class='doc' frameborder='0' width='100%' height='100%' src='http://docs.google.com/viewer?url="+this.media_id+"&amp;embedded=true'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.GooglePlus=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" GooglePlus");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-googleplus",this._el.content);this.media_id=this.data.url;e=this.media_id;this._el.content_item.innerHTML="<iframe frameborder='0' width='100%' height='100%' src='"+e+"'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.IFrame=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" iFrame");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe",this._el.content);this.media_id=this.data.url;e=this.media_id;this._el.content_item.innerHTML=e;this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.Image=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image vco-media-shadow",this._el.content);this._el.content_item.src=this.data.url;this.onLoaded()}});VCO.Media.SoundCloud=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" SoundCloud");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-soundcloud vco-media-shadow",this._el.content);this.media_id=this.data.url;e="http://soundcloud.com/oembed?url="+this.media_id+"&format=js&callback=?";VCO.getJSON(e,function(e){t.createMedia(e)})},createMedia:function(e){this._el.content_item.innerHTML=e.html;this.onLoaded()}});VCO.Media.Storify=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e;this.message.updateMessage(VCO.Language.messages.loading+" Storify");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-storify",this._el.content);this.media_id=this.data.url;e="<iframe frameborder='0' width='100%' height='100%' src='"+this.media_id+"/embed'></iframe>";e+="<script src='"+this.media_id+".js'></script>";this._el.content_item.innerHTML=e;this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}});VCO.Media.Text=VCO.Class.extend({includes:[VCO.Events],_el:{container:{},content_container:{},content:{},headline:{}},data:{uniqueid:"",headline:"Le portrait mystérieux",text:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit."},options:{something:""},initialize:function(e,t,n){VCO.Util.setData(this,e);t&&VCO.Util.setOptions(this,this.options);this._el.container=VCO.Dom.create("div","vco-text");this._el.container.id=this.data.uniqueid;this._initLayout();n&&n.appendChild(this._el.container)},show:function(){},hide:function(){},addTo:function(e){e.appendChild(this._el.container)},removeFrom:function(e){e.removeChild(this._el.container)},onLoaded:function(){this.fire("loaded",this.data)},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},_initLayout:function(){this._el.content_container=VCO.Dom.create("div","vco-text-content-container"
,this._el.container);if(this.data.headline!=""){this._el.headline=VCO.Dom.create("h2","vco-headline",this._el.content_container);this._el.headline.innerHTML=this.data.headline}if(this.data.text!=""){this._el.content=VCO.Dom.create("div","vco-text-content",this._el.content_container);this._el.content.innerHTML=VCO.Util.htmlify(this.data.text)}this.onLoaded()}});VCO.Media.Twitter=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" Tweet");this._el.content_item=VCO.Dom.create("div","vco-media-twitter",this._el.content);this.data.url.match("status/")?this.media_id=this.data.url.split("status/")[1]:url.match("statuses/")?this.media_id=this.data.url.split("statuses/")[1]:this.media_id="";e="http://api.twitter.com/1/statuses/oembed.json?id="+this.media_id+"&omit_script=true&include_entities=true&callback=?";VCO.getJSON(e,function(e){t.createMedia(e)})},createMedia:function(e){var t="",n="";t+=e.html.split("</p>&mdash;")[0]+"</p></blockquote>";n=e.author_url.split("twitter.com/")[1];t+="<div class='vcard author'>";t+="<a class='screen-name url' href='"+e.author_url+"' target='_blank'>";t+="<span class='avatar'></span>";t+="<span class='fn'>"+e.author_name+"</span>";t+="<span class='nickname'>@"+n+"<span class='thumbnail-inline'></span></span>";t+="</a>";t+="</div>";this._el.content_item.innerHTML=t;this.onLoaded()}});VCO.Media.Vimeo=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" Vimeo");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-vimeo vco-media-shadow",this._el.content);this.media_id=this.data.url.split(/video\/|\/\/vimeo\.com\//)[1].split(/[?&]/)[0];e="http://player.vimeo.com/video/"+this.media_id+"?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff";this._el.content_item.innerHTML="<iframe autostart='false' frameborder='0' width='100%' height='100%' src='"+e+"'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=VCO.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"}});VCO.Media.DailyMotion=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" DailyMotion");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-dailymotion",this._el.content);this.media_id=this.data.url.split("embed/")[1].split(/[?&]/)[0];e="http://www.dailymotion.com/embed/video/"+this.media_id;this._el.content_item.innerHTML="<iframe autostart='false' frameborder='0' width='100%' height='100%' src='"+e+"'></iframe>";this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=VCO.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"}});VCO.Media.Vine=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t=this;this.message.updateMessage(VCO.Language.messages.loading+" SoundCloud");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-iframe vco-media-vine vco-media-shadow",this._el.content);this.media_id=this.data.url.split("vine.co/v/")[1];e="https://vine.co/v/"+this.media_id+"/embed/simple";this._el.content_item.innerHTML="<iframe frameborder='0' width='100%' height='100%' src='"+e+"'></iframe><script async src='http://platform.vine.co/static/scripts/embed.js' charset='utf-8'></script>";this.onLoaded()},_updateMediaDisplay:function(){var e=VCO.Util.ratio.square({w:this.options.width,h:this.options.height});this._el.content_item.style.height=e.h+"px";this._el.content_item.style.width=e.w+"px"}});VCO.Media.Website=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){},createMedia:function(e){this.onLoaded()}});VCO.Media.Wikipedia=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e,t,n=this;this.message.updateMessage(VCO.Language.messages.loading+" Wikipedia");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-wikipedia",this._el.content);this.media_id=this.data.url.split("wiki/")[1].split("#")[0].replace("_"," ");this.media_id=this.media_id.replace(" ","%20");t=this.data.url.split("//")[1].split(".wikipedia")[0];e="http://"+t+".wikipedia.org/w/api.php?action=query&prop=extracts&redirects=&titles="+this.media_id+"&exintro=1&format=json&callback=?";VCO.getJSON(e,function(e){n.createMedia(e)});this.onLoaded()},createMedia:function(e){var t="";if(e.query){var n,t={entry:{},title:"",text:"",extract:"",paragraphs:1,text_array:[]};t.entry=VCO.Util.getObjectAttributeByIndex(e.query.pages,0);t.extract=t.entry.extract;t.title=t.entry.title;t.extract.match("<p>")?t.text_array=t.extract.split("<p>"):t.text_array.push(t.extract);for(var r=0;r<t.text_array.length;r++)r+1<=t.paragraphs&&r+1<t.text_array.length&&(t.text+="<p>"+t.text_array[r+1]);n="<h4><a href='"+this.data.url+"' target='_blank'>"+t.title+"</a></h4>";n+="<span class='wiki-source'>"+VCO.Language.messages.wikipedia+"</span>";n+=t.text;if(!t.extract.match("REDIRECT")){this._el.content_item.innerHTML=n;this.onLoaded()}}}});VCO.Media.YouTube=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){var e=this,t;this.message.updateMessage(VCO.Language.messages.loading+" YouTube");this._el.content_item=VCO.Dom.create("div","vco-media-item vco-media-youtube vco-media-shadow",this._el.content);this._el.content_item.id=VCO.Util.unique_ID(7);t=VCO.Util.getUrlVars(this.data.url);this.media_id={};this.data.url.match("v=")?this.media_id.id=t.v:this.data.url.match("/embed/")?this.media_id.id=this.data.url.split("embed/")[1].split(/[?&]/)[0]:this.data.url.match(/v\/|v=|youtu\.be\//)?this.media_id.id=this.data.url.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]:trace("YOUTUBE IN URL BUT NOT A VALID VIDEO");this.media_id.start=t.t;this.media_id.hd=t.hd;VCO.Load.js("http://www.youtube.com/player_api",function(){trace("YouTube API Library Loaded");e.createMedia()})},_updateMediaDisplay:function(){this._el.content_item.style.height=VCO.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"},createMedia:function(){var e=this;if(typeof this.media_id.start!="undefined"){var t=this.media_id.start.toString(),n=0,r=0;if(t.match("m")){n=parseInt(t.split("m")[0],10);r=parseInt(t.split("m")[1].split("s")[0],10);this.media_id.start=n*60+r}else this.media_id.start=0}else this.media_id.start=0;typeof this.media_id.hd!="undefined"?this.media_id.hd=!0:this.media_id.hd=!1;this.createPlayer()},createPlayer:function(){var e=this;trace("createPlayer");clearTimeout(this.timer);typeof YT!="undefined"&&typeof YT.Player!="undefined"?this.player=new YT.Player(this._el.content_item.id,{playerVars:{enablejsapi:1,color:"white",showinfo:0,theme:"light",start:this.media_id.start,rel:0},videoId:this.media_id.id,events:{onReady:function(){e.onPlayerReady();e.onLoaded()},onStateChange:e.onStateChange}}):this.timer=setTimeout(function(){e.createPlayer()},1e3)},onPlayerReady:function(e){trace("onPlayerReady")},onStateChange:function(e){trace("onStateChange")}});VCO.Media.Slider=VCO.Media.extend({includes:[VCO.Events],_loadMedia:function(){this._el.content_item=VCO.Dom.create("img","vco-media-item vco-media-image",this._el.content);this._el.content_item.src=this.data.url;this.onLoaded()}});VCO.Slide=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t){this._el={container:{},content_container:{},content:{}};this._media=null;this._mediaclass={};this._text={};this._loaded=!1;this.data={uniqueid:null,background:null,date:null,location:null,text:null,media:null};this.options={duration:1e3,ease:VCO.Ease.easeInSpline,width:600,height:600};this.animator={};VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._initLayout();this._initEvents()},show:function(){this.animator=VCO.Animate(this._el.slider_container,{left:-(this._el.container.offsetWidth*n)+"px",duration:this.options.duration,easing:this.options.ease,complete:function(){trace("DONE")}})},hide:function(){},addTo:function(e){e.appendChild(this._el.container)},removeFrom:function(e){e.removeChild(this._el.container)},updateDisplay:function(e,t,n){this._updateDisplay(e,t,n)},_initLayout:function(){this._el.container=VCO.Dom.create("div","vco-slide");this._el.container.id=this.data.uniqueid;this._el.content_container=VCO.Dom.create("div","vco-slide-content-container",this._el.container);this._el.content=VCO.Dom.create("div","vco-slide-content",this._el.content_container);if(this.data.background){if(this.data.background.url){this._el.container.className+=" vco-full-image-background";this._el.container.style.backgroundImage="url('"+this.data.background.url+"')"}this.data.background.color&&(this._el.container.style.backgroundColor=this.data.background.color)}if(this.data.media){this.data.media.mediatype=VCO.MediaType(this.data.media);this._media=new this.data.media.mediatype.cls(this.data.media,this.options);this._media.addTo(this._el.content);this._media.loadMedia()}if(this.data.text){this._text=new VCO.Media.Text(this.data.text);this._text.addTo(this._el.content)}this.onLoaded()},_initEvents:function(){},_updateDisplay:function(e,t,n){e?this.options.width=e:this.options.width=this._el.container.offsetWidth;t?this.options.height=t:this.options.height=this._el.container.offsetHeight;this._media&&this._media.updateDisplay(this.options.width,this.options.height)}});VCO.SlideNav=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={container:{},content_container:{},icon:{},title:{},description:{}};this.mediatype={};this.data={title:"Navigation",description:"Description"};this.options={direction:"previous"};this.animator=null;VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._el.container=VCO.Dom.create("div","vco-slidenav-"+this.options.direction);this._initLayout();this._initEvents();n&&n.appendChild(this._el.container)},update:function(e){this._update(e)},_onMouseClick:function(){this.fire("clicked",this.options)},_update:function(e){this.data=VCO.Util.mergeData(this.data,e);this.data.title!=""&&(this._el.title.innerHTML=this.data.title);this.data.date!=""&&(this._el.description.innerHTML=this.data.description)},_initLayout:function(){this._el.content_container=VCO.Dom.create("div","vco-slidenav-content-container",this._el.container);this._el.icon=VCO.Dom.create("div","vco-slidenav-icon",this._el.content_container);this._el.title=VCO.Dom.create("div","vco-slidenav-title",this._el.content_container);this._el.description=VCO.Dom.create("div","vco-slidenav-description",this._el.content_container);this._el.icon.innerHTML="&nbsp;";this._update()},_initEvents:function(){VCO.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this)}});VCO.StorySlider=VCO.Class.extend({includes:VCO.Events,initialize:function(e,t,n,r){this._el={container:{},slider_container_mask:{},slider_container:{},slider_item_container:{}};this._nav={};this._nav.previous={};this._nav.next={};this._slides=[];this.current_slide=0;this.data={uniqueid:"",slides:[{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Slideshow Example",text:"Example slideshow slide "},media:[{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",text:{headline:"Slideshow Example",text:""},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"",caption:"",link:null,link_target:null}}]},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"YouTube",text:"Just add a link to the video in the media field."},media:{url:"http://www.youtube.com/watch?v=lIvftGgps24",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Wikipedia",text:"Just add a link to the video in the media field."},media:{url:"http://en.wikipedia.org/wiki/Mark_Twain",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Storify",text:"Just add a link to the video in the media field."},media:{url:"https://storify.com/kqednews/art-at-burning-man-2013",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",background:{url:"https://secure-b.vimeocdn.com/ts/225/276/225276903_960.jpg",color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Vimeo",text:"Just add a link to the video in the media field."},media:{url:"https://vimeo.com/33211636",credit:"",caption:"",link:null,link_target:null}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"iFrame",text:""},media:{url:"<iframe src='http://www.w3schools.com'></iframe>",credit:"",caption:"w3schools",link:null,link_target:null}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Flickr",text:""},media:{url:"http://www.flickr.com/photos/neera/6147067542/",credit:"Nosy Iranja",caption:"",link:"http://www.flickr.com/photos/neera/6147067542/",link_target:"_self"}},{uniqueid:"",background:{url:null,color:"#8b4513",opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Flickr",text:""},media:{url:"https://twitter.com/ThisAmerLife/status/374975945825722368"}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:null,media:{url:"http://www.flickr.com/photos/neera/6147067542/",credit:"Nosy Iranja",caption:""}},{uniqueid:"",background:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",color:"#cdbfe3",opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"La Lune",text:""},media:{url:"https://soundcloud.com/beastieboys/make-some-noise",credit:null,caption:null}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:null,media:{url:"https://soundcloud.com/beastieboys/make-some-noise",credit:null,caption:null}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:null,media:{url:"https://vine.co/v/bjHh0zHdgZT",credit:null,caption:null}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:null,location:{lat:-9.143962,lon:38.731094,zoom:13,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:null,media:{url:"http://www.flickr.com/photos/neera/6147067542/",credit:"Nosy Iranja",caption:""}}]};this.options={id:"",width:600,height:600,start_at_slide:1,duration:1e3,ease:VCO.Ease.easeInOutQuint,dragging:!0,trackResize:!0};if(typeof e=="object"){this._el.container=e;this.options.id=VCO.Util.unique_ID(6,"vco")}else{this.options.id=e;this._el.container=VCO.Dom.get(e)}this._el.container.id||(this._el.container.id=this.options.id);this.animator=null;VCO.Util.mergeData(this.options,n);VCO.Util.mergeData(this.data,t);r&&this.init()},init:function(){this._initLayout();this._initEvents();this._initData();this._updateDisplay();this.goTo(this.options.start_at_slide);this._onLoaded()},updateDisplay:function(e,t){this._updateDisplay(e,t)},createSlide:function(e){this._createSlide(e)},createSlides:function(e){this._createSlides(e)},_createSlides:function(e){for(var t=0;t<e.length;t++)this._createSlide(e[t])},_createSlide:function(e){var t=new VCO.Slide(e,this.options);this._addSlide(t);this._slides.push(t)},_destroySlide:function(e){this._removeSlide(e);for(var t=0;t<this._slides.length;t++)this._slides[t]==e&&this._slides.splice(t,1)},_addSlide:function(e){e.addTo(this._el.slider_item_container);e.on("added",this._onSlideAdded,this)},_removeSlide:function(e){e.removeFrom(this._el.slider_item_container);e.off("added",this._onSlideAdded,this)},goTo:function(e,t,n){if(e<this._slides.length&&e>=0){this.current_slide=e;this.animator&&this.animator.stop();if(t){this._el.slider_container.style.left=-(this.options.width*e)+"px";this._onSlideChange(n)}else this.animator=VCO.Animate(this._el.slider_container,{left:-(this.options.width*e)+"px",duration:this.options.duration,easing:this.options.ease,complete:this._onSlideChange(n)});if(this._slides[this.current_slide+1]){this._nav.next.show();this._nav.next.update(this.getNavInfo(this._slides[this.current_slide+1]))}else this._nav.next.hide();if(this._slides[this.current_slide-1]){this._nav.previous.show();this._nav.previous.update(this.getNavInfo(this._slides[this.current_slide-1]))}else this._nav.previous.hide()}},getNavInfo:function(e){var t={title:"",description:""};if(e.data.text){e.data.text.headline&&(t.title=e.data.text.headline);e.data.location&&e.data.location.name&&(t.description=e.data.location.name)}return t},next:function(){this.goTo(this.current_slide+1)},previous:function(){this.goTo(this.current_slide-1)},_updateDisplay:function(e,t,n){var r;e?this.options.width=e:this.options.width=this._el.container.offsetWidth;t?this.options.height=t:this.options.height=this._el.container.offsetHeight;r=this.options.height/2;this._nav.next.setPosition({top:r});this._nav.previous.setPosition({top:r});for(var i=0;i<this._slides.length;i++){this._slides[i].updateDisplay(this.options.width,this.options.height);this._slides[i].setPosition({left:this.options.width*i,top:0})}this.goTo(this.current_slide,!0,!0)},_initLayout:function(){trace("initLayout "+this.options.id);this._el.container.className+=" vco-storyslider";this._el.slider_container_mask=VCO.Dom.create("div","vco-slider-container-mask",this._el.container);this._el.slider_container=VCO.Dom.create("div","vco-slider-container vcoanimate",this._el.slider_container_mask);this._el.slider_item_container=VCO.Dom.create("div","vco-slider-item-container",this._el.slider_container);this.options.width=this._el.container.offsetWidth;this.options.height=this._el.container.offsetHeight;this._nav.previous=new VCO.SlideNav({title:"Previous",description:"description"},{direction:"previous"});this._nav.next=new VCO.SlideNav({title:"Next",description:"description"},{direction:"next"});this._nav.next.addTo(this._el.container);this._nav.previous.addTo(this._el.container);this._el.slider_container.style.left="0px"},_initEvents:function(){this._nav.next.on("clicked",this._onNavigation,this);this._nav.previous.on("clicked",this._onNavigation,this)},_initData:function(){this._createSlides(this.data.slides)},_onNavigation:function(e){e.direction=="next"?this.next():e.direction=="previous"&&this.previous();this.fire("nav_"+e.direction,this.data)},_onSlideAdded:function(e){this.fire("slideAdded",this.data)},_onSlideRemoved:function(e){this.fire("slideAdded",this.data)},_onSlideChange:function(e){e||this.fire("change",{current_slide:this.current_slide})},_onMouseClick:function(e){},_fireMouseEvent:function(e){if(!this._loaded)return;var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t))return;t==="contextmenu"&&VCO.DomEvent.preventDefault(e);this.fire(t,{latlng:"something",layerPoint:"something else"})},_onLoaded:function(){this.fire("loaded",this.data)}});(function(e,t,n){var r=e.L,i={};i.version="0.6.4";typeof module=="object"&&typeof module.exports=="object"?module.exports=i:typeof define=="function"&&define.amd&&define(i);i.noConflict=function(){e.L=r;return this};e.L=i;i.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1),n,r,i,s;for(r=0,i=t.length;r<i;r++){s=t[r]||{};for(n in s)s.hasOwnProperty(n)&&(e[n]=s[n])}return e},bind:function(e,t){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return e.apply(t,n||arguments)}},stamp:function(){var e=0,t="_leaflet_id";return function(n){n[t]=n[t]||++e;return n[t]}}(),invokeEach:function(e,t,n){var r,i;if(typeof e=="object"){i=Array.prototype.slice.call(arguments,3);for(r in e)t.apply(n,[r,e[r]].concat(i));return!0}return!1},limitExecByInterval:function(e,t,n){var r,i;return function s(){var o=arguments;if(r){i=!0;return}r=!0;setTimeout(function(){r=!1;if(i){s.apply(n,o);i=!1}},t);e.apply(n,o)}},falseFn:function(){return!1},formatNum:function(e,t){var n=Math.pow(10,t||5);return Math.round(e*n)/n},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},splitWords:function(e){return i.Util.trim(e).split(/\s+/)},setOptions:function(e,t){e.options=i.extend({},e.options,t);return e.options},getParamString:function(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(!t||t.indexOf("?")===-1?"?":"&")+r.join("&")},template:function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,r){var i=t[r];if(i===n)throw new Error("No value provided for variable "+e);typeof i=="function"&&(i=i(t));return i})},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function t(t){var n,r,i=["webkit","moz","o","ms"];for(n=0;n<i.length&&!r;n++)r=e[i[n]+t];return r}function r(t){var r=+(new Date),i=Math.max(0,16-(r-n));n=r+i;return e.setTimeout(t,i)}var n=0,s=e.requestAnimationFrame||t("RequestAnimationFrame")||r,o=e.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(t){e.clearTimeout(t)};i.Util.requestAnimFrame=function(t,n,o,u){t=i.bind(t,n);if(!o||s!==r)return s.call(e,t,u);t()};i.Util.cancelAnimFrame=function(t){t&&o.call(e,t)}})();i.extend=i.Util.extend;i.bind=i.Util.bind;i.stamp=i.Util.stamp;i.setOptions=i.Util.setOptions;i.Class=function(){};i.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments);this._initHooks&&this.callInitHooks()},n=function(){};n.prototype=this.prototype;var r=new n;r.constructor=t;t.prototype=r;for(var s in this)this.hasOwnProperty(s)&&s!=="prototype"&&(t[s]=this[s]);if(e.statics){i.extend(t,e.statics);delete e.statics}if(e.includes){i.Util.extend.apply(null,[r].concat(e.includes));delete e.includes}e.options&&r.options&&(e.options=i.extend({},r.options,e.options));i.extend(r,e);r._initHooks=[];var o=this;t.__super__=o.prototype;r.callInitHooks=function(){if(this._initHooksCalled)return;o.prototype.callInitHooks&&o.prototype.callInitHooks.call(this);this._initHooksCalled=!0;for(var e=0,t=r._initHooks.length;e<t;e++)r._initHooks[e].call(this)};return t};i.Class.include=function(e){i.extend(this.prototype,e)};i.Class.mergeOptions=function(e){i.extend(this.prototype.options,e)};i.Class.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n=typeof e=="function"?e:function(){this[e].apply(this,t)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(n)};var s="_leaflet_events";i.Mixin={};i.Mixin.Events={addEventListener:function(e,t,n){if(i.Util.invokeEach(e,this.addEventListener,this,t,n))return this;var r=this[s]=this[s]||{},o=n&&i.stamp(n),u,a,f,l,c,h,p;e=i.Util.splitWords(e);for(u=0,a=e.length;u<a;u++){f={action:t,context:n||this};l=e[u];if(n){c=l+"_idx";h=c+"_len";p=r[c]=r[c]||{};if(!p[o]){p[o]=[];r[h]=(r[h]||0)+1}p[o].push(f)}else{r[l]=r[l]||[];r[l].push(f)}}return this},hasEventListeners:function(e){var t=this[s];return!!t&&(e in t&&t[e].length>0||e+"_idx"in t&&t[e+"_idx_len"]>0)},removeEventListener:function(e,t,n){if(!this[s])return this;if(!e)return this.clearAllEventListeners();if(i.Util.invokeEach(e,this.removeEventListener,this,t,n))return this;var r=this[s],o=n&&i.stamp(n),u,a,f,l,c,h,p,d,v;e=i.Util.splitWords(e);for(u=0,a=e.length;u<a;u++){f=e[u];h=f+"_idx";p=h+"_len";d=r[h];if(!t){delete r[f];delete r[h]}else{l=n&&d?d[o]:r[f];if(l){for(c=l.length-1;c>=0;c--)if(l[c].action===t&&(!n||l[c].context===n)){v=l.splice(c,1);v[0].action=i.Util.falseFn}if(n&&d&&l.length===0){delete d[o];r[p]--}}}}return this},clearAllEventListeners:function(){delete this[s];return this},fireEvent:function(e,t){if(!this.hasEventListeners(e))return this;var n=i.Util.extend({},t,{type:e,target:this}),r=this[s],o,u,a,f,l;if(r[e]){o=r[e].slice();for(u=0,a=o.length;u<a;u++)o[u].action.call(o[u].context||this,n)}f=r[e+"_idx"];for(l in f){o=f[l].slice();if(o)for(u=0,a=o.length;u<a;u++)o[u].action.call(o[u].context||this,n)}return this},addOneTimeEventListener:function(e,t,n){if(i.Util.invokeEach(e,this.addOneTimeEventListener,this,t,n))return this;var r=i.bind(function(){this.removeEventListener(e,t,n).removeEventListener(e,r,n)},this);return this.addEventListener(e,t,n).addEventListener(e,r,n)}};i.Mixin.Events.on=i.Mixin.Events.addEventListener;i.Mixin.Events.off=i.Mixin.Events.removeEventListener;i.Mixin.Events.once=i.Mixin.Events.addOneTimeEventListener;i.Mixin.Events.fire=i.Mixin.Events.fireEvent;(function(){var r=!!e.ActiveXObject,s=r&&!e.XMLHttpRequest,o=r&&!t.querySelector,u=r&&!t.addEventListener,a=navigator.userAgent.toLowerCase(),f=a.indexOf("webkit")!==-1,l=a.indexOf("chrome")!==-1,c=a.indexOf("phantom")!==-1,h=a.indexOf("android")!==-1,p=a.search("android [23]")!==-1,d=typeof orientation!=n+"",v=e.navigator&&e.navigator.msPointerEnabled&&e.navigator.msMaxTouchPoints,m="devicePixelRatio"in e&&e.devicePixelRatio>1||"matchMedia"in e&&e.matchMedia("(min-resolution:144dpi)")&&e.matchMedia("(min-resolution:144dpi)").matches,g=t.documentElement,y=r&&"transition"in g.style,b="WebKitCSSMatrix"in e&&"m11"in new e.WebKitCSSMatrix,w="MozPerspective"in g.style,E="OTransition"in g.style,S=!e.L_DISABLE_3D&&(y||b||w||E)&&!c,x=!e.L_NO_TOUCH&&!c&&function(){var e="ontouchstart";if(v||e in g)return!0;var n=t.createElement("div"),r=!1;if(!n.setAttribute)return!1;n.setAttribute(e,"return;");typeof n[e]=="function"&&(r=!0);n.removeAttribute(e);n=null;return r}();i.Browser={ie:r,ie6:s,ie7:o,ielt9:u,webkit:f,android:h,android23:p,chrome:l,ie3d:y,webkit3d:b,gecko3d:w,opera3d:E,any3d:S,mobile:d,mobileWebkit:d&&f,mobileWebkit3d:d&&b,mobileOpera:d&&e.opera,touch:x,msTouch:v,retina:m}})();i.Point=function(e,t,n){this.x=n?Math.round(e):e;this.y=n?Math.round(t):t};i.Point.prototype={clone:function(){return new i.Point(this.x,this.y)},add:function(e){return this.clone()._add(i.point(e))},_add:function(e){this.x+=e.x;this.y+=e.y;return this},subtract:function(e){return this.clone()._subtract(i.point(e))},_subtract:function(e){this.x-=e.x;this.y-=e.y;return this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){this.x/=e;this.y/=e;return this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){this.x*=e;this.y*=e;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(e){e=i.point(e);var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){e=i.point(e);return e.x===this.x&&e.y===this.y},contains:function(e){e=i.point(e);return Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+i.Util.formatNum(this.x)+", "+i.Util.formatNum(this.y)+")"}};i.point=function(e,t,r){return e instanceof i.Point?e:i.Util.isArray(e)?new i.Point(e[0],e[1]):e===n||e===null?e:new i.Point(e,t,r)};i.Bounds=function(e,t){if(!e)return;var n=t?[e,t]:e;for(var r=0,i=n.length;r<i;r++)this.extend(n[r])};i.Bounds.prototype={extend:function(e){e=i.point(e);if(!this.min&&!this.max){this.min=e.clone();this.max=e.clone()}else{this.min.x=Math.min(e.x,this.min.x);this.max.x=Math.max(e.x,this.max.x);this.min.y=Math.min(e.y,this.min.y);this.max.y=Math.max(e.y,this.max.y)}return this},getCenter:function(e){return new i.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new i.Point(this.min.x,this.max.y)},getTopRight:function(){return new i.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;typeof e[0]=="number"||e instanceof i.Point?e=i.point(e):e=i.bounds(e);if(e instanceof i.Bounds){t=e.min;n=e.max}else t=n=e;return t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=i.bounds(e);var t=this.min,n=this.max,r=e.min,s=e.max,o=s.x>=t.x&&r.x<=n.x,u=s.y>=t.y&&r.y<=n.y;return o&&u},isValid:function(){return!!this.min&&!!this.max}};i.bounds=function(e,t){return!e||e instanceof i.Bounds?e:new i.Bounds(e,t)};i.Transformation=function(e,t,n,r){this._a=e;this._b=t;this._c=n;this._d=r};i.Transformation.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){t=t||1;e.x=t*(this._a*e.x+this._b);e.y=t*(this._c*e.y+this._d);return e},untransform:function(e,t){t=t||1;return new i.Point((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};i.DomUtil={get:function(e){return typeof e=="string"?t.getElementById(e):e},getStyle:function(e,n){var r=e.style[n];!r&&e.currentStyle&&(r=e.currentStyle[n]);if((!r||r==="auto")&&t.defaultView){var i=t.defaultView.getComputedStyle(e,null);r=i?i[n]:null}return r==="auto"?null:r},getViewportOffset:function(e){var n=0,r=0,s=e,o=t.body,u=t.documentElement,a,f=i.Browser.ie7;do{n+=s.offsetTop||0;r+=s.offsetLeft||0;n+=parseInt(i.DomUtil.getStyle(s,"borderTopWidth"),10)||0;r+=parseInt(i.DomUtil.getStyle(s,"borderLeftWidth"),10)||0;a=i.DomUtil.getStyle(s,"position");if(s.offsetParent===o&&a==="absolute")break;if(a==="fixed"){n+=o.scrollTop||u.scrollTop||0;r+=o.scrollLeft||u.scrollLeft||0;break}if(a==="relative"&&!s.offsetLeft){var l=i.DomUtil.getStyle(s,"width"),c=i.DomUtil.getStyle(s,"max-width"),h=s.getBoundingClientRect();if(l!=="none"||c!=="none")r+=h.left+s.clientLeft;n+=h.top+(o.scrollTop||u.scrollTop||0);break}s=s.offsetParent}while(s);s=e;do{if(s===o)break;n-=s.scrollTop||0;r-=s.scrollLeft||0;if(!i.DomUtil.documentIsLtr()&&(i.Browser.webkit||f)){r+=s.scrollWidth-s.clientWidth;f&&i.DomUtil.getStyle(s,"overflow-y")!=="hidden"&&i.DomUtil.getStyle(s,"overflow")!=="hidden"&&(r+=17)}s=s.parentNode}while(s);return new i.Point(r,n)},documentIsLtr:function(){if(!i.DomUtil._docIsLtrCached){i.DomUtil._docIsLtrCached=!0;i.DomUtil._docIsLtr=i.DomUtil.getStyle(t.body,"direction")==="ltr"}return i.DomUtil._docIsLtr},create:function(e,n,r){var i=t.createElement(e);i.className=n;r&&r.appendChild(i);return i},hasClass:function(e,t){return e.className.length>0&&(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(e.className)},addClass:function(e,t){i.DomUtil.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},removeClass:function(e,t){e.className=i.Util.trim((" "+e.className+" ").replace(" "+t+" "," "))},setOpacity:function(e,t){if("opacity"in e.style)e.style.opacity=t;else if("filter"in e.style){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(r)}catch(i){if(t===1)return}t=Math.round(t*100);if(n){n.Enabled=t!==100;n.Opacity=t}else e.style.filter+=" progid:"+r+"(opacity="+t+")"}},testProp:function(e){var n=t.
documentElement.style;for(var r=0;r<e.length;r++)if(e[r]in n)return e[r];return!1},getTranslateString:function(e){var t=i.Browser.webkit3d,n="translate"+(t?"3d":"")+"(",r=(t?",0":"")+")";return n+e.x+"px,"+e.y+"px"+r},getScaleString:function(e,t){var n=i.DomUtil.getTranslateString(t.add(t.multiplyBy(-1*e))),r=" scale("+e+") ";return n+r},setPosition:function(e,t,n){e._leaflet_pos=t;if(!n&&i.Browser.any3d){e.style[i.DomUtil.TRANSFORM]=i.DomUtil.getTranslateString(t);i.Browser.mobileWebkit3d&&(e.style.WebkitBackfaceVisibility="hidden")}else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){return e._leaflet_pos}};i.DomUtil.TRANSFORM=i.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);i.DomUtil.TRANSITION=i.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);i.DomUtil.TRANSITION_END=i.DomUtil.TRANSITION==="webkitTransition"||i.DomUtil.TRANSITION==="OTransition"?i.DomUtil.TRANSITION+"End":"transitionend";(function(){var n=i.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);i.extend(i.DomUtil,{disableTextSelection:function(){i.DomEvent.on(e,"selectstart",i.DomEvent.preventDefault);if(n){var r=t.documentElement.style;this._userSelect=r[n];r[n]="none"}},enableTextSelection:function(){i.DomEvent.off(e,"selectstart",i.DomEvent.preventDefault);if(n){t.documentElement.style[n]=this._userSelect;delete this._userSelect}},disableImageDrag:function(){i.DomEvent.on(e,"dragstart",i.DomEvent.preventDefault)},enableImageDrag:function(){i.DomEvent.off(e,"dragstart",i.DomEvent.preventDefault)}})})();i.LatLng=function(e,t){var n=parseFloat(e),r=parseFloat(t);if(isNaN(n)||isNaN(r))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=n;this.lng=r};i.extend(i.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});i.LatLng.prototype={equals:function(e){if(!e)return!1;e=i.latLng(e);var t=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return t<=i.LatLng.MAX_MARGIN},toString:function(e){return"LatLng("+i.Util.formatNum(this.lat,e)+", "+i.Util.formatNum(this.lng,e)+")"},distanceTo:function(e){e=i.latLng(e);var t=6378137,n=i.LatLng.DEG_TO_RAD,r=(e.lat-this.lat)*n,s=(e.lng-this.lng)*n,o=this.lat*n,u=e.lat*n,a=Math.sin(r/2),f=Math.sin(s/2),l=a*a+f*f*Math.cos(o)*Math.cos(u);return t*2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))},wrap:function(e,t){var n=this.lng;e=e||-180;t=t||180;n=(n+t)%(t-e)+(n<e||n===t?t:e);return new i.LatLng(this.lat,n)}};i.latLng=function(e,t){return e instanceof i.LatLng?e:i.Util.isArray(e)?new i.LatLng(e[0],e[1]):e===n||e===null?e:typeof e=="object"&&"lat"in e?new i.LatLng(e.lat,"lng"in e?e.lng:e.lon):new i.LatLng(e,t)};i.LatLngBounds=function(e,t){if(!e)return;var n=t?[e,t]:e;for(var r=0,i=n.length;r<i;r++)this.extend(n[r])};i.LatLngBounds.prototype={extend:function(e){if(!e)return this;typeof e[0]=="number"||typeof e[0]=="string"||e instanceof i.LatLng?e=i.latLng(e):e=i.latLngBounds(e);if(e instanceof i.LatLng)if(!this._southWest&&!this._northEast){this._southWest=new i.LatLng(e.lat,e.lng);this._northEast=new i.LatLng(e.lat,e.lng)}else{this._southWest.lat=Math.min(e.lat,this._southWest.lat);this._southWest.lng=Math.min(e.lng,this._southWest.lng);this._northEast.lat=Math.max(e.lat,this._northEast.lat);this._northEast.lng=Math.max(e.lng,this._northEast.lng)}else if(e instanceof i.LatLngBounds){this.extend(e._southWest);this.extend(e._northEast)}return this},pad:function(e){var t=this._southWest,n=this._northEast,r=Math.abs(t.lat-n.lat)*e,s=Math.abs(t.lng-n.lng)*e;return new i.LatLngBounds(new i.LatLng(t.lat-r,t.lng-s),new i.LatLng(n.lat+r,n.lng+s))},getCenter:function(){return new i.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new i.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new i.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof i.LatLng?e=i.latLng(e):e=i.latLngBounds(e);var t=this._southWest,n=this._northEast,r,s;if(e instanceof i.LatLngBounds){r=e.getSouthWest();s=e.getNorthEast()}else r=s=e;return r.lat>=t.lat&&s.lat<=n.lat&&r.lng>=t.lng&&s.lng<=n.lng},intersects:function(e){e=i.latLngBounds(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),s=e.getNorthEast(),o=s.lat>=t.lat&&r.lat<=n.lat,u=s.lng>=t.lng&&r.lng<=n.lng;return o&&u},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e){if(!e)return!1;e=i.latLngBounds(e);return this._southWest.equals(e.getSouthWest())&&this._northEast.equals(e.getNorthEast())},isValid:function(){return!!this._southWest&&!!this._northEast}};i.latLngBounds=function(e,t){return!e||e instanceof i.LatLngBounds?e:new i.LatLngBounds(e,t)};i.Projection={};i.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(e){var t=i.LatLng.DEG_TO_RAD,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),s=e.lng*t,o=r*t;o=Math.log(Math.tan(Math.PI/4+o/2));return new i.Point(s,o)},unproject:function(e){var t=i.LatLng.RAD_TO_DEG,n=e.x*t,r=(2*Math.atan(Math.exp(e.y))-Math.PI/2)*t;return new i.LatLng(r,n)}};i.Projection.LonLat={project:function(e){return new i.Point(e.lng,e.lat)},unproject:function(e){return new i.LatLng(e.y,e.x)}};i.CRS={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},scale:function(e){return 256*Math.pow(2,e)}};i.CRS.Simple=i.extend({},i.CRS,{projection:i.Projection.LonLat,transformation:new i.Transformation(1,0,-1,0),scale:function(e){return Math.pow(2,e)}});i.CRS.EPSG3857=i.extend({},i.CRS,{code:"EPSG:3857",projection:i.Projection.SphericalMercator,transformation:new i.Transformation(.5/Math.PI,.5,-0.5/Math.PI,.5),project:function(e){var t=this.projection.project(e),n=6378137;return t.multiplyBy(n)}});i.CRS.EPSG900913=i.extend({},i.CRS.EPSG3857,{code:"EPSG:900913"});i.CRS.EPSG4326=i.extend({},i.CRS,{code:"EPSG:4326",projection:i.Projection.LonLat,transformation:new i.Transformation(1/360,.5,-1/360,.5)});i.Map=i.Class.extend({includes:i.Mixin.Events,options:{crs:i.CRS.EPSG3857,fadeAnimation:i.DomUtil.TRANSITION&&!i.Browser.android23,trackResize:!0,markerZoomAnimation:i.DomUtil.TRANSITION&&i.Browser.any3d},initialize:function(e,t){t=i.setOptions(this,t);this._initContainer(e);this._initLayout();this._initEvents();t.maxBounds&&this.setMaxBounds(t.maxBounds);t.center&&t.zoom!==n&&this.setView(i.latLng(t.center),t.zoom,{reset:!0});this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(t.layers)},setView:function(e,t){this._resetView(i.latLng(e),this._limitZoom(t));return this},setZoom:function(e,t){return this.setView(this.getCenter(),e,{zoom:t})},zoomIn:function(e,t){return this.setZoom(this._zoom+(e||1),t)},zoomOut:function(e,t){return this.setZoom(this._zoom-(e||1),t)},setZoomAround:function(e,t,n){var r=this.getZoomScale(t),s=this.getSize().divideBy(2),o=e instanceof i.Point?e:this.latLngToContainerPoint(e),u=o.subtract(s).multiplyBy(1-1/r),a=this.containerPointToLatLng(s.add(u));return this.setView(a,t,{zoom:n})},fitBounds:function(e,t){t=t||{};e=e.getBounds?e.getBounds():i.latLngBounds(e);var n=i.point(t.paddingTopLeft||t.padding||[0,0]),r=i.point(t.paddingBottomRight||t.padding||[0,0]),s=this.getBoundsZoom(e,!1,n.add(r)),o=r.subtract(n).divideBy(2),u=this.project(e.getSouthWest(),s),a=this.project(e.getNorthEast(),s),f=this.unproject(u.add(a).divideBy(2).add(o),s);return this.setView(f,s,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e){this.fire("movestart");this._rawPanBy(i.point(e));this.fire("move");return this.fire("moveend")},setMaxBounds:function(e,t){e=i.latLngBounds(e);this.options.maxBounds=e;if(!e){this._boundsMinZoom=null;this.off("moveend",this._panInsideMaxBounds,this);return this}var n=this.getBoundsZoom(e,!0);this._boundsMinZoom=n;this._loaded&&(this._zoom<n?this.setView(e.getCenter(),n,t):this.panInsideBounds(e));this.on("moveend",this._panInsideMaxBounds,this);return this},panInsideBounds:function(e){e=i.latLngBounds(e);var t=this.getPixelBounds(),n=t.getBottomLeft(),r=t.getTopRight(),s=this.project(e.getSouthWest()),o=this.project(e.getNorthEast()),u=0,a=0;r.y<o.y&&(a=Math.ceil(o.y-r.y));r.x>o.x&&(u=Math.floor(o.x-r.x));n.y>s.y&&(a=Math.floor(s.y-n.y));n.x<s.x&&(u=Math.ceil(s.x-n.x));return u||a?this.panBy([u,a]):this},addLayer:function(e){var t=i.stamp(e);if(this._layers[t])return this;this._layers[t]=e;if(e.options&&(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))){this._zoomBoundLayers[t]=e;this._updateZoomLevels()}if(this.options.zoomAnimation&&i.TileLayer&&e instanceof i.TileLayer){this._tileLayersNum++;this._tileLayersToLoad++;e.on("load",this._onTileLayerLoad,this)}this._loaded&&this._layerAdd(e);return this},removeLayer:function(e){var t=i.stamp(e);if(!this._layers[t])return;this._loaded&&e.onRemove(this);delete this._layers[t];this._loaded&&this.fire("layerremove",{layer:e});if(this._zoomBoundLayers[t]){delete this._zoomBoundLayers[t];this._updateZoomLevels()}if(this.options.zoomAnimation&&i.TileLayer&&e instanceof i.TileLayer){this._tileLayersNum--;this._tileLayersToLoad--;e.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(e){return e?i.stamp(e)in this._layers:!1},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},invalidateSize:function(e){e=i.extend({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0;this.options.maxBounds&&this.setMaxBounds(this.options.maxBounds);if(!this._loaded)return this;var n=this.getSize(),r=t.subtract(n).divideBy(2).round();if(!r.x&&!r.y)return this;if(e.animate&&e.pan)this.panBy(r);else{e.pan&&this._rawPanBy(r);this.fire("move");clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(i.bind(this.fire,this,"moveend"),200)}return this.fire("resize",{oldSize:t,newSize:n})},addHandler:function(e,t){if(!t)return;var n=this[e]=new t(this);this._handlers.push(n);this.options[e]&&n.enable();return this},remove:function(){this._loaded&&this.fire("unload");this._initEvents("off");delete this._container._leaflet;this._clearPanes();this._clearControlPos&&this._clearControlPos();this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();return this._moved()?this.layerPointToLatLng(this._getCenterLayerPoint()):this._initialCenter},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),n=this.unproject(e.getTopRight());return new i.LatLngBounds(t,n)},getMinZoom:function(){var e=this._layersMinZoom===n?0:this._layersMinZoom,t=this._boundsMinZoom===n?0:this._boundsMinZoom;return this.options.minZoom===n?Math.max(e,t):this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===n?this._layersMaxZoom===n?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=i.latLngBounds(e);var r=this.getMinZoom()-(t?1:0),s=this.getMaxZoom(),o=this.getSize(),u=e.getNorthWest(),a=e.getSouthEast(),f=!0,l;n=i.point(n||[0,0]);do{r++;l=this.project(a,r).subtract(this.project(u,r)).add(n);f=t?l.x<o.x||l.y<o.y:o.contains(l)}while(f&&r<=s);return f&&t?null:t?r:r-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new i.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=!1}return this._size.clone()},getPixelBounds:function(){var e=this._getTopLeftPoint();return new i.Bounds(e,e.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e){var t=this.options.crs;return t.scale(e)/t.scale(this._zoom)},getScaleZoom:function(e){return this._zoom+Math.log(e)/Math.LN2},project:function(e,t){t=t===n?this._zoom:t;return this.options.crs.latLngToPoint(i.latLng(e),t)},unproject:function(e,t){t=t===n?this._zoom:t;return this.options.crs.pointToLatLng(i.point(e),t)},layerPointToLatLng:function(e){var t=i.point(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(i.latLng(e))._round();return t._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(e){return i.point(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return i.point(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(i.point(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(i.latLng(e)))},mouseEventToContainerPoint:function(e){return i.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=i.DomUtil.get(e);if(!t)throw new Error("Map container not found.");if(t._leaflet)throw new Error("Map container is already initialized.");t._leaflet=!0},_initLayout:function(){var e=this._container;i.DomUtil.addClass(e,"leaflet-container"+(i.Browser.touch?" leaflet-touch":"")+(i.Browser.retina?" leaflet-retina":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var t=i.DomUtil.getStyle(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(e.style.position="relative");this._initPanes();this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._mapPane=e.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=e.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);e.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);e.shadowPane=this._createPane("leaflet-shadow-pane");e.overlayPane=this._createPane("leaflet-overlay-pane");e.markerPane=this._createPane("leaflet-marker-pane");e.popupPane=this._createPane("leaflet-popup-pane");var t=" leaflet-zoom-hide";if(!this.options.markerZoomAnimation){i.DomUtil.addClass(e.markerPane,t);i.DomUtil.addClass(e.shadowPane,t);i.DomUtil.addClass(e.popupPane,t)}},_createPane:function(e,t){return i.DomUtil.create("div",e,t||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(e){e=e?i.Util.isArray(e)?e:[e]:[];for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])},_resetView:function(e,t,n,r){var s=this._zoom!==t;if(!r){this.fire("movestart");s&&this.fire("zoomstart")}this._zoom=t;this._initialCenter=e;this._initialTopLeftPoint=this._getNewTopLeftPoint(e);n?this._initialTopLeftPoint._add(this._getMapPanePos()):i.DomUtil.setPosition(this._mapPane,new i.Point(0,0));this._tileLayersToLoad=this._tileLayersNum;var o=!this._loaded;this._loaded=!0;if(o){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("viewreset",{hard:!n});this.fire("move");(s||r)&&this.fire("zoomend");this.fire("moveend",{hard:!n})},_rawPanBy:function(e){i.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var e,t=Infinity,r=-Infinity,i=this._getZoomSpan();for(e in this._zoomBoundLayers){var s=this._zoomBoundLayers[e];isNaN(s.options.minZoom)||(t=Math.min(t,s.options.minZoom));isNaN(s.options.maxZoom)||(r=Math.max(r,s.options.maxZoom))}if(e===n)this._layersMaxZoom=this._layersMinZoom=n;else{this._layersMaxZoom=r;this._layersMinZoom=t}i!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){if(!i.DomEvent)return;t=t||"on";i.DomEvent[t](this._container,"click",this._onMouseClick,this);var n=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],r,s;for(r=0,s=n.length;r<s;r++)i.DomEvent[t](this._container,n[r],this._fireMouseEvent,this);this.options.trackResize&&i.DomEvent[t](e,"resize",this._onResize,this)},_onResize:function(){i.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=i.Util.requestAnimFrame(this.invalidateSize,this,!1,this._container)},_onMouseClick:function(e){if(!this._loaded||!e._simulated&&this.dragging&&this.dragging.moved()||i.DomEvent._skipped(e))return;this.fire("preclick");this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this._loaded||i.DomEvent._skipped(e))return;var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t))return;t==="contextmenu"&&i.DomEvent.preventDefault(e);var n=this.mouseEventToContainerPoint(e),r=this.containerPointToLayerPoint(n),s=this.layerPointToLatLng(r);this.fire(t,{latlng:s,layerPoint:r,containerPoint:n,originalEvent:e})},_onTileLayerLoad:function(){this._tileLayersToLoad--;this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){this._loaded?e.call(t||this,this):this.on("load",e,t);return this},_layerAdd:function(e){e.onAdd(this);this.fire("layeradd",{layer:e})},_getMapPanePos:function(){return i.DomUtil.getPosition(this._mapPane)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewTopLeftPoint(n,t).add(this._getMapPanePos());return this.project(e,t)._subtract(r)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom();return Math.max(t,Math.min(n,e))}});i.map=function(e,t){return new i.Map(e,t)};i.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(e){var t=i.LatLng.DEG_TO_RAD,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),s=this.R_MAJOR,o=this.R_MINOR,u=e.lng*t*s,a=r*t,f=o/s,l=Math.sqrt(1-f*f),c=l*Math.sin(a);c=Math.pow((1-c)/(1+c),l*.5);var h=Math.tan(.5*(Math.PI*.5-a))/c;a=-s*Math.log(h);return new i.Point(u,a)},unproject:function(e){var t=i.LatLng.RAD_TO_DEG,n=this.R_MAJOR,r=this.R_MINOR,s=e.x*t/n,o=r/n,u=Math.sqrt(1-o*o),a=Math.exp(-e.y/n),f=Math.PI/2-2*Math.atan(a),l=15,c=1e-7,h=l,p=.1,d;while(Math.abs(p)>c&&--h>0){d=u*Math.sin(f);p=Math.PI/2-2*Math.atan(a*Math.pow((1-d)/(1+d),.5*u))-f;f+=p}return new i.LatLng(f*t,s)}};i.CRS.EPSG3395=i.extend({},i.CRS,{code:"EPSG:3395",projection:i.Projection.Mercator,transformation:function(){var e=i.Projection.Mercator,t=e.R_MAJOR,n=e.R_MINOR;return new i.Transformation(.5/(Math.PI*t),.5,-0.5/(Math.PI*n),.5)}()});i.TileLayer=i.Class.extend({includes:i.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:i.Browser.mobile,updateWhenIdle:i.Browser.mobile},initialize:function(e,t){t=i.setOptions(this,t);if(t.detectRetina&&i.Browser.retina&&t.maxZoom>0){t.tileSize=Math.floor(t.tileSize/2);t.zoomOffset++;t.minZoom>0&&t.minZoom--;this.options.maxZoom--}t.bounds&&(t.bounds=i.latLngBounds(t.bounds));this._url=e;var n=this.options.subdomains;typeof n=="string"&&(this.options.subdomains=n.split(""))},onAdd:function(e){this._map=e;this._animated=e._zoomAnimated;this._initContainer();this._createTileProto();e.on({viewreset:this._reset,moveend:this._update},this);this._animated&&e.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this);if(!this.options.updateWhenIdle){this._limitedUpdate=i.Util.limitExecByInterval(this._update,150,this);e.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){this._container.parentNode.removeChild(this._container);e.off({viewreset:this._reset,moveend:this._update},this);this._animated&&e.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this);this.options.updateWhenIdle||e.off("move",this._limitedUpdate,this);this._container=null;this._map=null},bringToFront:function(){var e=this._map._panes.tilePane;if(this._container){e.appendChild(this._container);this._setAutoZIndex(e,Math.max)}return this},bringToBack:function(){var e=this._map._panes.tilePane;if(this._container){e.insertBefore(this._container,e.firstChild);this._setAutoZIndex(e,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(e){this.options.opacity=e;this._map&&this._updateOpacity();return this},setZIndex:function(e){this.options.zIndex=e;this._updateZIndex();return this},setUrl:function(e,t){this._url=e;t||this.redraw();return this},redraw:function(){if(this._map){this._reset({hard:!0});this._update()}return this},_updateZIndex:function(){this._container&&this.options.zIndex!==n&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e,t){var n=e.children,r=-t(Infinity,-Infinity),i,s,o;for(s=0,o=n.length;s<o;s++)if(n[s]!==this._container){i=parseInt(n[s].style.zIndex,10);isNaN(i)||(r=t(r,i))}this.options.zIndex=this._container.style.zIndex=(isFinite(r)?r:0)+t(1,-1)},_updateOpacity:function(){var e,t=this._tiles;if(i.Browser.ielt9)for(e in t)i.DomUtil.setOpacity(t[e],this.options.opacity);else i.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var e=this._map._panes.tilePane;if(!this._container){this._container=i.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this._animated){var t="leaflet-tile-container leaflet-zoom-animated";this._bgBuffer=i.DomUtil.create("div",t,this._container);this._tileContainer=i.DomUtil.create("div",t,this._container)}else this._tileContainer=this._container;e.appendChild(this._container);this.options.opacity<1&&this._updateOpacity()}},_reset:function(e){for(var t in this._tiles)this.fire("tileunload",{tile:this._tiles[t]});this._tiles={};this._tilesToLoad=0;this.options.reuseTiles&&(this._unusedTiles=[]);this._tileContainer.innerHTML="";this._animated&&e&&e.hard&&this._clearBgBuffer();this._initContainer()},_update:function(){if(!this._map)return;var e=this._map.getPixelBounds(),t=this._map.getZoom(),n=this.options.tileSize;if(t>this.options.maxZoom||t<this.options.minZoom)return;var r=i.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(r);(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(r)},_addTilesFromCenterOut:function(e){var n=[],r=e.getCenter(),s,o,u;for(s=e.min.y;s<=e.max.y;s++)for(o=e.min.x;o<=e.max.x;o++){u=new i.Point(o,s);this._tileShouldBeLoaded(u)&&n.push(u)}var a=n.length;if(a===0)return;n.sort(function(e,t){return e.distanceTo(r)-t.distanceTo(r)});var f=t.createDocumentFragment();this._tilesToLoad||this.fire("loading");this._tilesToLoad+=a;for(o=0;o<a;o++)this._addTile(n[o],f);this._tileContainer.appendChild(f)},_tileShouldBeLoaded:function(e){if(e.x+":"+e.y in this._tiles)return!1;var t=this.options;if(!t.continuousWorld){var n=this._getWrapTileNum();if(t.noWrap&&(e.x<0||e.x>=n)||e.y<0||e.y>=n)return!1}if(t.bounds){var r=t.tileSize,i=e.multiplyBy(r),s=i.add([r,r]),o=this._map.unproject(i),u=this._map.unproject(s);if(!t.continuousWorld&&!t.noWrap){o=o.wrap();u=u.wrap()}if(!t.bounds.intersects([o,u]))return!1}return!0},_removeOtherTiles:function(e){var t,n,r,i;for(i in this._tiles){t=i.split(":");n=parseInt(t[0],10);r=parseInt(t[1],10);(n<e.min.x||n>e.max.x||r<e.min.y||r>e.max.y)&&this._removeTile(i)}},_removeTile:function(e){var t=this._tiles[e];this.fire("tileunload",{tile:t,url:t.src});if(this.options.reuseTiles){i.DomUtil.removeClass(t,"leaflet-tile-loaded");this._unusedTiles.push(t)}else t.parentNode===this._tileContainer&&this._tileContainer.removeChild(t);if(!i.Browser.android){t.onload=null;t.src=i.Util.emptyImageUrl}delete this._tiles[e]},_addTile:function(e,t){var n=this._getTilePos(e),r=this._getTile();i.DomUtil.setPosition(r,n,i.Browser.chrome||i.Browser.android23);this._tiles[e.x+":"+e.y]=r;this._loadTile(r,e);r.parentNode!==this._tileContainer&&t.appendChild(r)},_getZoomForUrl:function(){var e=this.options,t=this._map.getZoom();e.zoomReverse&&(t=e.maxZoom-t);return t+e.zoomOffset},_getTilePos:function(e){var t=this._map.getPixelOrigin(),n=this.options.tileSize;return e.multiplyBy(n).subtract(t)},getTileUrl:function(e){return i.Util.template(this._url,i.extend({s:this._getSubdomain(e),z:e.z,x:e.x,y:e.y},this.options))},_getWrapTileNum:function(){return Math.pow(2,this._getZoomForUrl())},_adjustTilePoint:function(e){var t=this._getWrapTileNum();!this.options.continuousWorld&&!this.options.noWrap&&(e.x=(e.x%t+t)%t);this.options.tms&&(e.y=t-e.y-1);e.z=this._getZoomForUrl()},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_createTileProto:function(){var e=this._tileImg=i.DomUtil.create("img","leaflet-tile");e.style.width=e.style.height=this.options.tileSize+"px";e.galleryimg="no"},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var e=this._unusedTiles.pop();this._resetTile(e);return e}return this._createTile()},_resetTile:function(){},_createTile:function(){var e=this._tileImg.cloneNode(!1);e.onselectstart=e.onmousemove=i.Util.falseFn;i.Browser.ielt9&&this.options.opacity!==n&&i.DomUtil.setOpacity(e,this.options.opacity);return e},_loadTile:function(e,t){e._layer=this;e.onload=this._tileOnLoad;e.onerror=this._tileOnError;this._adjustTilePoint(t);e.src=this.getTileUrl(t)},_tileLoaded:function(){this._tilesToLoad--;if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(i.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var e=this._layer;if(this.src!==i.Util.emptyImageUrl){i.DomUtil.addClass(this,"leaflet-tile-loaded");e.fire("tileload",{tile:this,url:this.src})}e._tileLoaded()},_tileOnError:function(){var e=this._layer;e.fire("tileerror",{tile:this,url:this.src});var t=e.options.errorTileUrl;t&&(this.src=t);e._tileLoaded()}});i.tileLayer=function(e,t){return new i.TileLayer(e,t)};i.TileLayer.WMS=i.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(e,t){this._url=e;var n=i.extend({},this.defaultWmsParams),r=t.tileSize||this.options.tileSize;t.detectRetina&&i.Browser.retina?n.width=n.height=r*2:n.width=n.height=r;for(var s in t)!this.options.hasOwnProperty(s)&&s!=="crs"&&(n[s]=t[s]);this.wmsParams=n;i.setOptions(this,t)},onAdd:function(e){this._crs=this.options.crs||e.options.crs;var t=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code;i.TileLayer.prototype.onAdd.call(this,e)},getTileUrl:function(e,t){var n=this._map,r=this.options.tileSize,s=e.multiplyBy(r),o=s.add([r,r]),u=this._crs.project(n.unproject(s,t)),a=this._crs.project(n.unproject(o,t)),f=[u.x,a.y,a.x,u.y].join(","),l=i.Util.template(this._url,{s:this._getSubdomain(e)});return l+i.Util.getParamString(this.wmsParams,l,!0)+"&BBOX="+f},setParams:function(e,t){i.extend(this.wmsParams,e);t||this.redraw();return this}});i.tileLayer.wms=function(e,t){return new i.TileLayer.WMS(e,t)};i.TileLayer.Canvas=i.TileLayer.extend({options:{async:!1},initialize:function(e){i.setOptions(this,e)},redraw:function(){if(this._map){this._reset({hard:!0});this._update()}for(var e in this._tiles)this._redrawTile(this._tiles[e]);return this},_redrawTile:function(e){this.drawTile(e,e._tilePoint,this._map._zoom)},_createTileProto:function(){var e=this._canvasProto=i.DomUtil.create("canvas","leaflet-tile");e.width=e.height=this.options.tileSize},_createTile:function(){var e=this._canvasProto.cloneNode(!1);e.onselectstart=e.onmousemove=i.Util.falseFn;return e},_loadTile:function(e,t){e._layer=this;e._tilePoint=t;this._redrawTile(e);this.options.async||this.tileDrawn(e)},drawTile:function(){},tileDrawn:function(e){this._tileOnLoad.call(e)}});i.tileLayer.canvas=function(e){return new i.TileLayer.Canvas(e)};i.ImageOverlay=i.Class.extend({includes:i.Mixin.Events,options:{opacity:1},initialize:function(e,t,n){this._url=e;this._bounds=i.latLngBounds(t);i.setOptions(this,n)},onAdd:function(e){this._map=e;this._image||this._initImage();e._panes.overlayPane.appendChild(this._image);e.on("viewreset",this._reset,this);e.options.zoomAnimation&&i.Browser.any3d&&e.on("zoomanim",this._animateZoom,this);this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._image);e.off("viewreset",this._reset,this);e.options.zoomAnimation&&e.off("zoomanim",this._animateZoom,this)},addTo:function(e){e.addLayer(this);return this},setOpacity:function(e){this.options.opacity=e;this._updateOpacity();return this},bringToFront:function(){this._image&&this._map._panes.overlayPane.appendChild(this._image);return this},bringToBack:function(){var e=this._map._panes.overlayPane;this._image&&e.insertBefore(this._image,e.firstChild);return this},_initImage:function(){this._image=i.DomUtil.create("img","leaflet-image-layer");this._map.options.zoomAnimation&&i.Browser.any3d?i.DomUtil.addClass(this._image,"leaflet-zoom-animated"):i.DomUtil.addClass(this._image,"leaflet-zoom-hide");this._updateOpacity();i.extend(this._image,{galleryimg:"no",onselectstart:i.Util.falseFn,onmousemove:i.Util.falseFn,onload:i.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(e){var t=this._map,n=this._image,r=t.getZoomScale(e.zoom),s=this._bounds.getNorthWest(),o=this._bounds.getSouthEast(),u=t._latLngToNewLayerPoint(s,e.zoom,e.center),a=t._latLngToNewLayerPoint(o,e.zoom,e.center)._subtract(u),f=u._add(a._multiplyBy(.5*(1-1/r)));n.style[i.DomUtil.TRANSFORM]=i.DomUtil.getTranslateString(f)+" scale("+r+") "},_reset:function(){var e=this._image,t=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),n=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(t);i.DomUtil.setPosition(e,t);e.style.width=n.x+"px";e.style.height=n.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){i.DomUtil.setOpacity(this._image,this.options.opacity)}});i.imageOverlay=function(e,t,n){return new i.ImageOverlay(e,t,n)};i.Icon=i.Class.extend({options:{className:""},initialize:function(e){i.setOptions(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r;!t||t.tagName!=="IMG"?r=this._createImg(n):r=this._createImg(n,t);this._setIconStyles(r,e);return r},_setIconStyles:function(e,t){var n=this.options,r=i.point(n[t+"Size"]),s;t==="shadow"?s=i.point(n.shadowAnchor||n.iconAnchor):s=i.point(n.iconAnchor);!s&&r&&(s=r.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+n.className;if(s){e.style.marginLeft=-s.x+"px";e.style.marginTop=-s.y+"px"}if(r){e.style.width=r.x+"px";e.style.height=r.y+"px"}},_createImg:function(e,n){if(!i.Browser.ie6){n||(n=t.createElement("img"));n.src=e}else{n||(n=t.createElement("div"));n.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+e+'")'}return n},_getIconUrl:function(e){return i.Browser.retina&&this.options[e+"RetinaUrl"]?this.options[e+"RetinaUrl"]:this.options[e+"Url"]}});i.icon=function(e){return new i.Icon(e)};i.Icon.Default=i.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(e){var t=e+"Url";if(this.options[t])return this.options[t];i.Browser.retina&&e==="icon"&&(e+="-2x");var n=i.Icon.Default.imagePath;if(!n)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually."
);return n+"/marker-"+e+".png"}});i.Icon.Default.imagePath=function(){var e=t.getElementsByTagName("script"),n=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/,r,i,s,o,u;for(r=0,i=e.length;r<i;r++){s=e[r].src;o=s.match(n);if(o){u=s.split(n)[0];return(u?u+"/":"")+"images"}}}();i.Marker=i.Class.extend({includes:i.Mixin.Events,options:{icon:new i.Icon.Default,title:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(e,t){i.setOptions(this,t);this._latlng=i.latLng(e)},onAdd:function(e){this._map=e;e.on("viewreset",this.update,this);this._initIcon();this.update();e.options.zoomAnimation&&e.options.markerZoomAnimation&&e.on("zoomanim",this._animateZoom,this)},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){this.dragging&&this.dragging.disable();this._removeIcon();this._removeShadow();this.fire("remove");e.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(e){this._latlng=i.latLng(e);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(e){this.options.zIndexOffset=e;this.update();return this},setIcon:function(e){this.options.icon=e;if(this._map){this._initIcon();this.update()}return this},update:function(){if(this._icon){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t=this._map,n=t.options.zoomAnimation&&t.options.markerZoomAnimation,r=n?"leaflet-zoom-animated":"leaflet-zoom-hide",s=e.icon.createIcon(this._icon),o=!1;if(s!==this._icon){this._icon&&this._removeIcon();o=!0;e.title&&(s.title=e.title)}i.DomUtil.addClass(s,r);e.keyboard&&(s.tabIndex="0");this._icon=s;this._initInteraction();e.riseOnHover&&i.DomEvent.on(s,"mouseover",this._bringToFront,this).on(s,"mouseout",this._resetZIndex,this);var u=e.icon.createShadow(this._shadow),a=!1;if(u!==this._shadow){this._removeShadow();a=!0}u&&i.DomUtil.addClass(u,r);this._shadow=u;e.opacity<1&&this._updateOpacity();var f=this._map._panes;o&&f.markerPane.appendChild(this._icon);u&&a&&f.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&i.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex);this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow);this._shadow=null},_setPos:function(e){i.DomUtil.setPosition(this._icon,e);this._shadow&&i.DomUtil.setPosition(this._shadow,e);this._zIndex=e.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(e){this._icon.style.zIndex=this._zIndex+e},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPos(t)},_initInteraction:function(){if(!this.options.clickable)return;var e=this._icon,t=["dblclick","mousedown","mouseover","mouseout","contextmenu"];i.DomUtil.addClass(e,"leaflet-clickable");i.DomEvent.on(e,"click",this._onMouseClick,this);i.DomEvent.on(e,"keypress",this._onKeyPress,this);for(var n=0;n<t.length;n++)i.DomEvent.on(e,t[n],this._fireMouseEvent,this);if(i.Handler.MarkerDrag){this.dragging=new i.Handler.MarkerDrag(this);this.options.draggable&&this.dragging.enable()}},_onMouseClick:function(e){var t=this.dragging&&this.dragging.moved();(this.hasEventListeners(e.type)||t)&&i.DomEvent.stopPropagation(e);if(t)return;if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved())return;this.fire(e.type,{originalEvent:e,latlng:this._latlng})},_onKeyPress:function(e){e.keyCode===13&&this.fire("click",{originalEvent:e,latlng:this._latlng})},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e,latlng:this._latlng});e.type==="contextmenu"&&this.hasEventListeners(e.type)&&i.DomEvent.preventDefault(e);e.type!=="mousedown"?i.DomEvent.stopPropagation(e):i.DomEvent.preventDefault(e)},setOpacity:function(e){this.options.opacity=e;this._map&&this._updateOpacity();return this},_updateOpacity:function(){i.DomUtil.setOpacity(this._icon,this.options.opacity);this._shadow&&i.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});i.marker=function(e,t){return new i.Marker(e,t)};i.DivIcon=i.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(e){var n=e&&e.tagName==="DIV"?e:t.createElement("div"),r=this.options;r.html!==!1?n.innerHTML=r.html:n.innerHTML="";r.bgPos&&(n.style.backgroundPosition=-r.bgPos.x+"px "+ -r.bgPos.y+"px");this._setIconStyles(n,"icon");return n},createShadow:function(){return null}});i.divIcon=function(e){return new i.DivIcon(e)};i.Map.mergeOptions({closePopupOnClick:!0});i.Popup=i.Class.extend({includes:i.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(e,t){i.setOptions(this,e);this._source=t;this._animated=i.Browser.any3d&&this.options.zoomAnimation;this._isOpen=!1},onAdd:function(e){this._map=e;this._container||this._initLayout();this._updateContent();var t=e.options.fadeAnimation;t&&i.DomUtil.setOpacity(this._container,0);e._panes.popupPane.appendChild(this._container);e.on(this._getEvents(),this);this._update();t&&i.DomUtil.setOpacity(this._container,1);this.fire("open");e.fire("popupopen",{popup:this});this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(e){e.addLayer(this);return this},openOn:function(e){e.openPopup(this);return this},onRemove:function(e){e._panes.popupPane.removeChild(this._container);i.Util.falseFn(this._container.offsetWidth);e.off(this._getEvents(),this);e.options.fadeAnimation&&i.DomUtil.setOpacity(this._container,0);this._map=null;this.fire("close");e.fire("popupclose",{popup:this});this._source&&this._source.fire("popupclose",{popup:this})},setLatLng:function(e){this._latlng=i.latLng(e);this._update();return this},setContent:function(e){this._content=e;this._update();return this},_getEvents:function(){var e={viewreset:this._updatePosition};this._animated&&(e.zoomanim=this._zoomAnimation);if("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)e.preclick=this._close;this.options.keepInView&&(e.moveend=this._adjustPan);return e},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var e="leaflet-popup",t=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=i.DomUtil.create("div",t),r;if(this.options.closeButton){r=this._closeButton=i.DomUtil.create("a",e+"-close-button",n);r.href="#close";r.innerHTML="&#215;";i.DomEvent.disableClickPropagation(r);i.DomEvent.on(r,"click",this._onCloseButtonClick,this)}var s=this._wrapper=i.DomUtil.create("div",e+"-content-wrapper",n);i.DomEvent.disableClickPropagation(s);this._contentNode=i.DomUtil.create("div",e+"-content",s);i.DomEvent.on(this._contentNode,"mousewheel",i.DomEvent.stopPropagation);i.DomEvent.on(this._contentNode,"MozMousePixelScroll",i.DomEvent.stopPropagation);i.DomEvent.on(s,"contextmenu",i.DomEvent.stopPropagation);this._tipContainer=i.DomUtil.create("div",e+"-tip-container",n);this._tip=i.DomUtil.create("div",e+"-tip",this._tipContainer)},_update:function(){if(!this._map)return;this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_updateContent:function(){if(!this._content)return;if(typeof this._content=="string")this._contentNode.innerHTML=this._content;else{while(this._contentNode.hasChildNodes())this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="";t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth);n=Math.max(n,this.options.minWidth);t.width=n+1+"px";t.whiteSpace="";t.height="";var r=e.offsetHeight,s=this.options.maxHeight,o="leaflet-popup-scrolled";if(s&&r>s){t.height=s+"px";i.DomUtil.addClass(e,o)}else i.DomUtil.removeClass(e,o);this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map)return;var e=this._map.latLngToLayerPoint(this._latlng),t=this._animated,n=i.point(this.options.offset);t&&i.DomUtil.setPosition(this._container,e);this._containerBottom=-n.y-(t?0:e.y);this._containerLeft=-Math.round(this._containerWidth/2)+n.x+(t?0:e.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);i.DomUtil.setPosition(this._container,t)},_adjustPan:function(){if(!this.options.autoPan)return;var e=this._map,t=this._container.offsetHeight,n=this._containerWidth,r=new i.Point(this._containerLeft,-t-this._containerBottom);this._animated&&r._add(i.DomUtil.getPosition(this._container));var s=e.layerPointToContainerPoint(r),o=i.point(this.options.autoPanPadding),u=e.getSize(),a=0,f=0;s.x+n>u.x&&(a=s.x+n-u.x+o.x);s.x-a<0&&(a=s.x-o.x);s.y+t>u.y&&(f=s.y+t-u.y+o.y);s.y-f<0&&(f=s.y-o.y);(a||f)&&e.fire("autopanstart").panBy([a,f])},_onCloseButtonClick:function(e){this._close();i.DomEvent.stop(e)}});i.popup=function(e,t){return new i.Popup(e,t)};i.Map.include({openPopup:function(e,t,n){this.closePopup();if(!(e instanceof i.Popup)){var r=e;e=(new i.Popup(n)).setLatLng(t).setContent(r)}e._isOpen=!0;this._popup=e;return this.addLayer(e)},closePopup:function(e){if(!e||e===this._popup){e=this._popup;this._popup=null}if(e){this.removeLayer(e);e._isOpen=!1}return this}});i.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup)}return this},closePopup:function(){this._popup&&this._popup._close();return this},togglePopup:function(){this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup());return this},bindPopup:function(e,t){var n=i.point(this.options.icon.options.popupAnchor||[0,0]);n=n.add(i.Popup.prototype.options.offset);t&&t.offset&&(n=n.add(t.offset));t=i.extend({offset:n},t);this._popup||this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this);if(e instanceof i.Popup){i.setOptions(e,t);this._popup=e}else this._popup=(new i.Popup(t,this)).setContent(e);return this},setPopupContent:function(e){this._popup&&this._popup.setContent(e);return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this.togglePopup).off("remove",this.closePopup).off("move",this._movePopup)}return this},_movePopup:function(e){this._popup.setLatLng(e.latlng)}});i.LayerGroup=i.Class.extend({initialize:function(e){this._layers={};var t,n;if(e)for(t=0,n=e.length;t<n;t++)this.addLayer(e[t])},addLayer:function(e){var t=this.getLayerId(e);this._layers[t]=e;this._map&&this._map.addLayer(e);return this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]);delete this._layers[t];return this},hasLayer:function(e){return e?e in this._layers||this.getLayerId(e)in this._layers:!1},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),n,r;for(n in this._layers){r=this._layers[n];r[e]&&r[e].apply(r,t)}return this},onAdd:function(e){this._map=e;this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e);this._map=null},addTo:function(e){e.addLayer(this);return this},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];for(var t in this._layers)e.push(this._layers[t]);return e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return i.stamp(e)}});i.layerGroup=function(e){return new i.LayerGroup(e)};i.FeatureGroup=i.LayerGroup.extend({includes:i.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(e){if(this.hasLayer(e))return this;e.on(i.FeatureGroup.EVENTS,this._propagateEvent,this);i.LayerGroup.prototype.addLayer.call(this,e);this._popupContent&&e.bindPopup&&e.bindPopup(this._popupContent,this._popupOptions);return this.fire("layeradd",{layer:e})},removeLayer:function(e){if(!this.hasLayer(e))return this;e in this._layers&&(e=this._layers[e]);e.off(i.FeatureGroup.EVENTS,this._propagateEvent,this);i.LayerGroup.prototype.removeLayer.call(this,e);this._popupContent&&this.invoke("unbindPopup");return this.fire("layerremove",{layer:e})},bindPopup:function(e,t){this._popupContent=e;this._popupOptions=t;return this.invoke("bindPopup",e,t)},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new i.LatLngBounds;this.eachLayer(function(t){e.extend(t instanceof i.Marker?t.getLatLng():t.getBounds())});return e},_propagateEvent:function(e){e.layer||(e.layer=e.target);e.target=this;this.fire(e.type,e)}});i.featureGroup=function(e){return new i.FeatureGroup(e)};i.Path=i.Class.extend({includes:[i.Mixin.Events],statics:{CLIP_PADDING:function(){var t=i.Browser.mobile?1280:2e3,n=(t/Math.max(e.outerWidth,e.outerHeight)-1)/2;return Math.max(0,Math.min(.5,n))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(e){i.setOptions(this,e)},onAdd:function(e){this._map=e;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();this._container&&this._map._pathRoot.appendChild(this._container);this.fire("add");e.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){e._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(i.Browser.vml){this._container=null;this._stroke=null;this._fill=null}e.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(e){i.setOptions(this,e);this._container&&this._updateStyle();return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});i.Map.include({_updatePathViewport:function(){var e=i.Path.CLIP_PADDING,t=this.getSize(),n=i.DomUtil.getPosition(this._mapPane),r=n.multiplyBy(-1)._subtract(t.multiplyBy(e)._round()),s=r.add(t.multiplyBy(1+e*2)._round());this._pathViewport=new i.Bounds(r,s)}});i.Path.SVG_NS="http://www.w3.org/2000/svg";i.Browser.svg=!!t.createElementNS&&!!t.createElementNS(i.Path.SVG_NS,"svg").createSVGRect;i.Path=i.Path.extend({statics:{SVG:i.Browser.svg},bringToFront:function(){var e=this._map._pathRoot,t=this._container;t&&e.lastChild!==t&&e.appendChild(t);return this},bringToBack:function(){var e=this._map._pathRoot,t=this._container,n=e.firstChild;t&&n!==t&&e.insertBefore(t,n);return this},getPathString:function(){},_createElement:function(e){return t.createElementNS(i.Path.SVG_NS,e)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin","round");this._path.setAttribute("stroke-linecap","round")}this.options.fill&&this._path.setAttribute("fill-rule","evenodd");this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents);!this.options.clickable&&!this.options.pointerEvents&&this._path.setAttribute("pointer-events","none");this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);this._path.setAttribute("stroke-width",this.options.weight);this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray")}else this._path.setAttribute("stroke","none");if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else this._path.setAttribute("fill","none")},_updatePath:function(){var e=this.getPathString();e||(e="M0 0");this._path.setAttribute("d",e)},_initEvents:function(){if(this.options.clickable){(i.Browser.svg||!i.Browser.vml)&&this._path.setAttribute("class","leaflet-clickable");i.DomEvent.on(this._container,"click",this._onMouseClick,this);var e=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var t=0;t<e.length;t++)i.DomEvent.on(this._container,e[t],this._fireMouseEvent,this)}},_onMouseClick:function(e){if(this._map.dragging&&this._map.dragging.moved())return;this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this.hasEventListeners(e.type))return;var t=this._map,n=t.mouseEventToContainerPoint(e),r=t.containerPointToLayerPoint(n),s=t.layerPointToLatLng(r);this.fire(e.type,{latlng:s,layerPoint:r,containerPoint:n,originalEvent:e});e.type==="contextmenu"&&i.DomEvent.preventDefault(e);e.type!=="mousemove"&&i.DomEvent.stopPropagation(e)}});i.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=i.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&i.Browser.any3d){this._pathRoot.setAttribute("class"," leaflet-zoom-animated");this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})}else this._pathRoot.setAttribute("class"," leaflet-zoom-hide");this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(e){var t=this.getZoomScale(e.zoom),n=this._getCenterOffset(e.center)._multiplyBy(-t)._add(this._pathViewport.min);this._pathRoot.style[i.DomUtil.TRANSFORM]=i.DomUtil.getTranslateString(n)+" scale("+t+") ";this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var e=this._pathViewport,t=e.min,n=e.max,r=n.x-t.x,s=n.y-t.y,o=this._pathRoot,u=this._panes.overlayPane;i.Browser.mobileWebkit&&u.removeChild(o);i.DomUtil.setPosition(o,t);o.setAttribute("width",r);o.setAttribute("height",s);o.setAttribute("viewBox",[t.x,t.y,r,s].join(" "));i.Browser.mobileWebkit&&u.appendChild(o)}});i.Path.include({bindPopup:function(e,t){if(e instanceof i.Popup)this._popup=e;else{if(!this._popup||t)this._popup=new i.Popup(t,this);this._popup.setContent(e)}if(!this._popupHandlersAdded){this.on("click",this._openPopup,this).on("remove",this.closePopup,this);this._popupHandlersAdded=!0}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this._openPopup).off("remove",this.closePopup);this._popupHandlersAdded=!1}return this},openPopup:function(e){if(this._popup){e=e||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:e})}return this},closePopup:function(){this._popup&&this._popup._close();return this},_openPopup:function(e){this._popup.setLatLng(e.latlng);this._map.openPopup(this._popup)}});i.Browser.vml=!i.Browser.svg&&function(){try{var e=t.createElement("div");e.innerHTML='<v:shape adj="1"/>';var n=e.firstChild;n.style.behavior="url(#default#VML)";return n&&typeof n.adj=="object"}catch(r){return!1}}();i.Path=i.Browser.svg||!i.Browser.vml?i.Path:i.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{t.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(e){return t.createElement("<lvml:"+e+' class="lvml">')}}catch(e){return function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var e=this._container=this._createElement("shape");i.DomUtil.addClass(e,"leaflet-vml-shape");this.options.clickable&&i.DomUtil.addClass(e,"leaflet-clickable");e.coordsize="1 1";this._path=this._createElement("path");e.appendChild(this._path);this._map._pathRoot.appendChild(e)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var e=this._stroke,t=this._fill,n=this.options,r=this._container;r.stroked=n.stroke;r.filled=n.fill;if(n.stroke){if(!e){e=this._stroke=this._createElement("stroke");e.endcap="round";r.appendChild(e)}e.weight=n.weight+"px";e.color=n.color;e.opacity=n.opacity;n.dashArray?e.dashStyle=n.dashArray instanceof Array?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle=""}else if(e){r.removeChild(e);this._stroke=null}if(n.fill){if(!t){t=this._fill=this._createElement("fill");r.appendChild(t)}t.color=n.fillColor||n.color;t.opacity=n.fillOpacity}else if(t){r.removeChild(t);this._fill=null}},_updatePath:function(){var e=this._container.style;e.display="none";this._path.v=this.getPathString()+" ";e.display=""}});i.Map.include(i.Browser.svg||!i.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot)return;var e=this._pathRoot=t.createElement("div");e.className="leaflet-vml-container";this._panes.overlayPane.appendChild(e);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}});i.Browser.canvas=function(){return!!t.createElement("canvas").getContext}();i.Path=i.Path.SVG&&!e.L_PREFER_CANVAS||!i.Browser.canvas?i.Path:i.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(e){i.setOptions(this,e);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(e){e.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this._map=null},_requestUpdate:function(){this._map&&!i.Path._updateRequest&&(i.Path._updateRequest=i.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){i.Path._updateRequest=null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var e=this.options;if(e.stroke){this._ctx.lineWidth=e.weight;this._ctx.strokeStyle=e.color}e.fill&&(this._ctx.fillStyle=e.fillColor||e.color)},_drawPath:function(){var e,t,n,r,s,o;this._ctx.beginPath();for(e=0,n=this._parts.length;e<n;e++){for(t=0,r=this._parts[e].length;t<r;t++){s=this._parts[e][t];o=(t===0?"move":"line")+"To";this._ctx[o](s.x,s.y)}this instanceof i.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(this._checkIfEmpty())return;var e=this._ctx,t=this.options;this._drawPath();e.save();this._updateStyle();if(t.fill){e.globalAlpha=t.fillOpacity;e.fill()}if(t.stroke){e.globalAlpha=t.opacity;e.stroke()}e.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onClick,this)}},_onClick:function(e){this._containsPoint(e.layerPoint)&&this.fire("click",e)},_onMouseMove:function(e){if(!this._map||this._map._animatingZoom)return;if(this._containsPoint(e.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=!0;this.fire("mouseover",e)}else if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=!1;this.fire("mouseout",e)}}});i.Map.include(i.Path.SVG&&!e.L_PREFER_CANVAS||!i.Browser.canvas?{}:{_initPathRoot:function(){var e=this._pathRoot,n;if(!e){e=this._pathRoot=t.createElement("canvas");e.style.position="absolute";n=this._canvasCtx=e.getContext("2d");n.lineCap="round";n.lineJoin="round";this._panes.overlayPane.appendChild(e);if(this.options.zoomAnimation){this._pathRoot.className="leaflet-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},_updateCanvasViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var e=this._pathViewport,t=e.min,n=e.max.subtract(t),r=this._pathRoot;i.DomUtil.setPosition(r,t);r.width=n.x;r.height=n.y;r.getContext("2d").translate(-t.x,-t.y)}});i.LineUtil={simplify:function(e,t){if(!t||!e.length)return e.slice();var n=t*t;e=this._reducePoints(e,n);e=this._simplifyDP(e,n);return e},pointToSegmentDistance:function(e,t,n){return Math.sqrt(this._sqClosestPointOnSegment(e,t,n,!0))},closestPointOnSegment:function(e,t,n){return this._sqClosestPointOnSegment(e,t,n)},_simplifyDP:function(e,t){var r=e.length,i=typeof Uint8Array!=n+""?Uint8Array:Array,s=new i(r);s[0]=s[r-1]=1;this._simplifyDPStep(e,s,t,0,r-1);var o,u=[];for(o=0;o<r;o++)s[o]&&u.push(e[o]);return u},_simplifyDPStep:function(e,t,n,r,i){var s=0,o,u,a;for(u=r+1;u<=i-1;u++){a=this._sqClosestPointOnSegment(e[u],e[r],e[i],!0);if(a>s){o=u;s=a}}if(s>n){t[o]=1;this._simplifyDPStep(e,t,n,r,o);this._simplifyDPStep(e,t,n,o,i)}},_reducePoints:function(e,t){var n=[e[0]];for(var r=1,i=0,s=e.length;r<s;r++)if(this._sqDist(e[r],e[i])>t){n.push(e[r]);i=r}i<s-1&&n.push(e[s-1]);return n},clipSegment:function(e,t,n,r){var i=r?this._lastCode:this._getBitCode(e,n),s=this._getBitCode(t,n),o,u,a;this._lastCode=s;for(;;){if(!(i|s))return[e,t];if(i&s)return!1;o=i||s;u=this._getEdgeIntersection(e,t,o,n);a=this._getBitCode(u,n);if(o===i){e=u;i=a}else{t=u;s=a}}},_getEdgeIntersection:function(e,t,n,r){var s=t.x-e.x,o=t.y-e.y,u=r.min,a=r.max;if(n&8)return new i.Point(e.x+s*(a.y-e.y)/o,a.y);if(n&4)return new i.Point(e.x+s*(u.y-e.y)/o,u.y);if(n&2)return new i.Point(a.x,e.y+o*(a.x-e.x)/s);if(n&1)return new i.Point(u.x,e.y+o*(u.x-e.x)/s)},_getBitCode:function(e,t){var n=0;e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2);e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8);return n},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},_sqClosestPointOnSegment:function(e,t,n,r){var s=t.x,o=t.y,u=n.x-s,a=n.y-o,f=u*u+a*a,l;if(f>0){l=((e.x-s)*u+(e.y-o)*a)/f;if(l>1){s=n.x;o=n.y}else if(l>0){s+=u*l;o+=a*l}}u=e.x-s;a=e.y-o;return r?u*u+a*a:new i.Point(s,o)}};i.Polyline=i.Path.extend({initialize:function(e,t){i.Path.prototype.initialize.call(this,t);this._latlngs=this._convertLatLngs(e)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var e=0,t=this._latlngs.length;e<t;e++)this._originalPoints[e]=this._map.latLngToLayerPoint(this._latlngs[e])},getPathString:function(){for(var e=0,t=this._parts.length,n="";e<t;e++)n+=this._getPathPartStr(this._parts[e]);return n},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){this._latlngs=this._convertLatLngs(e);return this.redraw()},addLatLng:function(e){this._latlngs.push(i.latLng(e));return this.redraw()},spliceLatLngs:function(){var e=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,!0);this.redraw();return e},closestLayerPoint:function(e){var t=Infinity,n=this._parts,r,s,o=null;for(var u=0,a=n.length;u<a;u++){var f=n[u];for(var l=1,c=f.length;l<c;l++){r=f[l-1];s=f[l];var h=i.LineUtil._sqClosestPointOnSegment(e,r,s,!0);if(h<t){t=h;o=i.LineUtil._sqClosestPointOnSegment(e,r,s)}}}o&&(o.distance=Math.sqrt(t));return o},getBounds:function(){return new i.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(e,t){var n,r,s=t?e:[];for(n=0,r=e.length;n<r;n++){if(i.Util.isArray(e[n])&&typeof e[n][0]!="number")return;s[n]=i.latLng(e[n])}return s},_initEvents:function(){i.Path.prototype._initEvents.call(this)},_getPathPartStr:function(e){var t=i.Path.VML;for(var n=0,r=e.length,s="",o;n<r;n++){o=e[n];t&&o._round();s+=(n?"L":"M")+o.x+" "+o.y}return s},_clipPoints:function(){var e=this._originalPoints,t=e.length,n,r,s;if(this.options.noClip){this._parts=[e];return}this._parts=[];var o=this._parts,u=this._map._pathViewport,a=i.LineUtil;for(n=0,r=0;n<t-1;n++){s=a.clipSegment(e[n],e[n+1],u,n);if(!s)continue;o[r]=o[r]||[];o[r].push(s[0]);if(s[1]!==e[n+1]||n===t-2){o[r].push(s[1]);r++}}},_simplifyPoints:function(){var e=this._parts,t=i.LineUtil;for(var n=0,r=e.length;n<r;n++)e[n]=t.simplify(e[n],this.options.smoothFactor)},_updatePath:function(){if(!this._map)return;this._clipPoints();this._simplifyPoints();i.Path.prototype._updatePath.call(this)}});i.polyline=function(e,t){return new i.Polyline(e,t)};i.PolyUtil={};i.PolyUtil.clipPolygon=function(e,t){var n,r=[1,4,2,8],s,o,u,a,f,l,c,h,p=i.LineUtil;for(s=0,l=e.length;s<l;s++)e[s]._code=p._getBitCode(e[s],t);for(u=0;u<4;u++){c=r[u];n=[];for(s=0,l=e.length,o=l-1;s<l;o=s++){a=e[s];f=e[o];if(!(a._code&c)){if(f._code&c){h=p._getEdgeIntersection(f,a,c,t);h._code=p._getBitCode(h,t);n.push(h)}n.push(a)}else if(!(f._code&c)){h=p._getEdgeIntersection(f,a,c,t);h._code=p._getBitCode(h,t);n.push(h)}}e=n}return e};i.Polygon=i.Polyline.extend({options:{fill:!0},initialize:function(e,t){var n,r,s;i.Polyline.prototype.initialize.call(this,e,t);if(e&&i.Util.isArray(e[0])&&typeof e[0][0]!="number"){this._latlngs=this._convertLatLngs(e[0]);this._holes=e.slice(1);for(n=0,r=this._holes.length;n<r;n++){s=this._holes[n]=this._convertLatLngs(this._holes[n]);s[0].equals(s[s.length-1])&&s.pop()}}e=this._latlngs;e.length>=2&&e[0].equals(e[e.length-1])&&e.pop()},projectLatlngs:function(){i.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes)return;var e,t,n,r;for(e=0,n=this._holes.length;e<n;e++){this._holePoints[e]=[];for(t=0,r=this._holes[e].length;t<r;t++)this._holePoints[e][t]=this._map.latLngToLayerPoint(this._holes[e][t])}},_clipPoints:function(){var e=this._originalPoints,t=[];this._parts=[e].concat(this._holePoints);if(this.options.noClip)return;for(var n=0,r=this._parts.length;n<r;n++){var s=i.PolyUtil.clipPolygon(this._parts[n],this._map._pathViewport);s.length&&t.push(s)}this._parts=t},_getPathPartStr:function(e){var t=i.Polyline.prototype._getPathPartStr.call(this,e);return t+(i.Browser.svg?"z":"x")}});i.polygon=function(e,t){return new i.Polygon(e,t)};(function(){function e(e){return i.FeatureGroup.extend({initialize:function(e,t){this._layers={};this._options=t;this.setLatLngs(e)},setLatLngs:function(t){var n=0,r=t.length;this.eachLayer(function(e){n<r?e.setLatLngs(t[n++]):this.removeLayer(e)},this);while(n<r)this.addLayer(new e(t[n++],this._options));return this},getLatLngs:function(){var e=[];this.eachLayer(function(t){e.push(t.getLatLngs())});return e}})}i.MultiPolyline=e(i.Polyline);i.MultiPolygon=e(i.Polygon);i.multiPolyline=function(e,t){return new i.MultiPolyline(e,t)};i.multiPolygon=function(e,t){return new i.MultiPolygon(e,t)}})();i.Rectangle=i.Polygon.extend({initialize:function(e,t){i.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){e=i.latLngBounds(e);return[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});i.rectangle=function(e,t){return new i.Rectangle(e,t)};i.Circle=i.Path.extend({initialize:function(e,t,n){i.Path.prototype.initialize.call(this,n);this._latlng=i.latLng(e);this._mRadius=t},options:{fill:!0},setLatLng:function(e){this._latlng=i.latLng(e);return this.redraw()},setRadius:function(e){this._mRadius=e;return this.redraw()},projectLatlngs:function(){var e=this._getLngRadius(),t=this._latlng,n=this._map.latLngToLayerPoint([t.lat,t.lng-e]);this._point=this._map.latLngToLayerPoint(t);this._radius=Math.max(this._point.x-n.x,1)},getBounds:function(){var e=this._getLngRadius(),t=this._mRadius/40075017*360,n=this._latlng;return new i.LatLngBounds([n.lat-t,n.lng-e],[n.lat+t,n.lng+e])},getLatLng:function(){return this._latlng},getPathString:function(){var e=this._point,t=this._radius;if(this._checkIfEmpty())return"";if(i.Browser.svg)return"M"+e.x+","+(e.y-t)+"A"+t+","+t+",0,1,1,"+(e.x-.1)+","+(e.y-t)+" z";e._round();t=Math.round(t);return"AL "+e.x+","+e.y+" "+t+","+t+" 0,"+23592600},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(i.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var e=this._map._pathViewport,t=this._radius,n=this._point;return n.x-t>e.max.x||n.y-t>e.max.y||n.x+t<e.min.x||n.y+t<e.min.y}});i.circle=function(e,t,n){return new i.Circle(e,t,n)};i.CircleMarker=i.Circle.extend({options:{radius:10,weight:2},initialize:function(e,t){i.Circle.prototype.initialize.call(this,e,null,t);this._radius=this.options.radius},projectLatlngs:function(){this
._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){i.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setRadius:function(e){this.options.radius=this._radius=e;return this.redraw()}});i.circleMarker=function(e,t){return new i.CircleMarker(e,t)};i.Polyline.include(i.Path.CANVAS?{_containsPoint:function(e,t){var n,r,s,o,u,a,f,l=this.options.weight/2;i.Browser.touch&&(l+=10);for(n=0,o=this._parts.length;n<o;n++){f=this._parts[n];for(r=0,u=f.length,s=u-1;r<u;s=r++){if(!t&&r===0)continue;a=i.LineUtil.pointToSegmentDistance(e,f[s],f[r]);if(a<=l)return!0}}return!1}}:{});i.Polygon.include(i.Path.CANVAS?{_containsPoint:function(e){var t=!1,n,r,s,o,u,a,f,l;if(i.Polyline.prototype._containsPoint.call(this,e,!0))return!0;for(o=0,f=this._parts.length;o<f;o++){n=this._parts[o];for(u=0,l=n.length,a=l-1;u<l;a=u++){r=n[u];s=n[a];r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(t=!t)}}return t}}:{});i.Circle.include(i.Path.CANVAS?{_drawPath:function(){var e=this._point;this._ctx.beginPath();this._ctx.arc(e.x,e.y,this._radius,0,Math.PI*2,!1)},_containsPoint:function(e){var t=this._point,n=this.options.stroke?this.options.weight/2:0;return e.distanceTo(t)<=this._radius+n}}:{});i.CircleMarker.include(i.Path.CANVAS?{_updateStyle:function(){i.Path.prototype._updateStyle.call(this)}}:{});i.GeoJSON=i.FeatureGroup.extend({initialize:function(e,t){i.setOptions(this,t);this._layers={};e&&this.addData(e)},addData:function(e){var t=i.Util.isArray(e)?e:e.features,n,r,s;if(t){for(n=0,r=t.length;n<r;n++){s=t[n];(s.geometries||s.geometry||s.features||s.coordinates)&&this.addData(t[n])}return this}var o=this.options;if(o.filter&&!o.filter(e))return;var u=i.GeoJSON.geometryToLayer(e,o.pointToLayer,o.coordsToLatLng);u.feature=i.GeoJSON.asFeature(e);u.defaultOptions=u.options;this.resetStyle(u);o.onEachFeature&&o.onEachFeature(e,u);return this.addLayer(u)},resetStyle:function(e){var t=this.options.style;if(t){i.Util.extend(e.options,e.defaultOptions);this._setLayerStyle(e,t)}},setStyle:function(e){this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){typeof t=="function"&&(t=t(e.feature));e.setStyle&&e.setStyle(t)}});i.extend(i.GeoJSON,{geometryToLayer:function(e,t,n){var r=e.type==="Feature"?e.geometry:e,s=r.coordinates,o=[],u,a,f,l,c;n=n||this.coordsToLatLng;switch(r.type){case"Point":u=n(s);return t?t(e,u):new i.Marker(u);case"MultiPoint":for(f=0,l=s.length;f<l;f++){u=n(s[f]);c=t?t(e,u):new i.Marker(u);o.push(c)}return new i.FeatureGroup(o);case"LineString":a=this.coordsToLatLngs(s,0,n);return new i.Polyline(a);case"Polygon":a=this.coordsToLatLngs(s,1,n);return new i.Polygon(a);case"MultiLineString":a=this.coordsToLatLngs(s,1,n);return new i.MultiPolyline(a);case"MultiPolygon":a=this.coordsToLatLngs(s,2,n);return new i.MultiPolygon(a);case"GeometryCollection":for(f=0,l=r.geometries.length;f<l;f++){c=this.geometryToLayer({geometry:r.geometries[f],type:"Feature",properties:e.properties},t,n);o.push(c)}return new i.FeatureGroup(o);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(e){return new i.LatLng(e[1],e[0])},coordsToLatLngs:function(e,t,n){var r,i,s,o=[];for(i=0,s=e.length;i<s;i++){r=t?this.coordsToLatLngs(e[i],t-1,n):(n||this.coordsToLatLng)(e[i]);o.push(r)}return o},latLngToCoords:function(e){return[e.lng,e.lat]},latLngsToCoords:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(i.GeoJSON.latLngToCoords(e[n]));return t},getFeature:function(e,t){return e.feature?i.extend({},e.feature,{geometry:t}):i.GeoJSON.asFeature(t)},asFeature:function(e){return e.type==="Feature"?e:{type:"Feature",properties:{},geometry:e}}});var o={toGeoJSON:function(){return i.GeoJSON.getFeature(this,{type:"Point",coordinates:i.GeoJSON.latLngToCoords(this.getLatLng())})}};i.Marker.include(o);i.Circle.include(o);i.CircleMarker.include(o);i.Polyline.include({toGeoJSON:function(){return i.GeoJSON.getFeature(this,{type:"LineString",coordinates:i.GeoJSON.latLngsToCoords(this.getLatLngs())})}});i.Polygon.include({toGeoJSON:function(){var e=[i.GeoJSON.latLngsToCoords(this.getLatLngs())],t,n,r;e[0].push(e[0][0]);if(this._holes)for(t=0,n=this._holes.length;t<n;t++){r=i.GeoJSON.latLngsToCoords(this._holes[t]);r.push(r[0]);e.push(r)}return i.GeoJSON.getFeature(this,{type:"Polygon",coordinates:e})}});(function(){function e(e,t){e.include({toGeoJSON:function(){var e=[];this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)});return i.GeoJSON.getFeature(this,{type:t,coordinates:e})}})}e(i.MultiPolyline,"MultiLineString");e(i.MultiPolygon,"MultiPolygon")})();i.LayerGroup.include({toGeoJSON:function(){var e=[];this.eachLayer(function(t){t.toGeoJSON&&e.push(i.GeoJSON.asFeature(t.toGeoJSON()))});return{type:"FeatureCollection",features:e}}});i.geoJson=function(e,t){return new i.GeoJSON(e,t)};i.DomEvent={addListener:function(e,t,n,r){var s=i.stamp(n),o="_leaflet_"+t+s,u,a,f;if(e[o])return this;u=function(t){return n.call(r||e,t||i.DomEvent._getEvent())};if(i.Browser.msTouch&&t.indexOf("touch")===0)return this.addMsTouchListener(e,t,u,s);i.Browser.touch&&t==="dblclick"&&this.addDoubleTapListener&&this.addDoubleTapListener(e,u,s);if("addEventListener"in e)if(t==="mousewheel"){e.addEventListener("DOMMouseScroll",u,!1);e.addEventListener(t,u,!1)}else if(t==="mouseenter"||t==="mouseleave"){a=u;f=t==="mouseenter"?"mouseover":"mouseout";u=function(t){if(!i.DomEvent._checkMouse(e,t))return;return a(t)};e.addEventListener(f,u,!1)}else if(t==="click"&&i.Browser.android){a=u;u=function(e){return i.DomEvent._filterClick(e,a)};e.addEventListener(t,u,!1)}else e.addEventListener(t,u,!1);else"attachEvent"in e&&e.attachEvent("on"+t,u);e[o]=u;return this},removeListener:function(e,t,n){var r=i.stamp(n),s="_leaflet_"+t+r,o=e[s];if(!o)return this;if(i.Browser.msTouch&&t.indexOf("touch")===0)this.removeMsTouchListener(e,t,r);else if(i.Browser.touch&&t==="dblclick"&&this.removeDoubleTapListener)this.removeDoubleTapListener(e,r);else if("removeEventListener"in e)if(t==="mousewheel"){e.removeEventListener("DOMMouseScroll",o,!1);e.removeEventListener(t,o,!1)}else t==="mouseenter"||t==="mouseleave"?e.removeEventListener(t==="mouseenter"?"mouseover":"mouseout",o,!1):e.removeEventListener(t,o,!1);else"detachEvent"in e&&e.detachEvent("on"+t,o);e[s]=null;return this},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0;return this},disableClickPropagation:function(e){var t=i.DomEvent.stopPropagation;for(var n=i.Draggable.START.length-1;n>=0;n--)i.DomEvent.addListener(e,i.Draggable.START[n],t);return i.DomEvent.addListener(e,"click",i.DomEvent._fakeStop).addListener(e,"dblclick",t)},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;return this},stop:function(e){return i.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,n){var r=i.Browser.ie7,s=t.body,o=t.documentElement,u=e.pageX?e.pageX-s.scrollLeft-o.scrollLeft:e.clientX,a=e.pageY?e.pageY-s.scrollTop-o.scrollTop:e.clientY,f=new i.Point(u,a),l=n.getBoundingClientRect(),c=l.left-n.clientLeft,h=l.top-n.clientTop;if(!i.DomUtil.documentIsLtr()&&(i.Browser.webkit||r)){c+=n.scrollWidth-n.clientWidth;r&&i.DomUtil.getStyle(n,"overflow-y")!=="hidden"&&i.DomUtil.getStyle(n,"overflow")!=="hidden"&&(c+=17)}return f._subtract(new i.Point(c,h))},getWheelDelta:function(e){var t=0;e.wheelDelta&&(t=e.wheelDelta/120);e.detail&&(t=-e.detail/3);return t},_skipEvents:{},_fakeStop:function(e){i.DomEvent._skipEvents[e.type]=!0},_skipped:function(e){var t=this._skipEvents[e.type];this._skipEvents[e.type]=!1;return t},_checkMouse:function(e,t){var n=t.relatedTarget;if(!n)return!0;try{while(n&&n!==e)n=n.parentNode}catch(r){return!1}return n!==e},_getEvent:function(){var t=e.event;if(!t){var n=arguments.callee.caller;while(n){t=n.arguments[0];if(t&&e.Event===t.constructor)break;n=n.caller}}return t},_filterClick:function(e,t){var n=e.timeStamp||e.originalEvent.timeStamp,r=i.DomEvent._lastClick&&n-i.DomEvent._lastClick;if(r&&r>100&&r<1e3||e.target._simulatedClick&&!e._simulated){i.DomEvent.stop(e);return}i.DomEvent._lastClick=n;return t(e)}};i.DomEvent.on=i.DomEvent.addListener;i.DomEvent.off=i.DomEvent.removeListener;i.Draggable=i.Class.extend({includes:i.Mixin.Events,statics:{START:i.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"}},initialize:function(e,t){this._element=e;this._dragStartTarget=t||e},enable:function(){if(this._enabled)return;for(var e=i.Draggable.START.length-1;e>=0;e--)i.DomEvent.on(this._dragStartTarget,i.Draggable.START[e],this._onDown,this);this._enabled=!0},disable:function(){if(!this._enabled)return;for(var e=i.Draggable.START.length-1;e>=0;e--)i.DomEvent.off(this._dragStartTarget,i.Draggable.START[e],this._onDown,this);this._enabled=!1;this._moved=!1},_onDown:function(e){if(e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)return;i.DomEvent.stopPropagation(e);if(i.Draggable._disabled)return;i.DomUtil.disableImageDrag();i.DomUtil.disableTextSelection();var n=e.touches?e.touches[0]:e,r=n.target;i.Browser.touch&&r.tagName.toLowerCase()==="a"&&i.DomUtil.addClass(r,"leaflet-active");this._moved=!1;if(this._moving)return;this._startPoint=new i.Point(n.clientX,n.clientY);this._startPos=this._newPos=i.DomUtil.getPosition(this._element);i.DomEvent.on(t,i.Draggable.MOVE[e.type],this._onMove,this).on(t,i.Draggable.END[e.type],this._onUp,this)},_onMove:function(e){if(e.touches&&e.touches.length>1)return;var n=e.touches&&e.touches.length===1?e.touches[0]:e,r=new i.Point(n.clientX,n.clientY),s=r.subtract(this._startPoint);if(!s.x&&!s.y)return;i.DomEvent.preventDefault(e);if(!this._moved){this.fire("dragstart");this._moved=!0;this._startPos=i.DomUtil.getPosition(this._element).subtract(s);i.Browser.touch||i.DomUtil.addClass(t.body,"leaflet-dragging")}this._newPos=this._startPos.add(s);this._moving=!0;i.Util.cancelAnimFrame(this._animRequest);this._animRequest=i.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");i.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(){i.Browser.touch||i.DomUtil.removeClass(t.body,"leaflet-dragging");for(var e in i.Draggable.MOVE)i.DomEvent.off(t,i.Draggable.MOVE[e],this._onMove).off(t,i.Draggable.END[e],this._onUp);i.DomUtil.enableImageDrag();i.DomUtil.enableTextSelection();if(this._moved){i.Util.cancelAnimFrame(this._animRequest);this.fire("dragend")}this._moving=!1}});i.Handler=i.Class.extend({initialize:function(e){this._map=e},enable:function(){if(this._enabled)return;this._enabled=!0;this.addHooks()},disable:function(){if(!this._enabled)return;this._enabled=!1;this.removeHooks()},enabled:function(){return!!this._enabled}});i.Map.mergeOptions({dragging:!0,inertia:!i.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:i.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1});i.Map.Drag=i.Handler.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new i.Draggable(e._mapPane,e._container);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);if(e.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);e.on("viewreset",this._onViewReset,this);this._onViewReset()}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var e=this._map;e._panAnim&&e._panAnim.stop();e.fire("movestart").fire("dragstart");if(e.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(){if(this._map.options.inertia){var e=this._lastTime=+(new Date),t=this._lastPos=this._draggable._newPos;this._positions.push(t);this._times.push(e);if(e-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var e=this._map.getSize()._divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x;this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,s=(r+t+n)%e-t-n,o=Math.abs(i+n)<Math.abs(s+n)?i:s;this._draggable._newPos.x=o},_onDragEnd:function(){var e=this._map,t=e.options,n=+(new Date)-this._lastTime,r=!t.inertia||n>t.inertiaThreshold||!this._positions[0];e.fire("dragend");if(r)e.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),o=(this._lastTime+n-this._times[0])/1e3,u=t.easeLinearity,a=s.multiplyBy(u/o),f=a.distanceTo([0,0]),l=Math.min(t.inertiaMaxSpeed,f),c=a.multiplyBy(l/f),h=l/(t.inertiaDeceleration*u),p=c.multiplyBy(-h/2).round();!p.x||!p.y?e.fire("moveend"):i.Util.requestAnimFrame(function(){e.panBy(p,{duration:h,easeLinearity:u,noMoveStart:!0})})}}});i.Map.addInitHook("addHandler","dragging",i.Map.Drag);i.Map.mergeOptions({doubleClickZoom:!0});i.Map.DoubleClickZoom=i.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick)},_onDoubleClick:function(e){this.setZoomAround(e.containerPoint,this._zoom+1)}});i.Map.addInitHook("addHandler","doubleClickZoom",i.Map.DoubleClickZoom);i.Map.mergeOptions({scrollWheelZoom:!0});i.Map.ScrollWheelZoom=i.Handler.extend({addHooks:function(){i.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);i.DomEvent.on(this._map._container,"MozMousePixelScroll",i.DomEvent.preventDefault);this._delta=0},removeHooks:function(){i.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);i.DomEvent.off(this._map._container,"MozMousePixelScroll",i.DomEvent.preventDefault)},_onWheelScroll:function(e){var t=i.DomEvent.getWheelDelta(e);this._delta+=t;this._lastMousePos=this._map.mouseEventToContainerPoint(e);this._startTime||(this._startTime=+(new Date));var n=Math.max(40-(+(new Date)-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(i.bind(this._performZoom,this),n);i.DomEvent.preventDefault(e);i.DomEvent.stopPropagation(e)},_performZoom:function(){var e=this._map,t=this._delta,n=e.getZoom();t=t>0?Math.ceil(t):Math.floor(t);t=Math.max(Math.min(t,4),-4);t=e._limitZoom(n+t)-n;this._delta=0;this._startTime=null;if(!t)return;e.setZoomAround(this._lastMousePos,n+t)}});i.Map.addInitHook("addHandler","scrollWheelZoom",i.Map.ScrollWheelZoom);i.extend(i.DomEvent,{_touchstart:i.Browser.msTouch?"MSPointerDown":"touchstart",_touchend:i.Browser.msTouch?"MSPointerUp":"touchend",addDoubleTapListener:function(e,n,r){function p(e){var t;if(i.Browser.msTouch){h.push(e.pointerId);t=h.length}else t=e.touches.length;if(t>1)return;var n=Date.now(),r=n-(s||n);a=e.touches?e.touches[0]:e;o=r>0&&r<=u;s=n}function d(e){if(i.Browser.msTouch){var t=h.indexOf(e.pointerId);if(t===-1)return;h.splice(t,1)}if(o){if(i.Browser.msTouch){var r={},u;for(var f in a){u=a[f];typeof u=="function"?r[f]=u.bind(a):r[f]=u}a=r}a.type="dblclick";n(a);s=null}}var s,o=!1,u=250,a,f="_leaflet_",l=this._touchstart,c=this._touchend,h=[];e[f+l+r]=p;e[f+c+r]=d;var v=i.Browser.msTouch?t.documentElement:e;e.addEventListener(l,p,!1);v.addEventListener(c,d,!1);i.Browser.msTouch&&v.addEventListener("MSPointerCancel",d,!1);return this},removeDoubleTapListener:function(e,n){var r="_leaflet_";e.removeEventListener(this._touchstart,e[r+this._touchstart+n],!1);(i.Browser.msTouch?t.documentElement:e).removeEventListener(this._touchend,e[r+this._touchend+n],!1);i.Browser.msTouch&&t.documentElement.removeEventListener("MSPointerCancel",e[r+this._touchend+n],!1);return this}});i.extend(i.DomEvent,{_msTouches:[],_msDocumentListener:!1,addMsTouchListener:function(e,t,n,r){switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,n,r);case"touchend":return this.addMsTouchListenerEnd(e,t,n,r);case"touchmove":return this.addMsTouchListenerMove(e,t,n,r);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,n,r,i){var s="_leaflet_",o=this._msTouches,u=function(e){var t=!1;for(var n=0;n<o.length;n++)if(o[n].pointerId===e.pointerId){t=!0;break}t||o.push(e);e.touches=o.slice();e.changedTouches=[e];r(e)};e[s+"touchstart"+i]=u;e.addEventListener("MSPointerDown",u,!1);if(!this._msDocumentListener){var a=function(e){for(var t=0;t<o.length;t++)if(o[t].pointerId===e.pointerId){o.splice(t,1);break}};t.documentElement.addEventListener("MSPointerUp",a,!1);t.documentElement.addEventListener("MSPointerCancel",a,!1);this._msDocumentListener=!0}return this},addMsTouchListenerMove:function(e,t,n,r){function o(e){if(e.pointerType===e.MSPOINTER_TYPE_MOUSE&&e.buttons===0)return;for(var t=0;t<s.length;t++)if(s[t].pointerId===e.pointerId){s[t]=e;break}e.touches=s.slice();e.changedTouches=[e];n(e)}var i="_leaflet_",s=this._msTouches;e[i+"touchmove"+r]=o;e.addEventListener("MSPointerMove",o,!1);return this},addMsTouchListenerEnd:function(e,t,n,r){var i="_leaflet_",s=this._msTouches,o=function(e){for(var t=0;t<s.length;t++)if(s[t].pointerId===e.pointerId){s.splice(t,1);break}e.touches=s.slice();e.changedTouches=[e];n(e)};e[i+"touchend"+r]=o;e.addEventListener("MSPointerUp",o,!1);e.addEventListener("MSPointerCancel",o,!1);return this},removeMsTouchListener:function(e,t,n){var r="_leaflet_",i=e[r+t+n];switch(t){case"touchstart":e.removeEventListener("MSPointerDown",i,!1);break;case"touchmove":e.removeEventListener("MSPointerMove",i,!1);break;case"touchend":e.removeEventListener("MSPointerUp",i,!1);e.removeEventListener("MSPointerCancel",i,!1)}return this}});i.Map.mergeOptions({touchZoom:i.Browser.touch&&!i.Browser.android23});i.Map.TouchZoom=i.Handler.extend({addHooks:function(){i.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){i.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var n=this._map;if(!e.touches||e.touches.length!==2||n._animatingZoom||this._zooming)return;var r=n.mouseEventToLayerPoint(e.touches[0]),s=n.mouseEventToLayerPoint(e.touches[1]),o=n._getCenterLayerPoint();this._startCenter=r.add(s)._divideBy(2);this._startDist=r.distanceTo(s);this._moved=!1;this._zooming=!0;this._centerOffset=o.subtract(this._startCenter);n._panAnim&&n._panAnim.stop();i.DomEvent.on(t,"touchmove",this._onTouchMove,this).on(t,"touchend",this._onTouchEnd,this);i.DomEvent.preventDefault(e)},_onTouchMove:function(e){var t=this._map;if(!e.touches||e.touches.length!==2||!this._zooming)return;var n=t.mouseEventToLayerPoint(e.touches[0]),r=t.mouseEventToLayerPoint(e.touches[1]);this._scale=n.distanceTo(r)/this._startDist;this._delta=n._add(r)._divideBy(2)._subtract(this._startCenter);if(this._scale===1)return;if(!this._moved){i.DomUtil.addClass(t._mapPane,"leaflet-touching");t.fire("movestart").fire("zoomstart");this._moved=!0}i.Util.cancelAnimFrame(this._animRequest);this._animRequest=i.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container);i.DomEvent.preventDefault(e)},_updateOnMove:function(){var e=this._map,t=this._getScaleOrigin(),n=e.layerPointToLatLng(t),r=e.getScaleZoom(this._scale);e._animateZoom(n,r,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}var e=this._map;this._zooming=!1;i.DomUtil.removeClass(e._mapPane,"leaflet-touching");i.Util.cancelAnimFrame(this._animRequest);i.DomEvent.off(t,"touchmove",this._onTouchMove).off(t,"touchend",this._onTouchEnd);var n=this._getScaleOrigin(),r=e.layerPointToLatLng(n),s=e.getZoom(),o=e.getScaleZoom(this._scale)-s,u=o>0?Math.ceil(o):Math.floor(o),a=e._limitZoom(s+u),f=e.getZoomScale(a)/this._scale;e._animateZoom(r,a,n,f)},_getScaleOrigin:function(){var e=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(e)}});i.Map.addInitHook("addHandler","touchZoom",i.Map.TouchZoom);i.Map.mergeOptions({tap:!0,tapTolerance:15});i.Map.Tap=i.Handler.extend({addHooks:function(){i.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){i.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(!e.touches)return;i.DomEvent.preventDefault(e);this._fireClick=!0;if(e.touches.length>1){this._fireClick=!1;clearTimeout(this._holdTimeout);return}var n=e.touches[0],r=n.target;this._startPos=this._newPos=new i.Point(n.clientX,n.clientY);r.tagName.toLowerCase()==="a"&&i.DomUtil.addClass(r,"leaflet-active");this._holdTimeout=setTimeout(i.bind(function(){if(this._isTapValid()){this._fireClick=!1;this._onUp();this._simulateEvent("contextmenu",n)}},this),1e3);i.DomEvent.on(t,"touchmove",this._onMove,this).on(t,"touchend",this._onUp,this)},_onUp:function(e){clearTimeout(this._holdTimeout);i.DomEvent.off(t,"touchmove",this._onMove,this).off(t,"touchend",this._onUp,this);if(this._fireClick&&e&&e.changedTouches){var n=e.changedTouches[0],r=n.target;r.tagName.toLowerCase()==="a"&&i.DomUtil.removeClass(r,"leaflet-active");this._isTapValid()&&this._simulateEvent("click",n)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var t=e.touches[0];this._newPos=new i.Point(t.clientX,t.clientY)},_simulateEvent:function(n,r){var i=t.createEvent("MouseEvents");i._simulated=!0;r.target._simulatedClick=!0;i.initMouseEvent(n,!0,!0,e,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null);r.target.dispatchEvent(i)}});i.Browser.touch&&!i.Browser.msTouch&&i.Map.addInitHook("addHandler","tap",i.Map.Tap);i.Map.mergeOptions({boxZoom:!0});i.Map.BoxZoom=i.Handler.extend({initialize:function(e){this._map=e;this._container=e._container;this._pane=e._panes.overlayPane},addHooks:function(){i.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){i.DomEvent.off(this._container,"mousedown",this._onMouseDown)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;i.DomUtil.disableTextSelection();i.DomUtil.disableImageDrag();this._startLayerPoint=this._map.mouseEventToLayerPoint(e);this._box=i.DomUtil.create("div","leaflet-zoom-box",this._pane);i.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";i.DomEvent.on(t,"mousemove",this._onMouseMove,this).on(t,"mouseup",this._onMouseUp,this).on(t,"keydown",this._onKeyDown,this);this._map.fire("boxzoomstart")},_onMouseMove:function(e){var t=this._startLayerPoint,n=this._box,r=this._map.mouseEventToLayerPoint(e),s=r.subtract(t),o=new i.Point(Math.min(r.x,t.x),Math.min(r.y,t.y));i.DomUtil.setPosition(n,o);n.style.width=Math.max(0,Math.abs(s.x)-4)+"px";n.style.height=Math.max(0,Math.abs(s.y)-4)+"px"},_finish:function(){this._pane.removeChild(this._box);this._container.style.cursor="";i.DomUtil.enableTextSelection();i.DomUtil.enableImageDrag();i.DomEvent.off(t,"mousemove",this._onMouseMove).off(t,"mouseup",this._onMouseUp).off(t,"keydown",this._onKeyDown)},_onMouseUp:function(e){this._finish();var t=this._map,n=t.mouseEventToLayerPoint(e);if(this._startLayerPoint.equals(n))return;var r=new i.LatLngBounds(t.layerPointToLatLng(this._startLayerPoint),t.layerPointToLatLng(n));t.fitBounds(r);t.fire("boxzoomend",{boxZoomBounds:r})},_onKeyDown:function(e){e.keyCode===27&&this._finish()}});i.Map.addInitHook("addHandler","boxZoom",i.Map.BoxZoom);i.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1});i.Map.Keyboard=i.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109,173]},initialize:function(e){this._map=e;this._setPanOffset(e.options.keyboardPanOffset);this._setZoomOffset(e.options.keyboardZoomOffset)},addHooks:function(){var e=this._map._container;e.tabIndex===-1&&(e.tabIndex="0");i.DomEvent.on(e,"focus",this._onFocus,this).on(e,"blur",this._onBlur,this).on(e,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var e=this._map._container;i.DomEvent.off(e,"focus",this._onFocus,this).off(e,"blur",this._onBlur,this).off(e,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(this._focused)return;var n=t.body,r=t.documentElement,i=n.scrollTop||r.scrollTop,s=n.scrollLeft||r.scrollLeft;this._map._container.focus();e.scrollTo(s,i)},_onFocus:function(){this._focused=!0;this._map.fire("focus")},_onBlur:function(){this._focused=!1;this._map.fire("blur")},_setPanOffset:function(e){var t=this._panKeys={},n=this.keyCodes,r,i;for(r=0,i=n.left.length;r<i;r++)t[n.left[r]]=[-1*e,0];for(r=0,i=n.right.length;r<i;r++)t[n.right[r]]=[e,0];for(r=0,i=n.down.length;r<i;r++)t[n.down[r]]=[0,e];for(r=0,i=n.up.length;r<i;r++)t[n.up[r]]=[0,-1*e]},_setZoomOffset:function(e){var t=this._zoomKeys={},n=this.keyCodes,r,i;for(r=0,i=n.zoomIn.length;r<i;r++)t[n.zoomIn[r]]=e;for(r=0,i=n.zoomOut.length;r<i;r++)t[n.zoomOut[r]]=-e},_addHooks:function(){i.DomEvent.on(t,"keydown",this._onKeyDown,this)},_removeHooks:function(){i.DomEvent.off(t,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){var t=e.keyCode,n=this._map;if(t in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;n.panBy(this._panKeys[t]);n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else{if(!(t in this._zoomKeys))return;n.setZoom(n.getZoom()+this._zoomKeys[t])}i.DomEvent.stop(e)}});i.Map.addInitHook("addHandler","keyboard",i.Map.Keyboard);i.Handler.MarkerDrag=i.Handler.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new i.Draggable(e,e));this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);this._draggable.enable()},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var e=this._marker,t=e._shadow,n=i.DomUtil.getPosition(e._icon),r=e._map.layerPointToLatLng(n);t&&i.DomUtil.setPosition(t,n);e._latlng=r;e.fire("move",{latlng:r}).fire("drag")},_onDragEnd:function(){this._marker.fire("moveend").fire("dragend")}});i.Control=i.Class.extend({options:{position:"topright"},initialize:function(e){i.setOptions(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;t&&t.removeControl(this);this.options.position=e;t&&t.addControl(this);return this},getContainer:function(){return this._container},addTo:function(e){this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),r=e._controlCorners[n];i.DomUtil.addClass(t,"leaflet-control");n.indexOf("bottom")!==-1?r.insertBefore(t,r.firstChild):r.appendChild(t);return this},removeFrom:function(e){var t=this.getPosition(),n=e._controlCorners[t];n.removeChild(this._container);this._map=null;this.onRemove&&this.onRemove(e);return this}});i.control=function(e){return new i.Control(e)};i.Map.include({addControl:function(e){e.addTo(this);return this},removeControl:function(e){e.removeFrom(this);return this},_initControlPos:function(){function r(r,s){var o=t+r+" "+t+s;e[r+s]=i.DomUtil.create("div",o,n)}var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=i.DomUtil.create("div",t+"control-container",this._container);r("top","left");r("top","right");r("bottom","left");r("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});i.Control.Zoom=i.Control.extend({options:{position:"topleft"},onAdd:function(e){var t="leaflet-control-zoom",n=i.DomUtil.create("div",t+" leaflet-bar");this._map=e;this._zoomInButton=this._createButton("+","Zoom in",t+"-in",n,this._zoomIn,this);this._zoomOutButton=this._createButton("-","Zoom out",t+"-out",n,this._zoomOut,this);e.on("zoomend zoomlevelschange",this._updateDisabled,this);return n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createButton:function(e,t,n,r,s,o){var u=i.DomUtil.create("a",n,r);u.innerHTML=e;u.href="#";u.title=t;var a=i.DomEvent.stopPropagation;i.DomEvent.on(u,"click",a).on(u,"mousedown",a).on(u,"dblclick",a).on(u,"click",i.DomEvent.preventDefault).on(u,"click",s,o);return u},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";i.DomUtil.removeClass(this._zoomInButton,t);i.DomUtil.removeClass(this._zoomOutButton,t);e._zoom===e.getMinZoom()&&i.DomUtil.addClass(this._zoomOutButton,t);e._zoom===e.getMaxZoom()&&i.DomUtil.addClass(this._zoomInButton,t)}});i.Map.mergeOptions({zoomControl:!0});i.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new i.Control.Zoom;this.addControl(this.zoomControl)}});i.control.zoom=function(e){return new i.Control.Zoom(e)};i.Control.Attribution=i.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(e){i.setOptions(this,e);this._attributions={}},onAdd:function(e){this._container=i.DomUtil.create("div","leaflet-control-attribution");i.DomEvent.disableClickPropagation(this._container);e.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(e){e.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(e){this.options.prefix=e;this._update();return this},addAttribution:function(e){if(!e)return;this._attributions[e]||(this._attributions[e]=0);this._attributions[e]++;this._update();return this},removeAttribution:function(e){if(!e)return;if(this._attributions[e]){this._attributions[e]--;this._update()}return this},_update:function(){if(!this._map)return;var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix);e.length&&n.push(e.join(", "));this._container.innerHTML=n.join(" | ")},_onLayerAdd:function(e){e.layer.getAttribution&&this.addAttribution(e.layer.getAttribution())},_onLayerRemove:function(e){e.layer.getAttribution&&this.removeAttribution(e.layer.getAttribution())}});i.Map.mergeOptions({attributionControl:!0});i.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new i.Control.Attribution).addTo(this))});i.control.attribution=function(e){return new i.Control.Attribution(e)};i.Control.Scale=i.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(e){this._map=e;var t="leaflet-control-scale",n=i.DomUtil.create("div",t),r=this.options;this._addScales(r,t,n);e.on(r.updateWhenIdle?"moveend":"move",this._update,this);e.whenReady(this._update,this);return n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=i.DomUtil.create("div",t+"-line",n));e.imperial&&(this._iScale=i.DomUtil.create("div",t+"-line",n))},_update:function(){var e=this._map.getBounds(),t=e.getCenter().lat,n=6378137*Math.PI*Math.cos(t*Math.PI/180),r=n*(e.getNorthEast().lng-e.getSouthWest().lng)/180,i=this._map.getSize(),s=this.options,o=0;i.x>0&&(o=r*(s.maxWidth/i.x));this._updateScales(s,o)},_updateScales:function(e,t){e.metric&&t&&this._updateMetric(t);e.imperial&&t&&this._updateImperial(t)},_updateMetric:function(e){var t=this._getRoundNum(e);this._mScale.style.width=this._getScaleWidth(t/e)+"px";this._mScale.innerHTML=t<1e3?t+" m":t/1e3+" km"},_updateImperial:function(e){var t=e*3.2808399,n=this._iScale,r,i,s;if(t>5280){r=t/5280;i=this._getRoundNum(r);n.style.width=this._getScaleWidth(i/r)+"px";n.innerHTML=i+" mi"}else{s=this._getRoundNum(t);n.style.width=this._getScaleWidth(s/t)+"px";n.innerHTML=s+" ft"}},_getScaleWidth:function(e){return Math.round(this.options.maxWidth*e)-10},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1;return t*n}});i.control.scale=function(e){return new i.Control.Scale(e)};i.Control.Layers=i.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(e,t,n){i.setOptions(this,n);this._layers={};this._lastZIndex=0;this._handlingClick=!1;for(var r in e)this._addLayer(e[r],r);for(r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){this._initLayout();this._update();e.on("layeradd",this._onLayerChange,this).on("layerremove"
,this._onLayerChange,this);return this._container},onRemove:function(e){e.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(e,t){this._addLayer(e,t);this._update();return this},addOverlay:function(e,t){this._addLayer(e,t,!0);this._update();return this},removeLayer:function(e){var t=i.stamp(e);delete this._layers[t];this._update();return this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=i.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0);if(!i.Browser.touch){i.DomEvent.disableClickPropagation(t);i.DomEvent.on(t,"mousewheel",i.DomEvent.stopPropagation)}else i.DomEvent.on(t,"click",i.DomEvent.stopPropagation);var n=this._form=i.DomUtil.create("form",e+"-list");if(this.options.collapsed){i.Browser.android||i.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);var r=this._layersLink=i.DomUtil.create("a",e+"-toggle",t);r.href="#";r.title="Layers";i.Browser.touch?i.DomEvent.on(r,"click",i.DomEvent.stop).on(r,"click",this._expand,this):i.DomEvent.on(r,"focus",this._expand,this);this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=i.DomUtil.create("div",e+"-base",n);this._separator=i.DomUtil.create("div",e+"-separator",n);this._overlaysList=i.DomUtil.create("div",e+"-overlays",n);t.appendChild(n)},_addLayer:function(e,t,n){var r=i.stamp(e);this._layers[r]={layer:e,name:t,overlay:n};if(this.options.autoZIndex&&e.setZIndex){this._lastZIndex++;e.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var e=!1,t=!1,n,r;for(n in this._layers){r=this._layers[n];this._addItem(r);t=t||r.overlay;e=e||!r.overlay}this._separator.style.display=t&&e?"":"none"},_onLayerChange:function(e){var t=this._layers[i.stamp(e.layer)];if(!t)return;this._handlingClick||this._update();var n=t.overlay?e.type==="layeradd"?"overlayadd":"overlayremove":e.type==="layeradd"?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,n){var r='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"';n&&(r+=' checked="checked"');r+="/>";var i=t.createElement("div");i.innerHTML=r;return i.firstChild},_addItem:function(e){var n=t.createElement("label"),r,s=this._map.hasLayer(e.layer);if(e.overlay){r=t.createElement("input");r.type="checkbox";r.className="leaflet-control-layers-selector";r.defaultChecked=s}else r=this._createRadioElement("leaflet-base-layers",s);r.layerId=i.stamp(e.layer);i.DomEvent.on(r,"click",this._onInputClick,this);var o=t.createElement("span");o.innerHTML=" "+e.name;n.appendChild(r);n.appendChild(o);var u=e.overlay?this._overlaysList:this._baseLayersList;u.appendChild(n);return n},_onInputClick:function(){var e,t,n,r=this._form.getElementsByTagName("input"),i=r.length;this._handlingClick=!0;for(e=0;e<i;e++){t=r[e];n=this._layers[t.layerId];t.checked&&!this._map.hasLayer(n.layer)?this._map.addLayer(n.layer):!t.checked&&this._map.hasLayer(n.layer)&&this._map.removeLayer(n.layer)}this._handlingClick=!1},_expand:function(){i.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}});i.control.layers=function(e,t,n){return new i.Control.Layers(e,t,n)};i.PosAnimation=i.Class.extend({includes:i.Mixin.Events,run:function(e,t,n,r){this.stop();this._el=e;this._inProgress=!0;this._newPos=t;this.fire("start");e.style[i.DomUtil.TRANSITION]="all "+(n||.25)+"s cubic-bezier(0,0,"+(r||.5)+",1)";i.DomEvent.on(e,i.DomUtil.TRANSITION_END,this._onTransitionEnd,this);i.DomUtil.setPosition(e,t);i.Util.falseFn(e.offsetWidth);this._stepTimer=setInterval(i.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress)return;i.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();i.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var e=this._getPos();if(!e){this._onTransitionEnd();return}this._el._leaflet_pos=e;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var t,n,r,s=this._el,o=e.getComputedStyle(s);if(i.Browser.any3d){r=o[i.DomUtil.TRANSFORM].match(this._transformRe);if(!r)return;t=parseFloat(r[1]);n=parseFloat(r[2])}else{t=parseFloat(o.left);n=parseFloat(o.top)}return new i.Point(t,n,!0)},_onTransitionEnd:function(){i.DomEvent.off(this._el,i.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress)return;this._inProgress=!1;this._el.style[i.DomUtil.TRANSITION]="";this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});i.Map.include({setView:function(e,t,r){t=this._limitZoom(t);e=i.latLng(e);r=r||{};this._panAnim&&this._panAnim.stop();if(this._loaded&&!r.reset&&r!==!0){if(r.animate!==n){r.zoom=i.extend({animate:r.animate},r.zoom);r.pan=i.extend({animate:r.animate},r.pan)}var s=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom):this._tryAnimatedPan(e,r.pan);if(s){clearTimeout(this._sizeTimer);return this}}this._resetView(e,t);return this},panBy:function(e,t){e=i.point(e).round();t=t||{};if(!e.x&&!e.y)return this;if(!this._panAnim){this._panAnim=new i.PosAnimation;this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}t.noMoveStart||this.fire("movestart");if(t.animate!==!1){i.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e);this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else{this._rawPanBy(e);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){i.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._floor();if((t&&t.animate)!==!0&&!this.getSize().contains(n))return!1;this.panBy(n,t);return!0}});i.PosAnimation=i.DomUtil.TRANSITION?i.PosAnimation:i.PosAnimation.extend({run:function(e,t,n,r){this.stop();this._el=e;this._inProgress=!0;this._duration=n||.25;this._easeOutPower=1/Math.max(r||.5,.2);this._startPos=i.DomUtil.getPosition(e);this._offset=t.subtract(this._startPos);this._startTime=+(new Date);this.fire("start");this._animate()},stop:function(){if(!this._inProgress)return;this._step();this._complete()},_animate:function(){this._animId=i.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var e=+(new Date)-this._startTime,t=this._duration*1e3;if(e<t)this._runFrame(this._easeOut(e/t));else{this._runFrame(1);this._complete()}},_runFrame:function(e){var t=this._startPos.add(this._offset.multiplyBy(e));i.DomUtil.setPosition(this._el,t);this.fire("step")},_complete:function(){i.Util.cancelAnimFrame(this._animId);this._inProgress=!1;this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}});i.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:16});i.DomUtil.TRANSITION&&i.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&i.DomUtil.TRANSITION&&i.Browser.any3d&&!i.Browser.android23&&!i.Browser.mobileOpera;this._zoomAnimated&&i.DomEvent.on(this._mapPane,i.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)});i.Map.include(i.DomUtil.TRANSITION?{_catchTransitionEnd:function(){this._animatingZoom&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;n=n||{};if(!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r),s=this._getCenterLayerPoint()._add(i);if(n.animate!==!0&&!this.getSize().contains(i))return!1;this.fire("movestart").fire("zoomstart");this._animateZoom(e,t,s,r,null,!0);return!0},_animateZoom:function(e,t,n,r,s,o){this._animatingZoom=!0;i.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this._animateToCenter=e;this._animateToZoom=t;i.Draggable&&(i.Draggable._disabled=!0);this.fire("zoomanim",{center:e,zoom:t,origin:n,scale:r,delta:s,backwards:o})},_onZoomTransitionEnd:function(){this._animatingZoom=!1;i.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._resetView(this._animateToCenter,this._animateToZoom,!0,!0);i.Draggable&&(i.Draggable._disabled=!1)}}:{});i.TileLayer.include({_animateZoom:function(e){if(!this._animating){this._animating=!0;this._prepareBgBuffer()}var t=this._bgBuffer,n=i.DomUtil.TRANSFORM,r=e.delta?i.DomUtil.getTranslateString(e.delta):t.style[n],s=i.DomUtil.getScaleString(e.scale,e.origin);t.style[n]=e.backwards?s+" "+r:r+" "+s},_endZoomAnim:function(){var e=this._tileContainer,t=this._bgBuffer;e.style.visibility="";e.parentNode.appendChild(e);i.Util.falseFn(t.offsetWidth);this._animating=!1},_clearBgBuffer:function(){var e=this._map;if(e&&!e._animatingZoom&&!e.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[i.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var e=this._tileContainer,t=this._bgBuffer,n=this._getLoadedTilesPercentage(t),r=this._getLoadedTilesPercentage(e);if(t&&n>.5&&r<.5){e.style.visibility="hidden";this._stopLoadingImages(e);return}t.style.visibility="hidden";t.style[i.DomUtil.TRANSFORM]="";this._tileContainer=t;t=this._bgBuffer=e;this._stopLoadingImages(t);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(e){var t=e.getElementsByTagName("img"),n,r,i=0;for(n=0,r=t.length;n<r;n++)t[n].complete&&i++;return i/r},_stopLoadingImages:function(e){var t=Array.prototype.slice.call(e.getElementsByTagName("img")),n,r,s;for(n=0,r=t.length;n<r;n++){s=t[n];if(!s.complete){s.onload=i.Util.falseFn;s.onerror=i.Util.falseFn;s.src=i.Util.emptyImageUrl;s.parentNode.removeChild(s)}}}});i.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:Infinity,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(e){e=this._locateOptions=i.extend(this._defaultLocateOptions,e);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var t=i.bind(this._handleGeolocationResponse,this),n=i.bind(this._handleGeolocationError,this);e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,n,e):navigator.geolocation.getCurrentPosition(t,n,e);return this},stopLocate:function(){navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId);this._locateOptions&&(this._locateOptions.setView=!1);return this},_handleGeolocationError:function(e){var t=e.code,n=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld();this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(e){var t=e.coords.latitude,n=e.coords.longitude,r=new i.LatLng(t,n),s=180*e.coords.accuracy/40075017,o=s/Math.cos(i.LatLng.DEG_TO_RAD*t),u=i.latLngBounds([t-s,n-o],[t+s,n+o]),a=this._locateOptions;if(a.setView){var f=Math.min(this.getBoundsZoom(u),a.maxZoom);this.setView(r,f)}var l={latlng:r,bounds:u};for(var c in e.coords)typeof e.coords[c]=="number"&&(l[c]=e.coords[c]);this.fire("locationfound",l)}})})(window,document);(function(e){function i(e,t,i){var o=s(e);for(var u=0;u<t.length;u++){var a=[e,t[u]].join("-");r[a]=n(a,i||o.type,o.minZoom,o.maxZoom)}}function s(e){if(e in r)return r[e];throw"No such provider ("+e+")"}var t=" a. b. c. d.".split(" "),n=function(e,n,r,i){return{url:["http://{S}tile.stamen.com/",e,"/{Z}/{X}/{Y}.",n].join(""),type:n,subdomains:t.slice(),minZoom:r,maxZoom:i,attribution:['Map tiles by <a href="http://stamen.com">Stamen Design</a>, ','under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. ','Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, ','under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'].join("")}},r={toner:n("toner","png",0,20),terrain:n("terrain","jpg",4,18),watercolor:n("watercolor","jpg",1,16),"trees-cabs-crime":{url:"http://{S}.tiles.mapbox.com/v3/stamen.trees-cabs-crime/{Z}/{X}/{Y}.png",type:"png",subdomains:"a b c d".split(" "),minZoom:11,maxZoom:18,extent:[{lat:37.853,lon:-122.577},{lat:37.684,lon:-122.313}],attribution:['Design by Shawn Allen at <a href="http://stamen.com">Stamen</a>.','Data courtesy of <a href="http://fuf.net">FuF</a>,','<a href="http://www.yellowcabsf.com">Yellow Cab</a>','&amp; <a href="http://sf-police.org">SFPD</a>.'].join(" ")}};i("toner",["hybrid","labels","lines","background","lite"]);i("toner",["2010"]);i("toner",["2011","2011-lines","2011-labels","2011-lite"]);i("terrain",["background"]);i("terrain",["labels","lines"],"png");e.stamen=e.stamen||{};e.stamen.tile=e.stamen.tile||{};e.stamen.tile.providers=r;e.stamen.tile.getProvider=s;if(typeof MM=="object"){var o=typeof MM.Template=="function"?MM.Template:MM.TemplatedMapProvider;MM.StamenTileLayer=function(e){var t=s(e);this._provider=t;MM.Layer.call(this,new o(t.url,t.subdomains));this.provider.setZoomRange(t.minZoom,t.maxZoom);this.attribution=t.attribution};MM.StamenTileLayer.prototype={setCoordLimits:function(e){var t=this._provider;if(t.extent){e.coordLimits=[e.locationCoordinate(t.extent[0]).zoomTo(t.minZoom),e.locationCoordinate(t.extent[1]).zoomTo(t.maxZoom)];return!0}return!1}};MM.extend(MM.StamenTileLayer,MM.Layer)}typeof L=="object"&&(L.StamenTileLayer=L.TileLayer.extend({initialize:function(e){var t=s(e),n=t.url.replace(/({[A-Z]})/g,function(e){return e.toLowerCase()});L.TileLayer.prototype.initialize.call(this,n,{minZoom:t.minZoom,maxZoom:t.maxZoom,subdomains:t.subdomains,scheme:"xyz",attribution:t.attribution})}}));if(typeof google=="object"&&typeof google.maps=="object"){google.maps.StamenMapType=function(e){var t=s(e),n=t.subdomains;return google.maps.ImageMapType.call(this,{getTileUrl:function(e,r){var i=1<<r,s=e.x%i,o=s<0?s+i:s,u=e.y,a=(r+o+u)%n.length;return t.url.replace("{S}",n[a]).replace("{Z}",r).replace("{X}",o).replace("{Y}",u)},tileSize:new google.maps.Size(256,256),name:e,minZoom:t.minZoom,maxZoom:t.maxZoom})};google.maps.StamenMapType.prototype=new google.maps.ImageMapType("_")}})(typeof exports=="undefined"?this:exports);VCO.MapMarker=VCO.Class.extend({includes:[VCO.Events],initialize:function(e,t){this._el={container:{},content_container:{},content:{}};this._marker={};this._icon={};this.marker_number=0;this.media_icon_class="";this.timer={};this.data={};this.options={duration:1e3,ease:VCO.Ease.easeInSpline,width:600,height:600,map_popup:!1,use_custom_markers:!1};this.animator=null;VCO.Util.mergeData(this.options,t);VCO.Util.mergeData(this.data,e);this._initLayout()},show:function(){},hide:function(){},addTo:function(e){this._addTo(e)},removeFrom:function(e){this._removeFrom(e)},updateDisplay:function(e,t,n){this._updateDisplay(e,t,n)},createMarker:function(e,t){this._createMarker(e,t)},createPopup:function(e,t){this._createPopup(e,t)},active:function(e){this._active(e)},location:function(){return this._location()},_createMarker:function(e,t){},_addTo:function(e){},_removeFrom:function(e){},_createPopup:function(e,t){},_active:function(e){},_location:function(){return{lat:0,lng:0}},_onMarkerClick:function(e){trace("MARKER CLICK");this.fire("markerclick",{marker_number:this.marker_number})},_initLayout:function(){this._createMarker(this.data,this.options)},_updateDisplay:function(e,t,n){}});VCO.Map=VCO.Class.extend({includes:[VCO.Events,VCO.DomMixins],_el:{},initialize:function(e,t,n){this._el={container:{},map:{},map_mask:{}};typeof e=="object"?this._el.container=e:this._el.container=VCO.Dom.get(e);this._loaded={data:!1,map:!1};this._map=null;this._markers=[];this._line=null;this._line_active=null;this.current_marker=0;this.data={uniqueid:"",slides:[{test:"yes"},{test:"yes"},{test:"yes"}]};this.options={map_type:"toner",path_gfx:"gfx",start_at_slide:0,map_popup:!1,zoom_distance:100,calculate_zoom:!0,line_color:"#333",line_weight:5,line_opacity:.2,line_dash:"5,5",show_history_line:!0,map_center_offset:10};this.animator=null;this.timer=null;VCO.Util.mergeData(this.options,n);VCO.Util.mergeData(this.data,t);this._initLayout();this._initEvents();this._createMap();this._initData()},updateDisplay:function(e,t,n,r,i){this._updateDisplay(e,t,n,r,i)},goTo:function(e,t){if(e<this._markers.length&&e>=0){var n=0,r=this.current_marker;this.current_marker=e;var i=this._markers[this.current_marker];this.animator&&this.animator.stop();this._resetMarkersActive();if(i.data.type&&i.data.type=="overview"){this._markerOverview();t||this._onMarkerChange()}else{i.active(!0);if(t)this._viewTo(i.data.location);else{n=this._calculateZoomChange(this._getMapCenter(!0),i.location());this._viewTo(i.data.location,{calculate_zoom:this.options.calculate_zoom,zoom:n});this.options.show_history_line&&i.data.real_marker&&this._markers[r].data.real_marker&&this._replaceLines(this._line_active,[{lat:i.data.location.lat,lon:i.data.location.lon},{lat:this._markers[r].data.location.lat,lon:this._markers[r].data.location.lon}]);this._onMarkerChange()}}}},panTo:function(e,t){this._panTo(e,t)},zoomTo:function(e,t){this._zoomTo(e,t)},viewTo:function(e,t){this._viewTo(e,t)},getBoundsZoom:function(e,t,n,r){this.__getBoundsZoom(e,t,n,r)},markerOverview:function(){this._markerOverview()},show:function(){},hide:function(){},addTo:function(e){e.appendChild(this._el.container);this.onAdd()},removeFrom:function(e){e.removeChild(this._el.container);this.onRemove()},createMarkers:function(e){this._createMarkers(e)},createMarker:function(e){this._createMarker(e)},_destroyMarker:function(e){this._removeMarker(e);for(var t=0;t<this._markers.length;t++)this._markers[t]==e&&this._markers.splice(t,1);this.fire("markerRemoved",e)},_createMarkers:function(e){for(var t=0;t<e.length;t++){this._createMarker(e[t]);e[t].location&&e[t].location.line&&this._addToLine(this._line,e[t])}},_createLines:function(e){},_createMap:function(){trace("Create Map")},_createMarker:function(e){var t={};t.on("markerclick",this._onMarkerClick);this._addMarker(t);this._markers.push(t);t.marker_number=this._markers.length-1;this.fire("markerAdded",t)},_addMarker:function(e){},_removeMarker:function(e){},_resetMarkersActive:function(){for(var e=0;e<this._markers.length;e++)this._markers[e].active(!1)},_createLine:function(e){return{data:e}},_addToLine:function(e,t){},_replaceLines:function(e,t){},_addLineToMap:function(e){},_panTo:function(e,t){},_zoomTo:function(e,t){},_viewTo:function(e,t){},_updateMapDisplay:function(e,t,n,r){},_refreshMap:function(){},_getMapLocation:function(e){return{x:0,y:0}},_getMapZoom:function(){return 1},_getMapCenter:function(){return{lat:0,lng:0}},_getBoundsZoom:function(e,t,n,r){},_markerOverview:function(){},_onMarkerChange:function(e){this.fire("change",{current_marker:this.current_marker})},_onMarkerClick:function(e){this.current_marker!=e.marker_number&&this.goTo(e.marker_number)},_onMapLoaded:function(e){trace("MAP LOADED");this._loaded.map=!0;this._initialMapLocation();this.fire("loaded",this.data)},_initialMapLocation:function(){trace("_initialMapLocation 1");if(this._loaded.data&&this._loaded.map){trace("_initialMapLocation");trace(this.options.start_at_slide);this.goTo(this.options.start_at_slide,!0)}},_calculateZoomChange:function(e,t){return this._getBoundsZoom(e,t,!0)},_updateDisplay:function(e,t,n,r,i){if(t){this._el.map.style.height=t+"px";this._el.map_mask.style.height=t+"px"}this._updateMapDisplay()},_initLayout:function(){this._el.map_mask=VCO.Dom.create("div","vco-map-mask",this._el.container);this._el.map=VCO.Dom.create("div","vco-map-display",this._el.map_mask)},_initData:function(){if(this.data.slides){this._createMarkers(this.data.slides);this._resetMarkersActive();this._markers[this.current_marker].active(!0);this._loaded.data=!0;this._initialMapLocation()}},_initEvents:function(){}});VCO.MapMarker.Leaflet=VCO.MapMarker.extend({_createMarker:function(e,t){trace(this.data);var n={};if(e.location&&e.location.lat&&e.location.lon){this.data.real_marker=!0;t.use_custom_markers&&e.location.icon&&e.location.icon!=""&&(this._icon=L.icon({iconUrl:e.location.icon,iconSize:[41]}));this._icon=L.divIcon({className:"vco-mapmarker "+this.media_icon_class});this._marker=L.marker([e.location.lat,e.location.lon],{title:e.text.headline,icon:this._icon});this._marker.on("click",this._onMarkerClick,this);this._createPopup(e,t);t.map_popup&&this._createPopup(e,t)}},_addTo:function(e){this.data.real_marker&&this._marker.addTo(e)},_createPopup:function(e,t){var n="";n+="<h4>"+this.data.text.headline+"</h4>";this._marker.bindPopup(n,{closeButton:!1,offset:[0,43]})},_active:function(e){var t=this;this.data.media&&this.data.media.mediatype&&(this.media_icon_class="vco-mapmarker-icon vco-mapmarker-icon-"+this.data.media.mediatype.type);if(this.data.real_marker)if(e){this._marker.setZIndexOffset(100);this._icon=L.divIcon({className:"vco-mapmarker-active "+this.media_icon_class});this.timer=setTimeout(function(){t._openPopup()},this.options.duration+200);this._setIcon()}else{this._marker.closePopup();clearTimeout(this.timer);this._marker.setZIndexOffset(0);this._icon=L.divIcon({className:"vco-mapmarker "+this.media_icon_class});this._setIcon()}},_openPopup:function(){this._marker.openPopup()},_setIcon:function(){this._marker.setIcon(this._icon)},_location:function(){return this.data.real_marker?this._marker.getLatLng():{}}});VCO.Map.Leaflet=VCO.Map.extend({includes:[VCO.Events],_createMap:function(){L.Icon.Default.imagePath=this.options.path_gfx;this._map=new L.map(this._el.map,{scrollWheelZoom:!1});this._map.on("load",this._onMapLoaded,this);var e=new L.StamenTileLayer(this.options.map_type);this._map.addLayer(e);this._line=this._createLine(this._line);this._addLineToMap(this._line);this._line_active=this._createLine(this._line_active);this._line_active.setStyle({opacity:1});this._addLineToMap(this._line_active)},_createMarker:function(e){var t=new VCO.MapMarker.Leaflet(e,this.options);t.on("markerclick",this._onMarkerClick,this);this._addMarker(t);this._markers.push(t);t.marker_number=this._markers.length-1;this.fire("markerAdded",t)},_addMarker:function(e){e.addTo(this._map)},_removeMarker:function(e){},_markerOverview:function(){var e=[];for(var t=0;t<this._markers.length;t++)this._markers[t].data.real_marker&&e.push([this._markers[t].data.location.lat,this._markers[t].data.location.lon]);this._map.fitBounds(e,{padding:[15,15]})},_createLine:function(e){return new L.Polyline([],{clickable:!1,color:this.options.line_color,weight:this.options.line_weight,opacity:this.options.line_opacity,dashArray:this.options.line_dash})},_addLineToMap:function(e){this._map.addLayer(e)},_addToLine:function(e,t){e.addLatLng({lon:t.location.lon,lat:t.location.lat})},_replaceLines:function(e,t){e.setLatLngs(t)},_panTo:function(e,t){this._map.panTo({lat:e.lat,lon:e.lon},{animate:!0,duration:this.options.duration/1e3,easeLinearity:.1})},_zoomTo:function(e,t){this._map.setZoom(e)},_viewTo:function(e,t){var n=!0,r=this.options.duration/1e3,i=this._getMapZoom();e.zoom&&(i=e.zoom);if(t){t.duration&&(t.duration==0?n=!1:r=duration);t.zoom&&t.calculate_zoom&&(i=t.zoom)}this.options.map_center_offset?this._map.setView({lat:e.lat,lon:e.lon},i,{pan:{animate:n,duration:r,easeLinearity:.1},zoom:{animate:n,duration:r,easeLinearity:.1}}):this._map.setView({lat:e.lat,lon:e.lon},i,{pan:{animate:n,duration:r,easeLinearity:.1},zoom:{animate:n,duration:r,easeLinearity:.1}})},_getMapLocation:function(e){return this._map.latLngToContainerPoint(e)},_getMapZoom:function(){return this._map.getZoom()},_getMapCenter:function(e){e;return this._map.getCenter()},_getMapCenterOffset:function(e,t,n){var r,i;i=this._map.getSize().y/2;if(n){i+=this.options.map_center_offset;r=this._map.project(e,t).add([0,i])}else{i-=this.options.map_center_offset;r=this._map.project(e,t).subtract([0,i])}return this._map.unproject(r,t)},_getBoundsZoom:function(e,t,n){var r=e;this.options.map_center_offset;if(n){var i=r.lat+(r.lat-t.lat)/2,s=r.lng+(r.lng-t.lng)/2;r=new L.LatLng(i,s)}var o=new L.LatLngBounds([r,t]);return this._map.getBoundsZoom(o,!1)},_updateMapDisplay:function(e,t,n,r){if(n){var i=this.options.duration,s=this;r&&(i=r);this.timer&&clearTimeout(this.timer);this.timer=setTimeout(function(){s._refreshMap()},i)}else this.timer||this._refreshMap()},_refreshMap:function(){if(this._map){if(this.timer){clearTimeout(this.timer);this.timer=null}this._map.invalidateSize();this._markers[this.current_marker].data.type&&this._markers[this.current_marker].data.type=="overview"?this._markerOverview():this._viewTo(this._markers[this.current_marker].data.location,{zoom:this._getMapZoom(),calculate_zoom:!0})}}});VCO.StoryMap=VCO.Class.extend({includes:VCO.Events,initialize:function(e,t,n){this.ready=!1;this._el={container:{},storyslider:{},map:{},sizebar:{}};typeof e=="object"?this._el.container=e:this._el.container=VCO.Dom.get(e);this._storyslider={};this._map={};this._sizebar={};this._loaded={storyslider:!1,map:!1};this.data={uniqueid:"",slides:[{uniqueid:"",type:"overview",background:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/Mark_Twain_by_Abdullah_Fr%C3%A8res%2C_1867.jpg/418px-Mark_Twain_by_Abdullah_Fr%C3%A8res%2C_1867.jpg",color:"",opacity:50},date:"1835",text:{headline:"Mark Twain",text:'Samuel Langhorne Clemens (November 30, 1835 – April 21, 1910), better known by his pen name Mark Twain, was an American author and humorist. He wrote The Adventures of Tom Sawyer (1876) and its sequel, Adventures of Huckleberry Finn (1885), the latter often called "the Great American Novel."'},media:null},{uniqueid:"",background:{url:null,color:"",opacity:50},date:"1835",location:{lat:39.491711,lon:-91.79326,name:"Florida, Missouri",zoom:12,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Florida, Missouri",text:"Born in Florida, Missouri. Halley’s comet visible from earth."},media:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Mark_Twain_birthplace.jpg/800px-Mark_Twain_birthplace.jpg",credit:"",caption:"Mark Twain's birthplace, Florida, Missouri"}},{uniqueid:"",background:{url:null,color:"",opacity:50},date:"1839",location:{lat:39.712304,lon:-91.358088,zoom:10,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Hannibal, Missouri",text:"Moves to Hannibal, Missouri, which later serves as the model town for Tom Sawyer and Huckleberry Finn."},media:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Mark_Twain_Boyhood_Home_1.jpg/800px-Mark_Twain_Boyhood_Home_1.jpg",credit:"",caption:"Mark Twain's boyhood home in Hannibal, Missouri."}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:"1851",location:{lat:39.710083,lon:-91.357441,zoom:12,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Hannibal Gazette",text:"Begins work as a journeyman printer with the Hannibal Gazette. Publishes first sketches."},media:{url:"https://soundcloud.com/beastieboys/make-some-noise",credit:null,caption:null}},{uniqueid:"",background:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",color:"",opacity:50},date:null,location:{lat:40.714353,lon:-74.005973,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Itinerant Printer",text:"Visits St. Louis, New York, and Philadelphia as an itinerant printer."},media:{url:"https://vine.co/v/bjHh0zHdgZT",credit:null,caption:null}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:"1862",location:{lat:39.309514,lon:-119.649979,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Virginia City Territorial Enterprise",text:"Travels around Nevada and California. Takes job as reporter for the Virginia City Territorial Enterprise."},media:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Mark_Twain%27s_desk_at_the_Mark_Twain_Territorial_Enterprise_Museum%2C_Virginia_City%2C_NV.jpg/794px-Mark_Twain%27s_desk_at_the_Mark_Twain_Territorial_Enterprise_Museum%2C_Virginia_City%2C_NV.jpg",credit:"",caption:"Mark Twain's desk when he was editor of the Territorial Enterprise. Mark Twain Territorial Enterprise Museum, Virginia City, NV."}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:"1865",location:{lat:37.774929,lon:-122.419416,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"San Francisco",text:"Forced to leave Nevada for breaking dueling laws. Prospects in Calaveras County, settles in San Francisco. Writes for magazines and newspapers."},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"ETC",caption:"something"}},{uniqueid:"",background:{url:null,color:"",opacity:50},date:"1866",location:{lat:19.896766,lon:-155.582782,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Hawaii",text:"Takes trip to Hawaii as correspondent of the Sacramento Alta Californian. Reports on shipwreck of the Hornet. Gives first public lecture."},media:{url:"http://photos.wikimapia.org/p/00/00/56/17/28_big.jpg",credit:"",caption:"Wreck of USS Hornet."}},{uniqueid:"",background:{url:null,color:"",opacity:50},date:"1867",location:{lat:54.525961,lon:15.255119,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Travels",text:"Travels as correspondent to Europe and the Holy Land on the Quaker City. Sees a picture of Olivia Langdon (Livy). Publishes The Celebrated Jumping Frog of Calaveras County, and Other Sketches. Sales are light."},media:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/1867._The_Celebrated_Jumping_Frog_of_Calaveras_County%2C_and_Other_Sketches.djvu/page1-395px-1867._The_Celebrated_Jumping_Frog_of_Calaveras_County%2C_and_Other_Sketches.djvu.jpg",credit:"",caption:""}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:"1868",location:{lat:42.089796,lon:-76.807734,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Livy",text:"Lectures across the United States. Meets and falls in love with Livy in Elmira, New York."},media:{url:"https://twitter.com/MarkTwainQuote/status/384850339297755136",credit:"ETC",caption:"something"}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:"1870",location:{lat:42.886447,lon:-78.878369,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Married",text:"Marries Livy in Elmira. Her father buys them a house in Buffalo, New York. Son Langdon is born."},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"ETC",caption:"something"}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:"1872",location:{lat:41.763711,lon:-72.685093,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Roughing It",text:"Moves with Livy to Hartford. Publishes Roughing It. Daughter is born. Son Langdon dies."},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"ETC",caption:"something"}},{uniqueid:"",background:{url:null,color:"#cdbfe3",opacity:50},date:"1891",location:{lat:54.525961,lon:15.255119,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Financial",text:"Leaves Hartford to live in Europe because of financial difficulties."},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"ETC",caption:"something"}},{uniqueid:"",background:{url:null,color:"",opacity:50},date:"1891",location:{lat:40.714353,lon:-74.005973,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png"},text:{headline:"Livy dies",text:"Livy dies. Begins dictating autobiography. Moves to New York City."},media:{url:"http://2.bp.blogspot.com/-dxJbW0CG8Zs/TmkoMA5-cPI/AAAAAAAAAqw/fQpsz9GpFdo/s1600/voyage-dans-la-lune-1902-02-g.jpg",credit:"ETC",caption:"something"}},{uniqueid:"",background:{url:null,color:null,opacity:50},date:"1891",location:{lat:41.30454,lon:-73.392898,zoom:11,icon:"http://maps.gstatic.com/intl/en_us/mapfiles/ms/micons/blue-pushpin.png",line:!0},text:{headline:"Stormfield",text:"Moves into Stormfield in Redding, CT. Forms the Angelfish Club for young girls."
},media:{url:"http://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Mark_Twain%27s_house%2C_front_view._-_NARA_-_516527.tif/lossy-page1-800px-Mark_Twain%27s_house%2C_front_view._-_NARA_-_516527.tif.jpg",credit:"",caption:'Twain\'s house, "Stormfield", in Redding, Connecticut (front view)'}}]};this.options={height:this._el.container.offsetHeight,width:this._el.container.offsetWidth,map_size_sticky:3,map_center_offset:60,start_at_slide:0,sizebar_height:0,duration:1e3,ease:VCO.Ease.easeInOutQuint,dragging:!0,trackResize:!0,map_type:"toner-lite",map_height:300,storyslider_height:600,sizebar_default_y:300,path_gfx:"gfx",map_popup:!1,zoom_distance:100,calculate_zoom:!0,use_custom_markers:!1,line_color:"#000",line_weight:3,line_opacity:.2,line_dash:"5,5",show_history_line:!0,api_key_flickr:"f2cc870b4d233dd0a5bfe73fd0d64ef0",language:{name:"English"}};this.current_slide=this.options.start_at_slide;this.animator_map=null;this.animator_storyslider=null;VCO.Util.mergeData(this.options,n);this._initData(t);return this},goTo:function(e){if(e!=this.current_slide){this.current_slide=e;this._storyslider.goTo(this.current_slide);this._map.goTo(this.current_slide)}},updateDisplay:function(){this.ready&&this._updateDisplay()},_initData:function(e){trace("initData");var t=this;if(typeof e=="string")VCO.getJSON(e,function(e){e&&e.storymap&&VCO.Util.mergeData(t.data,e.storymap);t._onDataLoaded()});else if(typeof e=="object"){this.data=e;t._onDataLoaded()}else t._onDataLoaded()},_initLayout:function(){this._el.container.className+=" vco-storymap";this._el.sizebar=VCO.Dom.create("div","vco-sizebar",this._el.container);this._el.map=VCO.Dom.create("div","vco-map",this._el.container);this._el.storyslider=VCO.Dom.create("div","vco-storyslider",this._el.container);this.options.width=this._el.container.offsetWidth;this.options.height=this._el.container.offsetHeight;this._el.map.style.height="1px";this._el.storyslider.style.top="1px";this._map=new VCO.Map.Leaflet(this._el.map,this.data,this.options);this._map.on("loaded",this._onMapLoaded,this);this._sizebar=new VCO.SizeBar(this._el.sizebar,this._el.container,this.options);this._storyslider=new VCO.StorySlider(this._el.storyslider,this.data,this.options);this._storyslider.on("loaded",this._onStorySliderLoaded,this);this._storyslider.init();this.options.map_height=this.options.height/this.options.map_size_sticky;this.options.storyslider_height=this.options.height-this._el.sizebar.offsetHeight-this.options.map_height-1;this._sizebar.setSticky(this.options.map_height);this._updateDisplay(this.options.map_height,!0,2e3);this._sizebar.show(2e3)},_initEvents:function(){this._sizebar.on("clicked",this._onSizeBar,this);this._sizebar.on("move",this._onSizeBarMove,this);this._sizebar.on("swipe",this._onSizeBarSwipe,this);this._sizebar.on("momentum",this._onSizeBarSwipe,this);this._storyslider.on("change",this._onSlideChange,this);this._map.on("change",this._onMapChange,this)},_updateDisplay:function(e,t,n){var r=this.options.duration,i=this;n&&(r=n);this.options.width=this._el.container.offsetWidth;this.options.height=this._el.container.offsetHeight;this._sizebar.setSticky(Math.floor(this._el.container.offsetHeight/this.options.map_size_sticky));e&&(this.options.map_height=e);this.options.storyslider_height=this.options.height-this.options.sizebar_height-this.options.map_height-1;if(t){this.animator_map&&this.animator_map.stop();this.animator_map=VCO.Animate(this._el.map,{height:e+"px",duration:r,easing:VCO.Ease.easeOutStrong,complete:function(){i._map.updateDisplay(i.options.width,i.options.map_height,t,n,i.options.sizebar_height)}});this.animator_storyslider&&this.animator_storyslider.stop();this.animator_storyslider=VCO.Animate(this._el.storyslider,{height:this.options.storyslider_height+"px",top:this.options.sizebar_height+"px",duration:r,easing:VCO.Ease.easeOutStrong})}else{this._el.map.style.height=Math.ceil(e)+"px";this._el.storyslider.style.height=this.options.storyslider_height+"px";this._el.storyslider.style.top=this.options.sizebar_height+"px"}this._storyslider.updateDisplay(this.options.width,this.options.storyslider_height,t);this._sizebar.updateDisplay(this.options.width,this.options.height,t,this.options.map_height)},_onDataLoaded:function(e){this.fire("dataloaded");this._initLayout();this._initEvents();this.ready=!0},_onSlideChange:function(e){if(this.current_slide!=e.current_slide){this.current_slide=e.current_slide;this._map.goTo(this.current_slide);this.fire("change",{current_slide:this.current_slide},this)}},_onMapChange:function(e){if(this.current_slide!=e.current_marker){this.current_slide=e.current_marker;this._storyslider.goTo(this.current_slide);this.fire("change",{current_slide:this.current_slide},this)}},_onSizeBar:function(e){trace("ON SIZEBAR")},_onSizeBarMove:function(e){this._updateDisplay(e.y)},_onSizeBarSwipe:function(e){this._updateDisplay(e.y,!0)},_onMouseClick:function(e){},_fireMouseEvent:function(e){if(!this._loaded)return;var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t))return;t==="contextmenu"&&VCO.DomEvent.preventDefault(e);this.fire(t,{latlng:"something",layerPoint:"something else"})},_onMapLoaded:function(){trace("MAP READY");this._loaded.map=!0;this._onLoaded()},_onStorySliderLoaded:function(){trace("STORYSLIDER READY");this._loaded.storyslider=!0;this._onLoaded()},_onLoaded:function(){if(this._loaded.storyslider&&this._loaded.map){trace("STORYMAP IS READY");this.fire("loaded",this.data)}}});